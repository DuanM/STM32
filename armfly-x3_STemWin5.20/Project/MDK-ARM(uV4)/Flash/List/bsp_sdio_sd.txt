; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o..\output\bsp_sdio_sd.o --asm_dir=.\Flash\List\ --list_dir=.\Flash\List\ --depend=..\output\bsp_sdio_sd.d --cpu=Cortex-M4.fp --apcs=interwork -O0 --diag_suppress=870 -I..\..\User -I..\..\Libraries\STM32F4xx_StdPeriph_Driver\inc -I..\..\Libraries\CMSIS\Device\ST\STM32F4xx\Include -I..\..\User\fonts -I..\..\emWin\GUI_X -I..\..\emWin\Config -I..\..\emWin\Include -I..\..\emWin\emWinTask -I..\..\User\fatfs\src -I..\..\FreeRTOS\include -I..\..\FreeRTOS\portable\RVDS\ARM_CM4F -I..\..\User\bsp_stm32f4xx -I..\..\User\bsp_stm32f4xx\inc -ID:\Keil_v4\ARM\RV31\INC -ID:\Keil_v4\ARM\CMSIS\Include -ID:\Keil_v4\ARM\Inc\ST\STM32F4xx -D__MICROLIB -DUSE_STDPERIPH_DRIVER -DSTM32F4XX -DARM_MATH_CM4 -D__CC_ARM ..\..\User\bsp_stm32f4xx\src\bsp_sdio_sd.c]
                          THUMB

                          AREA ||i.CmdError||, CODE, READONLY, ALIGN=1

                  CmdError PROC
;;;2065     */
;;;2066   static SD_Error CmdError(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2067   {
;;;2068     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2069     uint32_t timeout;
;;;2070   
;;;2071     timeout = SDIO_CMD0TIMEOUT; /*!< 10000 */
000004  f44f3480          MOV      r4,#0x10000
;;;2072   
;;;2073     while ((timeout > 0) && (SDIO_GetFlagStatus(SDIO_FLAG_CMDSENT) == RESET))
000008  e000              B        |L1.12|
                  |L1.10|
;;;2074     {
;;;2075       timeout--;
00000a  1e64              SUBS     r4,r4,#1
                  |L1.12|
00000c  b124              CBZ      r4,|L1.24|
00000e  2080              MOVS     r0,#0x80              ;2073
000010  f7fffffe          BL       SDIO_GetFlagStatus
000014  2800              CMP      r0,#0                 ;2073
000016  d0f8              BEQ      |L1.10|
                  |L1.24|
;;;2076     }
;;;2077   
;;;2078     if (timeout == 0)
000018  b914              CBNZ     r4,|L1.32|
;;;2079     {
;;;2080       errorstatus = SD_CMD_RSP_TIMEOUT;
00001a  2503              MOVS     r5,#3
;;;2081       return(errorstatus);
00001c  4628              MOV      r0,r5
                  |L1.30|
;;;2082     }
;;;2083   
;;;2084     /*!< Clear all the static flags */
;;;2085     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2086   
;;;2087     return(errorstatus);
;;;2088   }
00001e  bd70              POP      {r4-r6,pc}
                  |L1.32|
000020  f24050ff          MOV      r0,#0x5ff             ;2085
000024  f7fffffe          BL       SDIO_ClearFlag
000028  4628              MOV      r0,r5                 ;2087
00002a  e7f8              B        |L1.30|
;;;2089   
                          ENDP


                          AREA ||i.CmdResp1Error||, CODE, READONLY, ALIGN=2

                  CmdResp1Error PROC
;;;2131     */
;;;2132   static SD_Error CmdResp1Error(uint8_t cmd)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;2133   {
000004  4606              MOV      r6,r0
;;;2134     SD_Error errorstatus = SD_OK;
000006  2700              MOVS     r7,#0
;;;2135     uint32_t status;
;;;2136     uint32_t response_r1;
;;;2137   
;;;2138     status = SDIO->STA;
000008  4847              LDR      r0,|L2.296|
00000a  6805              LDR      r5,[r0,#0]
;;;2139   
;;;2140     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
00000c  e001              B        |L2.18|
                  |L2.14|
;;;2141     {
;;;2142       status = SDIO->STA;
00000e  4846              LDR      r0,|L2.296|
000010  6805              LDR      r5,[r0,#0]
                  |L2.18|
000012  f0150f45          TST      r5,#0x45              ;2140
000016  d0fa              BEQ      |L2.14|
;;;2143     }
;;;2144   
;;;2145     if (status & SDIO_FLAG_CTIMEOUT)
000018  f0150f04          TST      r5,#4
00001c  d006              BEQ      |L2.44|
;;;2146     {
;;;2147       errorstatus = SD_CMD_RSP_TIMEOUT;
00001e  2703              MOVS     r7,#3
;;;2148       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000020  2004              MOVS     r0,#4
000022  f7fffffe          BL       SDIO_ClearFlag
;;;2149       return(errorstatus);
000026  4638              MOV      r0,r7
                  |L2.40|
;;;2150     }
;;;2151     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2152     {
;;;2153       errorstatus = SD_CMD_CRC_FAIL;
;;;2154       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2155       return(errorstatus);
;;;2156     }
;;;2157   
;;;2158     /*!< Check response received is of desired command */
;;;2159     if (SDIO_GetCommandResponse() != cmd)
;;;2160     {
;;;2161       errorstatus = SD_ILLEGAL_CMD;
;;;2162       return(errorstatus);
;;;2163     }
;;;2164   
;;;2165     /*!< Clear all the static flags */
;;;2166     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2167   
;;;2168     /*!< We have received response, retrieve it for analysis  */
;;;2169     response_r1 = SDIO_GetResponse(SDIO_RESP1);
;;;2170   
;;;2171     if ((response_r1 & SD_OCR_ERRORBITS) == SD_ALLZERO)
;;;2172     {
;;;2173       return(errorstatus);
;;;2174     }
;;;2175   
;;;2176     if (response_r1 & SD_OCR_ADDR_OUT_OF_RANGE)
;;;2177     {
;;;2178       return(SD_ADDR_OUT_OF_RANGE);
;;;2179     }
;;;2180   
;;;2181     if (response_r1 & SD_OCR_ADDR_MISALIGNED)
;;;2182     {
;;;2183       return(SD_ADDR_MISALIGNED);
;;;2184     }
;;;2185   
;;;2186     if (response_r1 & SD_OCR_BLOCK_LEN_ERR)
;;;2187     {
;;;2188       return(SD_BLOCK_LEN_ERR);
;;;2189     }
;;;2190   
;;;2191     if (response_r1 & SD_OCR_ERASE_SEQ_ERR)
;;;2192     {
;;;2193       return(SD_ERASE_SEQ_ERR);
;;;2194     }
;;;2195   
;;;2196     if (response_r1 & SD_OCR_BAD_ERASE_PARAM)
;;;2197     {
;;;2198       return(SD_BAD_ERASE_PARAM);
;;;2199     }
;;;2200   
;;;2201     if (response_r1 & SD_OCR_WRITE_PROT_VIOLATION)
;;;2202     {
;;;2203       return(SD_WRITE_PROT_VIOLATION);
;;;2204     }
;;;2205   
;;;2206     if (response_r1 & SD_OCR_LOCK_UNLOCK_FAILED)
;;;2207     {
;;;2208       return(SD_LOCK_UNLOCK_FAILED);
;;;2209     }
;;;2210   
;;;2211     if (response_r1 & SD_OCR_COM_CRC_FAILED)
;;;2212     {
;;;2213       return(SD_COM_CRC_FAILED);
;;;2214     }
;;;2215   
;;;2216     if (response_r1 & SD_OCR_ILLEGAL_CMD)
;;;2217     {
;;;2218       return(SD_ILLEGAL_CMD);
;;;2219     }
;;;2220   
;;;2221     if (response_r1 & SD_OCR_CARD_ECC_FAILED)
;;;2222     {
;;;2223       return(SD_CARD_ECC_FAILED);
;;;2224     }
;;;2225   
;;;2226     if (response_r1 & SD_OCR_CC_ERROR)
;;;2227     {
;;;2228       return(SD_CC_ERROR);
;;;2229     }
;;;2230   
;;;2231     if (response_r1 & SD_OCR_GENERAL_UNKNOWN_ERROR)
;;;2232     {
;;;2233       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2234     }
;;;2235   
;;;2236     if (response_r1 & SD_OCR_STREAM_READ_UNDERRUN)
;;;2237     {
;;;2238       return(SD_STREAM_READ_UNDERRUN);
;;;2239     }
;;;2240   
;;;2241     if (response_r1 & SD_OCR_STREAM_WRITE_OVERRUN)
;;;2242     {
;;;2243       return(SD_STREAM_WRITE_OVERRUN);
;;;2244     }
;;;2245   
;;;2246     if (response_r1 & SD_OCR_CID_CSD_OVERWRIETE)
;;;2247     {
;;;2248       return(SD_CID_CSD_OVERWRITE);
;;;2249     }
;;;2250   
;;;2251     if (response_r1 & SD_OCR_WP_ERASE_SKIP)
;;;2252     {
;;;2253       return(SD_WP_ERASE_SKIP);
;;;2254     }
;;;2255   
;;;2256     if (response_r1 & SD_OCR_CARD_ECC_DISABLED)
;;;2257     {
;;;2258       return(SD_CARD_ECC_DISABLED);
;;;2259     }
;;;2260   
;;;2261     if (response_r1 & SD_OCR_ERASE_RESET)
;;;2262     {
;;;2263       return(SD_ERASE_RESET);
;;;2264     }
;;;2265   
;;;2266     if (response_r1 & SD_OCR_AKE_SEQ_ERROR)
;;;2267     {
;;;2268       return(SD_AKE_SEQ_ERROR);
;;;2269     }
;;;2270     return(errorstatus);
;;;2271   }
000028  e8bd81f0          POP      {r4-r8,pc}
                  |L2.44|
00002c  f0150f01          TST      r5,#1                 ;2151
000030  d005              BEQ      |L2.62|
000032  2701              MOVS     r7,#1                 ;2153
000034  2001              MOVS     r0,#1                 ;2154
000036  f7fffffe          BL       SDIO_ClearFlag
00003a  4638              MOV      r0,r7                 ;2155
00003c  e7f4              B        |L2.40|
                  |L2.62|
00003e  f7fffffe          BL       SDIO_GetCommandResponse
000042  42b0              CMP      r0,r6                 ;2159
000044  d002              BEQ      |L2.76|
000046  2710              MOVS     r7,#0x10              ;2161
000048  4638              MOV      r0,r7                 ;2162
00004a  e7ed              B        |L2.40|
                  |L2.76|
00004c  f24050ff          MOV      r0,#0x5ff             ;2166
000050  f7fffffe          BL       SDIO_ClearFlag
000054  2000              MOVS     r0,#0                 ;2169
000056  f7fffffe          BL       SDIO_GetResponse
00005a  4604              MOV      r4,r0                 ;2169
00005c  4833              LDR      r0,|L2.300|
00005e  4204              TST      r4,r0                 ;2171
000060  d101              BNE      |L2.102|
000062  4638              MOV      r0,r7                 ;2173
000064  e7e0              B        |L2.40|
                  |L2.102|
000066  f0144f00          TST      r4,#0x80000000        ;2176
00006a  d001              BEQ      |L2.112|
00006c  201c              MOVS     r0,#0x1c              ;2178
00006e  e7db              B        |L2.40|
                  |L2.112|
000070  f0144f80          TST      r4,#0x40000000        ;2181
000074  d001              BEQ      |L2.122|
000076  2009              MOVS     r0,#9                 ;2183
000078  e7d6              B        |L2.40|
                  |L2.122|
00007a  f0145f00          TST      r4,#0x20000000        ;2186
00007e  d001              BEQ      |L2.132|
000080  200a              MOVS     r0,#0xa               ;2188
000082  e7d1              B        |L2.40|
                  |L2.132|
000084  f0145f80          TST      r4,#0x10000000        ;2191
000088  d001              BEQ      |L2.142|
00008a  200b              MOVS     r0,#0xb               ;2193
00008c  e7cc              B        |L2.40|
                  |L2.142|
00008e  f0146f00          TST      r4,#0x8000000         ;2196
000092  d001              BEQ      |L2.152|
000094  200c              MOVS     r0,#0xc               ;2198
000096  e7c7              B        |L2.40|
                  |L2.152|
000098  f0146f80          TST      r4,#0x4000000         ;2201
00009c  d001              BEQ      |L2.162|
00009e  200d              MOVS     r0,#0xd               ;2203
0000a0  e7c2              B        |L2.40|
                  |L2.162|
0000a2  f0147f80          TST      r4,#0x1000000         ;2206
0000a6  d001              BEQ      |L2.172|
0000a8  200e              MOVS     r0,#0xe               ;2208
0000aa  e7bd              B        |L2.40|
                  |L2.172|
0000ac  f4140f00          TST      r4,#0x800000          ;2211
0000b0  d001              BEQ      |L2.182|
0000b2  200f              MOVS     r0,#0xf               ;2213
0000b4  e7b8              B        |L2.40|
                  |L2.182|
0000b6  f4140f80          TST      r4,#0x400000          ;2216
0000ba  d001              BEQ      |L2.192|
0000bc  2010              MOVS     r0,#0x10              ;2218
0000be  e7b3              B        |L2.40|
                  |L2.192|
0000c0  f4141f00          TST      r4,#0x200000          ;2221
0000c4  d001              BEQ      |L2.202|
0000c6  2011              MOVS     r0,#0x11              ;2223
0000c8  e7ae              B        |L2.40|
                  |L2.202|
0000ca  f4141f80          TST      r4,#0x100000          ;2226
0000ce  d001              BEQ      |L2.212|
0000d0  2012              MOVS     r0,#0x12              ;2228
0000d2  e7a9              B        |L2.40|
                  |L2.212|
0000d4  f4142f00          TST      r4,#0x80000           ;2231
0000d8  d001              BEQ      |L2.222|
0000da  2013              MOVS     r0,#0x13              ;2233
0000dc  e7a4              B        |L2.40|
                  |L2.222|
0000de  f4142f80          TST      r4,#0x40000           ;2236
0000e2  d001              BEQ      |L2.232|
0000e4  2014              MOVS     r0,#0x14              ;2238
0000e6  e79f              B        |L2.40|
                  |L2.232|
0000e8  f4143f00          TST      r4,#0x20000           ;2241
0000ec  d001              BEQ      |L2.242|
0000ee  2015              MOVS     r0,#0x15              ;2243
0000f0  e79a              B        |L2.40|
                  |L2.242|
0000f2  f4143f80          TST      r4,#0x10000           ;2246
0000f6  d001              BEQ      |L2.252|
0000f8  2016              MOVS     r0,#0x16              ;2248
0000fa  e795              B        |L2.40|
                  |L2.252|
0000fc  f4144f00          TST      r4,#0x8000            ;2251
000100  d001              BEQ      |L2.262|
000102  2017              MOVS     r0,#0x17              ;2253
000104  e790              B        |L2.40|
                  |L2.262|
000106  f4144f80          TST      r4,#0x4000            ;2256
00010a  d001              BEQ      |L2.272|
00010c  2018              MOVS     r0,#0x18              ;2258
00010e  e78b              B        |L2.40|
                  |L2.272|
000110  f4145f00          TST      r4,#0x2000            ;2261
000114  d001              BEQ      |L2.282|
000116  2019              MOVS     r0,#0x19              ;2263
000118  e786              B        |L2.40|
                  |L2.282|
00011a  f0140f08          TST      r4,#8                 ;2266
00011e  d001              BEQ      |L2.292|
000120  201a              MOVS     r0,#0x1a              ;2268
000122  e781              B        |L2.40|
                  |L2.292|
000124  4638              MOV      r0,r7                 ;2270
000126  e77f              B        |L2.40|
;;;2272   
                          ENDP

                  |L2.296|
                          DCD      0x40012c34
                  |L2.300|
                          DCD      0xfdffe008

                          AREA ||i.CmdResp2Error||, CODE, READONLY, ALIGN=2

                  CmdResp2Error PROC
;;;2305     */
;;;2306   static SD_Error CmdResp2Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2307   {
;;;2308     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2309     uint32_t status;
;;;2310   
;;;2311     status = SDIO->STA;
000004  480f              LDR      r0,|L3.68|
000006  6804              LDR      r4,[r0,#0]
;;;2312   
;;;2313     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CTIMEOUT | SDIO_FLAG_CMDREND)))
000008  e001              B        |L3.14|
                  |L3.10|
;;;2314     {
;;;2315       status = SDIO->STA;
00000a  480e              LDR      r0,|L3.68|
00000c  6804              LDR      r4,[r0,#0]
                  |L3.14|
00000e  f0140f45          TST      r4,#0x45              ;2313
000012  d0fa              BEQ      |L3.10|
;;;2316     }
;;;2317   
;;;2318     if (status & SDIO_FLAG_CTIMEOUT)
000014  f0140f04          TST      r4,#4
000018  d005              BEQ      |L3.38|
;;;2319     {
;;;2320       errorstatus = SD_CMD_RSP_TIMEOUT;
00001a  2503              MOVS     r5,#3
;;;2321       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
00001c  2004              MOVS     r0,#4
00001e  f7fffffe          BL       SDIO_ClearFlag
;;;2322       return(errorstatus);
000022  4628              MOV      r0,r5
                  |L3.36|
;;;2323     }
;;;2324     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2325     {
;;;2326       errorstatus = SD_CMD_CRC_FAIL;
;;;2327       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2328       return(errorstatus);
;;;2329     }
;;;2330   
;;;2331     /*!< Clear all the static flags */
;;;2332     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2333   
;;;2334     return(errorstatus);
;;;2335   }
000024  bd70              POP      {r4-r6,pc}
                  |L3.38|
000026  f0140f01          TST      r4,#1                 ;2324
00002a  d005              BEQ      |L3.56|
00002c  2501              MOVS     r5,#1                 ;2326
00002e  2001              MOVS     r0,#1                 ;2327
000030  f7fffffe          BL       SDIO_ClearFlag
000034  4628              MOV      r0,r5                 ;2328
000036  e7f5              B        |L3.36|
                  |L3.56|
000038  f24050ff          MOV      r0,#0x5ff             ;2332
00003c  f7fffffe          BL       SDIO_ClearFlag
000040  4628              MOV      r0,r5                 ;2334
000042  e7ef              B        |L3.36|
;;;2336   
                          ENDP

                  |L3.68|
                          DCD      0x40012c34

                          AREA ||i.CmdResp3Error||, CODE, READONLY, ALIGN=2

                  CmdResp3Error PROC
;;;2277     */
;;;2278   static SD_Error CmdResp3Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2279   {
;;;2280     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2281     uint32_t status;
;;;2282   
;;;2283     status = SDIO->STA;
000004  480b              LDR      r0,|L4.52|
000006  6804              LDR      r4,[r0,#0]
;;;2284   
;;;2285     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
000008  e001              B        |L4.14|
                  |L4.10|
;;;2286     {
;;;2287       status = SDIO->STA;
00000a  480a              LDR      r0,|L4.52|
00000c  6804              LDR      r4,[r0,#0]
                  |L4.14|
00000e  f0140f45          TST      r4,#0x45              ;2285
000012  d0fa              BEQ      |L4.10|
;;;2288     }
;;;2289   
;;;2290     if (status & SDIO_FLAG_CTIMEOUT)
000014  f0140f04          TST      r4,#4
000018  d005              BEQ      |L4.38|
;;;2291     {
;;;2292       errorstatus = SD_CMD_RSP_TIMEOUT;
00001a  2503              MOVS     r5,#3
;;;2293       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
00001c  2004              MOVS     r0,#4
00001e  f7fffffe          BL       SDIO_ClearFlag
;;;2294       return(errorstatus);
000022  4628              MOV      r0,r5
                  |L4.36|
;;;2295     }
;;;2296     /*!< Clear all the static flags */
;;;2297     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2298     return(errorstatus);
;;;2299   }
000024  bd70              POP      {r4-r6,pc}
                  |L4.38|
000026  f24050ff          MOV      r0,#0x5ff             ;2297
00002a  f7fffffe          BL       SDIO_ClearFlag
00002e  4628              MOV      r0,r5                 ;2298
000030  e7f8              B        |L4.36|
;;;2300   
                          ENDP

000032  0000              DCW      0x0000
                  |L4.52|
                          DCD      0x40012c34

                          AREA ||i.CmdResp6Error||, CODE, READONLY, ALIGN=2

                  CmdResp6Error PROC
;;;2343     */
;;;2344   static SD_Error CmdResp6Error(uint8_t cmd, uint16_t *prca)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;2345   {
000004  4606              MOV      r6,r0
000006  460f              MOV      r7,r1
;;;2346     SD_Error errorstatus = SD_OK;
000008  f04f0800          MOV      r8,#0
;;;2347     uint32_t status;
;;;2348     uint32_t response_r1;
;;;2349   
;;;2350     status = SDIO->STA;
00000c  4822              LDR      r0,|L5.152|
00000e  6805              LDR      r5,[r0,#0]
;;;2351   
;;;2352     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CTIMEOUT | SDIO_FLAG_CMDREND)))
000010  e001              B        |L5.22|
                  |L5.18|
;;;2353     {
;;;2354       status = SDIO->STA;
000012  4821              LDR      r0,|L5.152|
000014  6805              LDR      r5,[r0,#0]
                  |L5.22|
000016  f0150f45          TST      r5,#0x45              ;2352
00001a  d0fa              BEQ      |L5.18|
;;;2355     }
;;;2356   
;;;2357     if (status & SDIO_FLAG_CTIMEOUT)
00001c  f0150f04          TST      r5,#4
000020  d007              BEQ      |L5.50|
;;;2358     {
;;;2359       errorstatus = SD_CMD_RSP_TIMEOUT;
000022  f04f0803          MOV      r8,#3
;;;2360       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000026  2004              MOVS     r0,#4
000028  f7fffffe          BL       SDIO_ClearFlag
;;;2361       return(errorstatus);
00002c  4640              MOV      r0,r8
                  |L5.46|
;;;2362     }
;;;2363     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2364     {
;;;2365       errorstatus = SD_CMD_CRC_FAIL;
;;;2366       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2367       return(errorstatus);
;;;2368     }
;;;2369   
;;;2370     /*!< Check response received is of desired command */
;;;2371     if (SDIO_GetCommandResponse() != cmd)
;;;2372     {
;;;2373       errorstatus = SD_ILLEGAL_CMD;
;;;2374       return(errorstatus);
;;;2375     }
;;;2376   
;;;2377     /*!< Clear all the static flags */
;;;2378     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2379   
;;;2380     /*!< We have received response, retrieve it.  */
;;;2381     response_r1 = SDIO_GetResponse(SDIO_RESP1);
;;;2382   
;;;2383     if (SD_ALLZERO == (response_r1 & (SD_R6_GENERAL_UNKNOWN_ERROR | SD_R6_ILLEGAL_CMD | SD_R6_COM_CRC_FAILED)))
;;;2384     {
;;;2385       *prca = (uint16_t) (response_r1 >> 16);
;;;2386       return(errorstatus);
;;;2387     }
;;;2388   
;;;2389     if (response_r1 & SD_R6_GENERAL_UNKNOWN_ERROR)
;;;2390     {
;;;2391       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2392     }
;;;2393   
;;;2394     if (response_r1 & SD_R6_ILLEGAL_CMD)
;;;2395     {
;;;2396       return(SD_ILLEGAL_CMD);
;;;2397     }
;;;2398   
;;;2399     if (response_r1 & SD_R6_COM_CRC_FAILED)
;;;2400     {
;;;2401       return(SD_COM_CRC_FAILED);
;;;2402     }
;;;2403   
;;;2404     return(errorstatus);
;;;2405   }
00002e  e8bd81f0          POP      {r4-r8,pc}
                  |L5.50|
000032  f0150f01          TST      r5,#1                 ;2363
000036  d006              BEQ      |L5.70|
000038  f04f0801          MOV      r8,#1                 ;2365
00003c  2001              MOVS     r0,#1                 ;2366
00003e  f7fffffe          BL       SDIO_ClearFlag
000042  4640              MOV      r0,r8                 ;2367
000044  e7f3              B        |L5.46|
                  |L5.70|
000046  f7fffffe          BL       SDIO_GetCommandResponse
00004a  42b0              CMP      r0,r6                 ;2371
00004c  d003              BEQ      |L5.86|
00004e  f04f0810          MOV      r8,#0x10              ;2373
000052  4640              MOV      r0,r8                 ;2374
000054  e7eb              B        |L5.46|
                  |L5.86|
000056  f24050ff          MOV      r0,#0x5ff             ;2378
00005a  f7fffffe          BL       SDIO_ClearFlag
00005e  2000              MOVS     r0,#0                 ;2381
000060  f7fffffe          BL       SDIO_GetResponse
000064  4604              MOV      r4,r0                 ;2381
000066  f4144f60          TST      r4,#0xe000            ;2383
00006a  d103              BNE      |L5.116|
00006c  0c20              LSRS     r0,r4,#16             ;2385
00006e  8038              STRH     r0,[r7,#0]            ;2385
000070  4640              MOV      r0,r8                 ;2386
000072  e7dc              B        |L5.46|
                  |L5.116|
000074  f4145f00          TST      r4,#0x2000            ;2389
000078  d001              BEQ      |L5.126|
00007a  2013              MOVS     r0,#0x13              ;2391
00007c  e7d7              B        |L5.46|
                  |L5.126|
00007e  f4144f80          TST      r4,#0x4000            ;2394
000082  d001              BEQ      |L5.136|
000084  2010              MOVS     r0,#0x10              ;2396
000086  e7d2              B        |L5.46|
                  |L5.136|
000088  f4144f00          TST      r4,#0x8000            ;2399
00008c  d001              BEQ      |L5.146|
00008e  200f              MOVS     r0,#0xf               ;2401
000090  e7cd              B        |L5.46|
                  |L5.146|
000092  4640              MOV      r0,r8                 ;2404
000094  e7cb              B        |L5.46|
;;;2406   
                          ENDP

000096  0000              DCW      0x0000
                  |L5.152|
                          DCD      0x40012c34

                          AREA ||i.CmdResp7Error||, CODE, READONLY, ALIGN=2

                  CmdResp7Error PROC
;;;2094     */
;;;2095   static SD_Error CmdResp7Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2096   {
;;;2097     SD_Error errorstatus = SD_OK;
000002  2600              MOVS     r6,#0
;;;2098     uint32_t status;
;;;2099     uint32_t timeout = SDIO_CMD0TIMEOUT;
000004  f44f3580          MOV      r5,#0x10000
;;;2100   
;;;2101     status = SDIO->STA;
000008  480f              LDR      r0,|L6.72|
00000a  6804              LDR      r4,[r0,#0]
;;;2102   
;;;2103     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)) && (timeout > 0))
00000c  e002              B        |L6.20|
                  |L6.14|
;;;2104     {
;;;2105       timeout--;
00000e  1e6d              SUBS     r5,r5,#1
;;;2106       status = SDIO->STA;
000010  480d              LDR      r0,|L6.72|
000012  6804              LDR      r4,[r0,#0]
                  |L6.20|
000014  f0140f45          TST      r4,#0x45              ;2103
000018  d101              BNE      |L6.30|
00001a  2d00              CMP      r5,#0                 ;2103
00001c  d1f7              BNE      |L6.14|
                  |L6.30|
;;;2107     }
;;;2108   
;;;2109     if ((timeout == 0) || (status & SDIO_FLAG_CTIMEOUT))
00001e  b115              CBZ      r5,|L6.38|
000020  f0140f04          TST      r4,#4
000024  d005              BEQ      |L6.50|
                  |L6.38|
;;;2110     {
;;;2111       /*!< Card is not V2.0 complient or card does not support the set voltage range */
;;;2112       errorstatus = SD_CMD_RSP_TIMEOUT;
000026  2603              MOVS     r6,#3
;;;2113       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000028  2004              MOVS     r0,#4
00002a  f7fffffe          BL       SDIO_ClearFlag
;;;2114       return(errorstatus);
00002e  4630              MOV      r0,r6
                  |L6.48|
;;;2115     }
;;;2116   
;;;2117     if (status & SDIO_FLAG_CMDREND)
;;;2118     {
;;;2119       /*!< Card is SD V2.0 compliant */
;;;2120       errorstatus = SD_OK;
;;;2121       SDIO_ClearFlag(SDIO_FLAG_CMDREND);
;;;2122       return(errorstatus);
;;;2123     }
;;;2124     return(errorstatus);
;;;2125   }
000030  bd70              POP      {r4-r6,pc}
                  |L6.50|
000032  f0140f40          TST      r4,#0x40              ;2117
000036  d005              BEQ      |L6.68|
000038  2600              MOVS     r6,#0                 ;2120
00003a  2040              MOVS     r0,#0x40              ;2121
00003c  f7fffffe          BL       SDIO_ClearFlag
000040  4630              MOV      r0,r6                 ;2122
000042  e7f5              B        |L6.48|
                  |L6.68|
000044  4630              MOV      r0,r6                 ;2124
000046  e7f3              B        |L6.48|
;;;2126   
                          ENDP

                  |L6.72|
                          DCD      0x40012c34

                          AREA ||i.FindSCR||, CODE, READONLY, ALIGN=2

                  FindSCR PROC
;;;2685     */
;;;2686   static SD_Error FindSCR(uint16_t rca, uint32_t *pscr)
000000  e92d41fc          PUSH     {r2-r8,lr}
;;;2687   {
000004  4607              MOV      r7,r0
000006  460d              MOV      r5,r1
;;;2688     uint32_t index = 0;
000008  2600              MOVS     r6,#0
;;;2689     SD_Error errorstatus = SD_OK;
00000a  2400              MOVS     r4,#0
;;;2690     uint32_t tempscr[2] = {0, 0};
00000c  2000              MOVS     r0,#0
00000e  9000              STR      r0,[sp,#0]
000010  9001              STR      r0,[sp,#4]
;;;2691   
;;;2692     /*!< Set Block Size To 8 Bytes */
;;;2693     /*!< Send CMD55 APP_CMD with argument as card's RCA */
;;;2694     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)8;
000012  2008              MOVS     r0,#8
000014  495a              LDR      r1,|L7.384|
000016  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;2695     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000018  2010              MOVS     r0,#0x10
00001a  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;2696     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00001c  2040              MOVS     r0,#0x40
00001e  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;2697     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000020  2000              MOVS     r0,#0
000022  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;2698     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000024  f44f6080          MOV      r0,#0x400
000028  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;2699     SDIO_SendCommand(&SDIO_CmdInitStructure);
00002a  4608              MOV      r0,r1
00002c  f7fffffe          BL       SDIO_SendCommand
;;;2700   
;;;2701     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000030  2010              MOVS     r0,#0x10
000032  f7fffffe          BL       CmdResp1Error
000036  4604              MOV      r4,r0
;;;2702   
;;;2703     if (errorstatus != SD_OK)
000038  b114              CBZ      r4,|L7.64|
;;;2704     {
;;;2705       return(errorstatus);
00003a  4620              MOV      r0,r4
                  |L7.60|
;;;2706     }
;;;2707   
;;;2708     /*!< Send CMD55 APP_CMD with argument as card's RCA */
;;;2709     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2710     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2711     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2712     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2713     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2714     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2715   
;;;2716     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2717   
;;;2718     if (errorstatus != SD_OK)
;;;2719     {
;;;2720       return(errorstatus);
;;;2721     }
;;;2722     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;2723     SDIO_DataInitStructure.SDIO_DataLength = 8;
;;;2724     SDIO_DataInitStructure.SDIO_DataBlockSize = SDIO_DataBlockSize_8b;
;;;2725     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;2726     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;2727     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;2728     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;2729   
;;;2730   
;;;2731     /*!< Send ACMD51 SD_APP_SEND_SCR with argument as 0 */
;;;2732     SDIO_CmdInitStructure.SDIO_Argument = 0x0;
;;;2733     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_SEND_SCR;
;;;2734     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2735     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2736     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2737     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2738   
;;;2739     errorstatus = CmdResp1Error(SD_CMD_SD_APP_SEND_SCR);
;;;2740   
;;;2741     if (errorstatus != SD_OK)
;;;2742     {
;;;2743       return(errorstatus);
;;;2744     }
;;;2745   
;;;2746     while (!(SDIO->STA & (SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;2747     {
;;;2748       if (SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET)
;;;2749       {
;;;2750         *(tempscr + index) = SDIO_ReadData();
;;;2751         index++;
;;;2752       }
;;;2753     }
;;;2754   
;;;2755     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;2756     {
;;;2757       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;2758       errorstatus = SD_DATA_TIMEOUT;
;;;2759       return(errorstatus);
;;;2760     }
;;;2761     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;2762     {
;;;2763       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;2764       errorstatus = SD_DATA_CRC_FAIL;
;;;2765       return(errorstatus);
;;;2766     }
;;;2767     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;2768     {
;;;2769       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;2770       errorstatus = SD_RX_OVERRUN;
;;;2771       return(errorstatus);
;;;2772     }
;;;2773     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;2774     {
;;;2775       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;2776       errorstatus = SD_START_BIT_ERR;
;;;2777       return(errorstatus);
;;;2778     }
;;;2779   
;;;2780     /*!< Clear all the static flags */
;;;2781     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2782   
;;;2783     *(pscr + 1) = ((tempscr[0] & SD_0TO7BITS) << 24) | ((tempscr[0] & SD_8TO15BITS) << 8) | ((tempscr[0] & SD_16TO23BITS) >> 8) | ((tempscr[0] & SD_24TO31BITS) >> 24);
;;;2784   
;;;2785     *(pscr) = ((tempscr[1] & SD_0TO7BITS) << 24) | ((tempscr[1] & SD_8TO15BITS) << 8) | ((tempscr[1] & SD_16TO23BITS) >> 8) | ((tempscr[1] & SD_24TO31BITS) >> 24);
;;;2786   
;;;2787     return(errorstatus);
;;;2788   }
00003c  e8bd81fc          POP      {r2-r8,pc}
                  |L7.64|
000040  4850              LDR      r0,|L7.388|
000042  8800              LDRH     r0,[r0,#0]            ;2709  ; RCA
000044  0400              LSLS     r0,r0,#16             ;2709
000046  494e              LDR      r1,|L7.384|
000048  6008              STR      r0,[r1,#0]            ;2709  ; SDIO_CmdInitStructure
00004a  2037              MOVS     r0,#0x37              ;2710
00004c  6048              STR      r0,[r1,#4]            ;2710  ; SDIO_CmdInitStructure
00004e  2040              MOVS     r0,#0x40              ;2711
000050  6088              STR      r0,[r1,#8]            ;2711  ; SDIO_CmdInitStructure
000052  2000              MOVS     r0,#0                 ;2712
000054  60c8              STR      r0,[r1,#0xc]          ;2712  ; SDIO_CmdInitStructure
000056  f44f6080          MOV      r0,#0x400             ;2713
00005a  6108              STR      r0,[r1,#0x10]         ;2713  ; SDIO_CmdInitStructure
00005c  4608              MOV      r0,r1                 ;2714
00005e  f7fffffe          BL       SDIO_SendCommand
000062  2037              MOVS     r0,#0x37              ;2716
000064  f7fffffe          BL       CmdResp1Error
000068  4604              MOV      r4,r0                 ;2716
00006a  b10c              CBZ      r4,|L7.112|
00006c  4620              MOV      r0,r4                 ;2720
00006e  e7e5              B        |L7.60|
                  |L7.112|
000070  f04f30ff          MOV      r0,#0xffffffff        ;2722
000074  4944              LDR      r1,|L7.392|
000076  6008              STR      r0,[r1,#0]            ;2722  ; SDIO_DataInitStructure
000078  2008              MOVS     r0,#8                 ;2723
00007a  6048              STR      r0,[r1,#4]            ;2723  ; SDIO_DataInitStructure
00007c  2030              MOVS     r0,#0x30              ;2724
00007e  6088              STR      r0,[r1,#8]            ;2724  ; SDIO_DataInitStructure
000080  2002              MOVS     r0,#2                 ;2725
000082  60c8              STR      r0,[r1,#0xc]          ;2725  ; SDIO_DataInitStructure
000084  2000              MOVS     r0,#0                 ;2726
000086  6108              STR      r0,[r1,#0x10]         ;2726  ; SDIO_DataInitStructure
000088  2001              MOVS     r0,#1                 ;2727
00008a  6148              STR      r0,[r1,#0x14]         ;2727  ; SDIO_DataInitStructure
00008c  4608              MOV      r0,r1                 ;2728
00008e  f7fffffe          BL       SDIO_DataConfig
000092  2000              MOVS     r0,#0                 ;2732
000094  493a              LDR      r1,|L7.384|
000096  6008              STR      r0,[r1,#0]            ;2732  ; SDIO_CmdInitStructure
000098  2033              MOVS     r0,#0x33              ;2733
00009a  6048              STR      r0,[r1,#4]            ;2733  ; SDIO_CmdInitStructure
00009c  2040              MOVS     r0,#0x40              ;2734
00009e  6088              STR      r0,[r1,#8]            ;2734  ; SDIO_CmdInitStructure
0000a0  2000              MOVS     r0,#0                 ;2735
0000a2  60c8              STR      r0,[r1,#0xc]          ;2735  ; SDIO_CmdInitStructure
0000a4  f44f6080          MOV      r0,#0x400             ;2736
0000a8  6108              STR      r0,[r1,#0x10]         ;2736  ; SDIO_CmdInitStructure
0000aa  4608              MOV      r0,r1                 ;2737
0000ac  f7fffffe          BL       SDIO_SendCommand
0000b0  2033              MOVS     r0,#0x33              ;2739
0000b2  f7fffffe          BL       CmdResp1Error
0000b6  4604              MOV      r4,r0                 ;2739
0000b8  b10c              CBZ      r4,|L7.190|
0000ba  4620              MOV      r0,r4                 ;2743
0000bc  e7be              B        |L7.60|
                  |L7.190|
0000be  e009              B        |L7.212|
                  |L7.192|
0000c0  f44f1000          MOV      r0,#0x200000          ;2748
0000c4  f7fffffe          BL       SDIO_GetFlagStatus
0000c8  b120              CBZ      r0,|L7.212|
0000ca  f7fffffe          BL       SDIO_ReadData
0000ce  f84d0026          STR      r0,[sp,r6,LSL #2]     ;2750
0000d2  1c76              ADDS     r6,r6,#1              ;2751
                  |L7.212|
0000d4  482d              LDR      r0,|L7.396|
0000d6  6800              LDR      r0,[r0,#0]            ;2746
0000d8  f240612a          MOV      r1,#0x62a             ;2746
0000dc  4208              TST      r0,r1                 ;2746
0000de  d0ef              BEQ      |L7.192|
0000e0  2008              MOVS     r0,#8                 ;2755
0000e2  f7fffffe          BL       SDIO_GetFlagStatus
0000e6  b128              CBZ      r0,|L7.244|
0000e8  2008              MOVS     r0,#8                 ;2757
0000ea  f7fffffe          BL       SDIO_ClearFlag
0000ee  2404              MOVS     r4,#4                 ;2758
0000f0  4620              MOV      r0,r4                 ;2759
0000f2  e7a3              B        |L7.60|
                  |L7.244|
0000f4  2002              MOVS     r0,#2                 ;2761
0000f6  f7fffffe          BL       SDIO_GetFlagStatus
0000fa  b128              CBZ      r0,|L7.264|
0000fc  2002              MOVS     r0,#2                 ;2763
0000fe  f7fffffe          BL       SDIO_ClearFlag
000102  2402              MOVS     r4,#2                 ;2764
000104  4620              MOV      r0,r4                 ;2765
000106  e799              B        |L7.60|
                  |L7.264|
000108  2020              MOVS     r0,#0x20              ;2767
00010a  f7fffffe          BL       SDIO_GetFlagStatus
00010e  b128              CBZ      r0,|L7.284|
000110  2020              MOVS     r0,#0x20              ;2769
000112  f7fffffe          BL       SDIO_ClearFlag
000116  2406              MOVS     r4,#6                 ;2770
000118  4620              MOV      r0,r4                 ;2771
00011a  e78f              B        |L7.60|
                  |L7.284|
00011c  f44f7000          MOV      r0,#0x200             ;2773
000120  f7fffffe          BL       SDIO_GetFlagStatus
000124  b130              CBZ      r0,|L7.308|
000126  f44f7000          MOV      r0,#0x200             ;2775
00012a  f7fffffe          BL       SDIO_ClearFlag
00012e  2407              MOVS     r4,#7                 ;2776
000130  4620              MOV      r0,r4                 ;2777
000132  e783              B        |L7.60|
                  |L7.308|
000134  f24050ff          MOV      r0,#0x5ff             ;2781
000138  f7fffffe          BL       SDIO_ClearFlag
00013c  9800              LDR      r0,[sp,#0]            ;2783
00013e  0600              LSLS     r0,r0,#24             ;2783
000140  9900              LDR      r1,[sp,#0]            ;2783
000142  f401417f          AND      r1,r1,#0xff00         ;2783
000146  ea402001          ORR      r0,r0,r1,LSL #8       ;2783
00014a  9900              LDR      r1,[sp,#0]            ;2783
00014c  f401017f          AND      r1,r1,#0xff0000       ;2783
000150  ea402011          ORR      r0,r0,r1,LSR #8       ;2783
000154  9900              LDR      r1,[sp,#0]            ;2783
000156  ea406011          ORR      r0,r0,r1,LSR #24      ;2783
00015a  6068              STR      r0,[r5,#4]            ;2783
00015c  9801              LDR      r0,[sp,#4]            ;2785
00015e  0600              LSLS     r0,r0,#24             ;2785
000160  9901              LDR      r1,[sp,#4]            ;2785
000162  f401417f          AND      r1,r1,#0xff00         ;2785
000166  ea402001          ORR      r0,r0,r1,LSL #8       ;2785
00016a  9901              LDR      r1,[sp,#4]            ;2785
00016c  f401017f          AND      r1,r1,#0xff0000       ;2785
000170  ea402011          ORR      r0,r0,r1,LSR #8       ;2785
000174  9901              LDR      r1,[sp,#4]            ;2785
000176  ea406011          ORR      r0,r0,r1,LSR #24      ;2785
00017a  6028              STR      r0,[r5,#0]            ;2785
00017c  4620              MOV      r0,r4                 ;2787
00017e  e75d              B        |L7.60|
;;;2789   
                          ENDP

                  |L7.384|
                          DCD      SDIO_CmdInitStructure
                  |L7.388|
                          DCD      ||RCA||
                  |L7.392|
                          DCD      SDIO_DataInitStructure
                  |L7.396|
                          DCD      0x40012c34

                          AREA ||i.IsCardProgramming||, CODE, READONLY, ALIGN=2

                  IsCardProgramming PROC
;;;2526     */
;;;2527   static SD_Error IsCardProgramming(uint8_t *pstatus)
000000  b57c              PUSH     {r2-r6,lr}
;;;2528   {
000002  4604              MOV      r4,r0
;;;2529     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;2530     __IO uint32_t respR1 = 0, status = 0;
000006  2000              MOVS     r0,#0
000008  9001              STR      r0,[sp,#4]
00000a  9000              STR      r0,[sp,#0]
;;;2531   
;;;2532     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
00000c  485f              LDR      r0,|L8.396|
00000e  8800              LDRH     r0,[r0,#0]  ; RCA
000010  0400              LSLS     r0,r0,#16
000012  495f              LDR      r1,|L8.400|
000014  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;2533     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_STATUS;
000016  200d              MOVS     r0,#0xd
000018  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;2534     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00001a  2040              MOVS     r0,#0x40
00001c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;2535     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00001e  2000              MOVS     r0,#0
000020  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;2536     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000022  f44f6080          MOV      r0,#0x400
000026  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;2537     SDIO_SendCommand(&SDIO_CmdInitStructure);
000028  4608              MOV      r0,r1
00002a  f7fffffe          BL       SDIO_SendCommand
;;;2538   
;;;2539     status = SDIO->STA;
00002e  4859              LDR      r0,|L8.404|
000030  6800              LDR      r0,[r0,#0]
000032  9000              STR      r0,[sp,#0]
;;;2540     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
000034  e002              B        |L8.60|
                  |L8.54|
;;;2541     {
;;;2542       status = SDIO->STA;
000036  4857              LDR      r0,|L8.404|
000038  6800              LDR      r0,[r0,#0]
00003a  9000              STR      r0,[sp,#0]
                  |L8.60|
00003c  9800              LDR      r0,[sp,#0]            ;2540
00003e  f0100f45          TST      r0,#0x45              ;2540
000042  d0f8              BEQ      |L8.54|
;;;2543     }
;;;2544   
;;;2545     if (status & SDIO_FLAG_CTIMEOUT)
000044  9800              LDR      r0,[sp,#0]
000046  f0100f04          TST      r0,#4
00004a  d005              BEQ      |L8.88|
;;;2546     {
;;;2547       errorstatus = SD_CMD_RSP_TIMEOUT;
00004c  2503              MOVS     r5,#3
;;;2548       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
00004e  2004              MOVS     r0,#4
000050  f7fffffe          BL       SDIO_ClearFlag
;;;2549       return(errorstatus);
000054  4628              MOV      r0,r5
                  |L8.86|
;;;2550     }
;;;2551     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2552     {
;;;2553       errorstatus = SD_CMD_CRC_FAIL;
;;;2554       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2555       return(errorstatus);
;;;2556     }
;;;2557   
;;;2558     status = (uint32_t)SDIO_GetCommandResponse();
;;;2559   
;;;2560     /*!< Check response received is of desired command */
;;;2561     if (status != SD_CMD_SEND_STATUS)
;;;2562     {
;;;2563       errorstatus = SD_ILLEGAL_CMD;
;;;2564       return(errorstatus);
;;;2565     }
;;;2566   
;;;2567     /*!< Clear all the static flags */
;;;2568     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2569   
;;;2570   
;;;2571     /*!< We have received response, retrieve it for analysis  */
;;;2572     respR1 = SDIO_GetResponse(SDIO_RESP1);
;;;2573   
;;;2574     /*!< Find out card status */
;;;2575     *pstatus = (uint8_t) ((respR1 >> 9) & 0x0000000F);
;;;2576   
;;;2577     if ((respR1 & SD_OCR_ERRORBITS) == SD_ALLZERO)
;;;2578     {
;;;2579       return(errorstatus);
;;;2580     }
;;;2581   
;;;2582     if (respR1 & SD_OCR_ADDR_OUT_OF_RANGE)
;;;2583     {
;;;2584       return(SD_ADDR_OUT_OF_RANGE);
;;;2585     }
;;;2586   
;;;2587     if (respR1 & SD_OCR_ADDR_MISALIGNED)
;;;2588     {
;;;2589       return(SD_ADDR_MISALIGNED);
;;;2590     }
;;;2591   
;;;2592     if (respR1 & SD_OCR_BLOCK_LEN_ERR)
;;;2593     {
;;;2594       return(SD_BLOCK_LEN_ERR);
;;;2595     }
;;;2596   
;;;2597     if (respR1 & SD_OCR_ERASE_SEQ_ERR)
;;;2598     {
;;;2599       return(SD_ERASE_SEQ_ERR);
;;;2600     }
;;;2601   
;;;2602     if (respR1 & SD_OCR_BAD_ERASE_PARAM)
;;;2603     {
;;;2604       return(SD_BAD_ERASE_PARAM);
;;;2605     }
;;;2606   
;;;2607     if (respR1 & SD_OCR_WRITE_PROT_VIOLATION)
;;;2608     {
;;;2609       return(SD_WRITE_PROT_VIOLATION);
;;;2610     }
;;;2611   
;;;2612     if (respR1 & SD_OCR_LOCK_UNLOCK_FAILED)
;;;2613     {
;;;2614       return(SD_LOCK_UNLOCK_FAILED);
;;;2615     }
;;;2616   
;;;2617     if (respR1 & SD_OCR_COM_CRC_FAILED)
;;;2618     {
;;;2619       return(SD_COM_CRC_FAILED);
;;;2620     }
;;;2621   
;;;2622     if (respR1 & SD_OCR_ILLEGAL_CMD)
;;;2623     {
;;;2624       return(SD_ILLEGAL_CMD);
;;;2625     }
;;;2626   
;;;2627     if (respR1 & SD_OCR_CARD_ECC_FAILED)
;;;2628     {
;;;2629       return(SD_CARD_ECC_FAILED);
;;;2630     }
;;;2631   
;;;2632     if (respR1 & SD_OCR_CC_ERROR)
;;;2633     {
;;;2634       return(SD_CC_ERROR);
;;;2635     }
;;;2636   
;;;2637     if (respR1 & SD_OCR_GENERAL_UNKNOWN_ERROR)
;;;2638     {
;;;2639       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2640     }
;;;2641   
;;;2642     if (respR1 & SD_OCR_STREAM_READ_UNDERRUN)
;;;2643     {
;;;2644       return(SD_STREAM_READ_UNDERRUN);
;;;2645     }
;;;2646   
;;;2647     if (respR1 & SD_OCR_STREAM_WRITE_OVERRUN)
;;;2648     {
;;;2649       return(SD_STREAM_WRITE_OVERRUN);
;;;2650     }
;;;2651   
;;;2652     if (respR1 & SD_OCR_CID_CSD_OVERWRIETE)
;;;2653     {
;;;2654       return(SD_CID_CSD_OVERWRITE);
;;;2655     }
;;;2656   
;;;2657     if (respR1 & SD_OCR_WP_ERASE_SKIP)
;;;2658     {
;;;2659       return(SD_WP_ERASE_SKIP);
;;;2660     }
;;;2661   
;;;2662     if (respR1 & SD_OCR_CARD_ECC_DISABLED)
;;;2663     {
;;;2664       return(SD_CARD_ECC_DISABLED);
;;;2665     }
;;;2666   
;;;2667     if (respR1 & SD_OCR_ERASE_RESET)
;;;2668     {
;;;2669       return(SD_ERASE_RESET);
;;;2670     }
;;;2671   
;;;2672     if (respR1 & SD_OCR_AKE_SEQ_ERROR)
;;;2673     {
;;;2674       return(SD_AKE_SEQ_ERROR);
;;;2675     }
;;;2676   
;;;2677     return(errorstatus);
;;;2678   }
000056  bd7c              POP      {r2-r6,pc}
                  |L8.88|
000058  9800              LDR      r0,[sp,#0]            ;2551
00005a  f0100f01          TST      r0,#1                 ;2551
00005e  d005              BEQ      |L8.108|
000060  2501              MOVS     r5,#1                 ;2553
000062  2001              MOVS     r0,#1                 ;2554
000064  f7fffffe          BL       SDIO_ClearFlag
000068  4628              MOV      r0,r5                 ;2555
00006a  e7f4              B        |L8.86|
                  |L8.108|
00006c  f7fffffe          BL       SDIO_GetCommandResponse
000070  9000              STR      r0,[sp,#0]            ;2558
000072  9800              LDR      r0,[sp,#0]            ;2561
000074  280d              CMP      r0,#0xd               ;2561
000076  d002              BEQ      |L8.126|
000078  2510              MOVS     r5,#0x10              ;2563
00007a  4628              MOV      r0,r5                 ;2564
00007c  e7eb              B        |L8.86|
                  |L8.126|
00007e  f24050ff          MOV      r0,#0x5ff             ;2568
000082  f7fffffe          BL       SDIO_ClearFlag
000086  2000              MOVS     r0,#0                 ;2572
000088  f7fffffe          BL       SDIO_GetResponse
00008c  9001              STR      r0,[sp,#4]            ;2572
00008e  9801              LDR      r0,[sp,#4]            ;2575
000090  f3c02043          UBFX     r0,r0,#9,#4           ;2575
000094  7020              STRB     r0,[r4,#0]            ;2575
000096  4940              LDR      r1,|L8.408|
000098  9801              LDR      r0,[sp,#4]            ;2577
00009a  4208              TST      r0,r1                 ;2577
00009c  d101              BNE      |L8.162|
00009e  4628              MOV      r0,r5                 ;2579
0000a0  e7d9              B        |L8.86|
                  |L8.162|
0000a2  9801              LDR      r0,[sp,#4]            ;2582
0000a4  f0104f00          TST      r0,#0x80000000        ;2582
0000a8  d001              BEQ      |L8.174|
0000aa  201c              MOVS     r0,#0x1c              ;2584
0000ac  e7d3              B        |L8.86|
                  |L8.174|
0000ae  9801              LDR      r0,[sp,#4]            ;2587
0000b0  f0104f80          TST      r0,#0x40000000        ;2587
0000b4  d001              BEQ      |L8.186|
0000b6  2009              MOVS     r0,#9                 ;2589
0000b8  e7cd              B        |L8.86|
                  |L8.186|
0000ba  9801              LDR      r0,[sp,#4]            ;2592
0000bc  f0105f00          TST      r0,#0x20000000        ;2592
0000c0  d001              BEQ      |L8.198|
0000c2  200a              MOVS     r0,#0xa               ;2594
0000c4  e7c7              B        |L8.86|
                  |L8.198|
0000c6  9801              LDR      r0,[sp,#4]            ;2597
0000c8  f0105f80          TST      r0,#0x10000000        ;2597
0000cc  d001              BEQ      |L8.210|
0000ce  200b              MOVS     r0,#0xb               ;2599
0000d0  e7c1              B        |L8.86|
                  |L8.210|
0000d2  9801              LDR      r0,[sp,#4]            ;2602
0000d4  f0106f00          TST      r0,#0x8000000         ;2602
0000d8  d001              BEQ      |L8.222|
0000da  200c              MOVS     r0,#0xc               ;2604
0000dc  e7bb              B        |L8.86|
                  |L8.222|
0000de  9801              LDR      r0,[sp,#4]            ;2607
0000e0  f0106f80          TST      r0,#0x4000000         ;2607
0000e4  d001              BEQ      |L8.234|
0000e6  200d              MOVS     r0,#0xd               ;2609
0000e8  e7b5              B        |L8.86|
                  |L8.234|
0000ea  9801              LDR      r0,[sp,#4]            ;2612
0000ec  f0107f80          TST      r0,#0x1000000         ;2612
0000f0  d001              BEQ      |L8.246|
0000f2  200e              MOVS     r0,#0xe               ;2614
0000f4  e7af              B        |L8.86|
                  |L8.246|
0000f6  9801              LDR      r0,[sp,#4]            ;2617
0000f8  f4100f00          TST      r0,#0x800000          ;2617
0000fc  d001              BEQ      |L8.258|
0000fe  200f              MOVS     r0,#0xf               ;2619
000100  e7a9              B        |L8.86|
                  |L8.258|
000102  9801              LDR      r0,[sp,#4]            ;2622
000104  f4100f80          TST      r0,#0x400000          ;2622
000108  d001              BEQ      |L8.270|
00010a  2010              MOVS     r0,#0x10              ;2624
00010c  e7a3              B        |L8.86|
                  |L8.270|
00010e  9801              LDR      r0,[sp,#4]            ;2627
000110  f4101f00          TST      r0,#0x200000          ;2627
000114  d001              BEQ      |L8.282|
000116  2011              MOVS     r0,#0x11              ;2629
000118  e79d              B        |L8.86|
                  |L8.282|
00011a  9801              LDR      r0,[sp,#4]            ;2632
00011c  f4101f80          TST      r0,#0x100000          ;2632
000120  d001              BEQ      |L8.294|
000122  2012              MOVS     r0,#0x12              ;2634
000124  e797              B        |L8.86|
                  |L8.294|
000126  9801              LDR      r0,[sp,#4]            ;2637
000128  f4102f00          TST      r0,#0x80000           ;2637
00012c  d001              BEQ      |L8.306|
00012e  2013              MOVS     r0,#0x13              ;2639
000130  e791              B        |L8.86|
                  |L8.306|
000132  9801              LDR      r0,[sp,#4]            ;2642
000134  f4102f80          TST      r0,#0x40000           ;2642
000138  d001              BEQ      |L8.318|
00013a  2014              MOVS     r0,#0x14              ;2644
00013c  e78b              B        |L8.86|
                  |L8.318|
00013e  9801              LDR      r0,[sp,#4]            ;2647
000140  f4103f00          TST      r0,#0x20000           ;2647
000144  d001              BEQ      |L8.330|
000146  2015              MOVS     r0,#0x15              ;2649
000148  e785              B        |L8.86|
                  |L8.330|
00014a  9801              LDR      r0,[sp,#4]            ;2652
00014c  f4103f80          TST      r0,#0x10000           ;2652
000150  d001              BEQ      |L8.342|
000152  2016              MOVS     r0,#0x16              ;2654
000154  e77f              B        |L8.86|
                  |L8.342|
000156  9801              LDR      r0,[sp,#4]            ;2657
000158  f4104f00          TST      r0,#0x8000            ;2657
00015c  d001              BEQ      |L8.354|
00015e  2017              MOVS     r0,#0x17              ;2659
000160  e779              B        |L8.86|
                  |L8.354|
000162  9801              LDR      r0,[sp,#4]            ;2662
000164  f4104f80          TST      r0,#0x4000            ;2662
000168  d001              BEQ      |L8.366|
00016a  2018              MOVS     r0,#0x18              ;2664
00016c  e773              B        |L8.86|
                  |L8.366|
00016e  9801              LDR      r0,[sp,#4]            ;2667
000170  f4105f00          TST      r0,#0x2000            ;2667
000174  d001              BEQ      |L8.378|
000176  2019              MOVS     r0,#0x19              ;2669
000178  e76d              B        |L8.86|
                  |L8.378|
00017a  9801              LDR      r0,[sp,#4]            ;2672
00017c  f0100f08          TST      r0,#8                 ;2672
000180  d001              BEQ      |L8.390|
000182  201a              MOVS     r0,#0x1a              ;2674
000184  e767              B        |L8.86|
                  |L8.390|
000186  4628              MOV      r0,r5                 ;2677
000188  e765              B        |L8.86|
;;;2679   
                          ENDP

00018a  0000              DCW      0x0000
                  |L8.396|
                          DCD      ||RCA||
                  |L8.400|
                          DCD      SDIO_CmdInitStructure
                  |L8.404|
                          DCD      0x40012c34
                  |L8.408|
                          DCD      0xfdffe008

                          AREA ||i.SDEnWideBus||, CODE, READONLY, ALIGN=2

                  SDEnWideBus PROC
;;;2412     */
;;;2413   static SD_Error SDEnWideBus(FunctionalState NewState)
000000  b57c              PUSH     {r2-r6,lr}
;;;2414   {
000002  4605              MOV      r5,r0
;;;2415     SD_Error errorstatus = SD_OK;
000004  2400              MOVS     r4,#0
;;;2416   
;;;2417     uint32_t scr[2] = {0, 0};
000006  2000              MOVS     r0,#0
000008  9000              STR      r0,[sp,#0]
00000a  9001              STR      r0,[sp,#4]
;;;2418   
;;;2419     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
00000c  f7fffffe          BL       SDIO_GetResponse
000010  f0107f00          TST      r0,#0x2000000
000014  d002              BEQ      |L9.28|
;;;2420     {
;;;2421       errorstatus = SD_LOCK_UNLOCK_FAILED;
000016  240e              MOVS     r4,#0xe
;;;2422       return(errorstatus);
000018  4620              MOV      r0,r4
                  |L9.26|
;;;2423     }
;;;2424   
;;;2425     /*!< Get SCR Register */
;;;2426     errorstatus = FindSCR(RCA, scr);
;;;2427   
;;;2428     if (errorstatus != SD_OK)
;;;2429     {
;;;2430       return(errorstatus);
;;;2431     }
;;;2432   
;;;2433     /*!< If wide bus operation to be enabled */
;;;2434     if (NewState == ENABLE)
;;;2435     {
;;;2436       /*!< If requested card supports wide bus operation */
;;;2437       if ((scr[1] & SD_WIDE_BUS_SUPPORT) != SD_ALLZERO)
;;;2438       {
;;;2439         /*!< Send CMD55 APP_CMD with argument as card's RCA.*/
;;;2440         SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2441         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2442         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2443         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2444         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2445         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2446   
;;;2447         errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2448   
;;;2449         if (errorstatus != SD_OK)
;;;2450         {
;;;2451           return(errorstatus);
;;;2452         }
;;;2453   
;;;2454         /*!< Send ACMD6 APP_CMD with argument as 2 for wide bus mode */
;;;2455         SDIO_CmdInitStructure.SDIO_Argument = 0x2;
;;;2456         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_SD_SET_BUSWIDTH;
;;;2457         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2458         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2459         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2460         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2461   
;;;2462         errorstatus = CmdResp1Error(SD_CMD_APP_SD_SET_BUSWIDTH);
;;;2463   
;;;2464         if (errorstatus != SD_OK)
;;;2465         {
;;;2466           return(errorstatus);
;;;2467         }
;;;2468         return(errorstatus);
;;;2469       }
;;;2470       else
;;;2471       {
;;;2472         errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;2473         return(errorstatus);
;;;2474       }
;;;2475     }   /*!< If wide bus operation to be disabled */
;;;2476     else
;;;2477     {
;;;2478       /*!< If requested card supports 1 bit mode operation */
;;;2479       if ((scr[1] & SD_SINGLE_BUS_SUPPORT) != SD_ALLZERO)
;;;2480       {
;;;2481         /*!< Send CMD55 APP_CMD with argument as card's RCA.*/
;;;2482         SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2483         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2484         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2485         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2486         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2487         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2488   
;;;2489   
;;;2490         errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2491   
;;;2492         if (errorstatus != SD_OK)
;;;2493         {
;;;2494           return(errorstatus);
;;;2495         }
;;;2496   
;;;2497         /*!< Send ACMD6 APP_CMD with argument as 2 for wide bus mode */
;;;2498         SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;2499         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_SD_SET_BUSWIDTH;
;;;2500         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2501         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2502         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2503         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2504   
;;;2505         errorstatus = CmdResp1Error(SD_CMD_APP_SD_SET_BUSWIDTH);
;;;2506   
;;;2507         if (errorstatus != SD_OK)
;;;2508         {
;;;2509           return(errorstatus);
;;;2510         }
;;;2511   
;;;2512         return(errorstatus);
;;;2513       }
;;;2514       else
;;;2515       {
;;;2516         errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;2517         return(errorstatus);
;;;2518       }
;;;2519     }
;;;2520   }
00001a  bd7c              POP      {r2-r6,pc}
                  |L9.28|
00001c  493c              LDR      r1,|L9.272|
00001e  8809              LDRH     r1,[r1,#0]            ;2426  ; RCA
000020  b288              UXTH     r0,r1                 ;2426
000022  4669              MOV      r1,sp                 ;2426
000024  f7fffffe          BL       FindSCR
000028  4604              MOV      r4,r0                 ;2426
00002a  b10c              CBZ      r4,|L9.48|
00002c  4620              MOV      r0,r4                 ;2430
00002e  e7f4              B        |L9.26|
                  |L9.48|
000030  2d01              CMP      r5,#1                 ;2434
000032  d135              BNE      |L9.160|
000034  9801              LDR      r0,[sp,#4]            ;2437
000036  f4102f80          TST      r0,#0x40000           ;2437
00003a  d02e              BEQ      |L9.154|
00003c  4834              LDR      r0,|L9.272|
00003e  8800              LDRH     r0,[r0,#0]            ;2440  ; RCA
000040  0400              LSLS     r0,r0,#16             ;2440
000042  4934              LDR      r1,|L9.276|
000044  6008              STR      r0,[r1,#0]            ;2440  ; SDIO_CmdInitStructure
000046  2037              MOVS     r0,#0x37              ;2441
000048  6048              STR      r0,[r1,#4]            ;2441  ; SDIO_CmdInitStructure
00004a  2040              MOVS     r0,#0x40              ;2442
00004c  6088              STR      r0,[r1,#8]            ;2442  ; SDIO_CmdInitStructure
00004e  2000              MOVS     r0,#0                 ;2443
000050  60c8              STR      r0,[r1,#0xc]          ;2443  ; SDIO_CmdInitStructure
000052  02a8              LSLS     r0,r5,#10             ;2444
000054  6108              STR      r0,[r1,#0x10]         ;2444  ; SDIO_CmdInitStructure
000056  4608              MOV      r0,r1                 ;2445
000058  f7fffffe          BL       SDIO_SendCommand
00005c  2037              MOVS     r0,#0x37              ;2447
00005e  f7fffffe          BL       CmdResp1Error
000062  4604              MOV      r4,r0                 ;2447
000064  b10c              CBZ      r4,|L9.106|
000066  4620              MOV      r0,r4                 ;2451
000068  e7d7              B        |L9.26|
                  |L9.106|
00006a  2002              MOVS     r0,#2                 ;2455
00006c  4929              LDR      r1,|L9.276|
00006e  6008              STR      r0,[r1,#0]            ;2455  ; SDIO_CmdInitStructure
000070  2006              MOVS     r0,#6                 ;2456
000072  6048              STR      r0,[r1,#4]            ;2456  ; SDIO_CmdInitStructure
000074  2040              MOVS     r0,#0x40              ;2457
000076  6088              STR      r0,[r1,#8]            ;2457  ; SDIO_CmdInitStructure
000078  2000              MOVS     r0,#0                 ;2458
00007a  60c8              STR      r0,[r1,#0xc]          ;2458  ; SDIO_CmdInitStructure
00007c  f44f6080          MOV      r0,#0x400             ;2459
000080  6108              STR      r0,[r1,#0x10]         ;2459  ; SDIO_CmdInitStructure
000082  4608              MOV      r0,r1                 ;2460
000084  f7fffffe          BL       SDIO_SendCommand
000088  2006              MOVS     r0,#6                 ;2462
00008a  f7fffffe          BL       CmdResp1Error
00008e  4604              MOV      r4,r0                 ;2462
000090  b10c              CBZ      r4,|L9.150|
000092  4620              MOV      r0,r4                 ;2466
000094  e7c1              B        |L9.26|
                  |L9.150|
000096  4620              MOV      r0,r4                 ;2468
000098  e7bf              B        |L9.26|
                  |L9.154|
00009a  2425              MOVS     r4,#0x25              ;2472
00009c  4620              MOV      r0,r4                 ;2473
00009e  e7bc              B        |L9.26|
                  |L9.160|
0000a0  9801              LDR      r0,[sp,#4]            ;2479
0000a2  f4103f80          TST      r0,#0x10000           ;2479
0000a6  d02f              BEQ      |L9.264|
0000a8  4819              LDR      r0,|L9.272|
0000aa  8800              LDRH     r0,[r0,#0]            ;2482  ; RCA
0000ac  0400              LSLS     r0,r0,#16             ;2482
0000ae  4919              LDR      r1,|L9.276|
0000b0  6008              STR      r0,[r1,#0]            ;2482  ; SDIO_CmdInitStructure
0000b2  2037              MOVS     r0,#0x37              ;2483
0000b4  6048              STR      r0,[r1,#4]            ;2483  ; SDIO_CmdInitStructure
0000b6  2040              MOVS     r0,#0x40              ;2484
0000b8  6088              STR      r0,[r1,#8]            ;2484  ; SDIO_CmdInitStructure
0000ba  2000              MOVS     r0,#0                 ;2485
0000bc  60c8              STR      r0,[r1,#0xc]          ;2485  ; SDIO_CmdInitStructure
0000be  f44f6080          MOV      r0,#0x400             ;2486
0000c2  6108              STR      r0,[r1,#0x10]         ;2486  ; SDIO_CmdInitStructure
0000c4  4608              MOV      r0,r1                 ;2487
0000c6  f7fffffe          BL       SDIO_SendCommand
0000ca  2037              MOVS     r0,#0x37              ;2490
0000cc  f7fffffe          BL       CmdResp1Error
0000d0  4604              MOV      r4,r0                 ;2490
0000d2  b10c              CBZ      r4,|L9.216|
0000d4  4620              MOV      r0,r4                 ;2494
0000d6  e7a0              B        |L9.26|
                  |L9.216|
0000d8  2000              MOVS     r0,#0                 ;2498
0000da  490e              LDR      r1,|L9.276|
0000dc  6008              STR      r0,[r1,#0]            ;2498  ; SDIO_CmdInitStructure
0000de  2006              MOVS     r0,#6                 ;2499
0000e0  6048              STR      r0,[r1,#4]            ;2499  ; SDIO_CmdInitStructure
0000e2  2040              MOVS     r0,#0x40              ;2500
0000e4  6088              STR      r0,[r1,#8]            ;2500  ; SDIO_CmdInitStructure
0000e6  2000              MOVS     r0,#0                 ;2501
0000e8  60c8              STR      r0,[r1,#0xc]          ;2501  ; SDIO_CmdInitStructure
0000ea  f44f6080          MOV      r0,#0x400             ;2502
0000ee  6108              STR      r0,[r1,#0x10]         ;2502  ; SDIO_CmdInitStructure
0000f0  4608              MOV      r0,r1                 ;2503
0000f2  f7fffffe          BL       SDIO_SendCommand
0000f6  2006              MOVS     r0,#6                 ;2505
0000f8  f7fffffe          BL       CmdResp1Error
0000fc  4604              MOV      r4,r0                 ;2505
0000fe  b10c              CBZ      r4,|L9.260|
000100  4620              MOV      r0,r4                 ;2509
000102  e78a              B        |L9.26|
                  |L9.260|
000104  4620              MOV      r0,r4                 ;2512
000106  e788              B        |L9.26|
                  |L9.264|
000108  2425              MOVS     r4,#0x25              ;2516
00010a  4620              MOV      r0,r4                 ;2517
00010c  e785              B        |L9.26|
;;;2521   
                          ENDP

00010e  0000              DCW      0x0000
                  |L9.272|
                          DCD      ||RCA||
                  |L9.276|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SDIO_Interrupts_Config||, CODE, READONLY, ALIGN=1

                  SDIO_Interrupts_Config PROC
;;;2992   */
;;;2993   void SDIO_Interrupts_Config(void)
000000  b508              PUSH     {r3,lr}
;;;2994   {
;;;2995     NVIC_InitTypeDef NVIC_InitStructure;
;;;2996   
;;;2997     NVIC_InitStructure.NVIC_IRQChannel = SDIO_IRQn;
000002  2031              MOVS     r0,#0x31
000004  f88d0000          STRB     r0,[sp,#0]
;;;2998     NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
000008  2000              MOVS     r0,#0
00000a  f88d0001          STRB     r0,[sp,#1]
;;;2999     NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
00000e  f88d0002          STRB     r0,[sp,#2]
;;;3000     NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
000012  2001              MOVS     r0,#1
000014  f88d0003          STRB     r0,[sp,#3]
;;;3001     NVIC_Init(&NVIC_InitStructure);
000018  4668              MOV      r0,sp
00001a  f7fffffe          BL       NVIC_Init
;;;3002   
;;;3003   #if 1
;;;3004   	
;;;3005     NVIC_InitStructure.NVIC_IRQChannel = SD_SDIO_DMA_IRQn;
00001e  203b              MOVS     r0,#0x3b
000020  f88d0000          STRB     r0,[sp,#0]
;;;3006     NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
000024  2001              MOVS     r0,#1
000026  f88d0001          STRB     r0,[sp,#1]
;;;3007     NVIC_Init(&NVIC_InitStructure);
00002a  4668              MOV      r0,sp
00002c  f7fffffe          BL       NVIC_Init
;;;3008   
;;;3009   #endif	
;;;3010   }
000030  bd08              POP      {r3,pc}
;;;3011   
                          ENDP


                          AREA ||i.SD_DeInit||, CODE, READONLY, ALIGN=1

                  SD_DeInit PROC
;;;393      */
;;;394    void SD_DeInit(void)
000000  b510              PUSH     {r4,lr}
;;;395    {
;;;396      SD_LowLevel_DeInit();
000002  f7fffffe          BL       SD_LowLevel_DeInit
;;;397    }
000006  bd10              POP      {r4,pc}
;;;398    
                          ENDP


                          AREA ||i.SD_Detect||, CODE, READONLY, ALIGN=2

                  SD_Detect PROC
;;;519     */
;;;520    uint8_t SD_Detect(void)
000000  b508              PUSH     {r3,lr}
;;;521    {
;;;522      __IO uint8_t status = SD_PRESENT;
000002  2001              MOVS     r0,#1
000004  9000              STR      r0,[sp,#0]
;;;523    
;;;524      /*!< Check GPIO to detect SD */
;;;525      if (GPIO_ReadInputDataBit(SD_DETECT_GPIO_PORT, SD_DETECT_PIN) != Bit_RESET)
000006  0341              LSLS     r1,r0,#13
000008  4804              LDR      r0,|L12.28|
00000a  f7fffffe          BL       GPIO_ReadInputDataBit
00000e  b108              CBZ      r0,|L12.20|
;;;526      {
;;;527        status = SD_NOT_PRESENT;
000010  2000              MOVS     r0,#0
000012  9000              STR      r0,[sp,#0]
                  |L12.20|
;;;528      }
;;;529      return status;
000014  f89d0000          LDRB     r0,[sp,#0]
;;;530    }
000018  bd08              POP      {r3,pc}
;;;531    
                          ENDP

00001a  0000              DCW      0x0000
                  |L12.28|
                          DCD      0x40021c00

                          AREA ||i.SD_EnableWideBusOperation||, CODE, READONLY, ALIGN=2

                  SD_EnableWideBusOperation PROC
;;;1083     */
;;;1084   SD_Error SD_EnableWideBusOperation(uint32_t WideMode)
000000  b570              PUSH     {r4-r6,lr}
;;;1085   {
000002  4604              MOV      r4,r0
;;;1086     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;1087   
;;;1088     /*!< MMC Card doesn't support this feature */
;;;1089     if (SDIO_MULTIMEDIA_CARD == CardType)
000006  4820              LDR      r0,|L13.136|
000008  6800              LDR      r0,[r0,#0]  ; CardType
00000a  2803              CMP      r0,#3
00000c  d102              BNE      |L13.20|
;;;1090     {
;;;1091       errorstatus = SD_UNSUPPORTED_FEATURE;
00000e  2527              MOVS     r5,#0x27
;;;1092       return(errorstatus);
000010  4628              MOV      r0,r5
                  |L13.18|
;;;1093     }
;;;1094     else if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) || (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) || (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;1095     {
;;;1096       if (SDIO_BusWide_8b == WideMode)
;;;1097       {
;;;1098         errorstatus = SD_UNSUPPORTED_FEATURE;
;;;1099         return(errorstatus);
;;;1100       }
;;;1101       else if (SDIO_BusWide_4b == WideMode)
;;;1102       {
;;;1103         errorstatus = SDEnWideBus(ENABLE);
;;;1104   
;;;1105         if (SD_OK == errorstatus)
;;;1106         {
;;;1107           /*!< Configure the SDIO peripheral */
;;;1108           SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV;
;;;1109           SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;1110           SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;1111           SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;1112           SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_4b;
;;;1113           SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;1114           SDIO_Init(&SDIO_InitStructure);
;;;1115         }
;;;1116       }
;;;1117       else
;;;1118       {
;;;1119         errorstatus = SDEnWideBus(DISABLE);
;;;1120   
;;;1121         if (SD_OK == errorstatus)
;;;1122         {
;;;1123           /*!< Configure the SDIO peripheral */
;;;1124           SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV;
;;;1125           SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;1126           SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;1127           SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;1128           SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
;;;1129           SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;1130           SDIO_Init(&SDIO_InitStructure);
;;;1131         }
;;;1132       }
;;;1133     }
;;;1134   
;;;1135     return(errorstatus);
;;;1136   }
000012  bd70              POP      {r4-r6,pc}
                  |L13.20|
000014  481c              LDR      r0,|L13.136|
000016  6800              LDR      r0,[r0,#0]            ;1094  ; CardType
000018  b138              CBZ      r0,|L13.42|
00001a  481b              LDR      r0,|L13.136|
00001c  6800              LDR      r0,[r0,#0]            ;1094  ; CardType
00001e  2801              CMP      r0,#1                 ;1094
000020  d003              BEQ      |L13.42|
000022  4819              LDR      r0,|L13.136|
000024  6800              LDR      r0,[r0,#0]            ;1094  ; CardType
000026  2802              CMP      r0,#2                 ;1094
000028  d12c              BNE      |L13.132|
                  |L13.42|
00002a  f5b45f80          CMP      r4,#0x1000            ;1096
00002e  d102              BNE      |L13.54|
000030  2527              MOVS     r5,#0x27              ;1098
000032  4628              MOV      r0,r5                 ;1099
000034  e7ed              B        |L13.18|
                  |L13.54|
000036  f5b46f00          CMP      r4,#0x800             ;1101
00003a  d113              BNE      |L13.100|
00003c  2001              MOVS     r0,#1                 ;1103
00003e  f7fffffe          BL       SDEnWideBus
000042  4605              MOV      r5,r0                 ;1103
000044  b9f5              CBNZ     r5,|L13.132|
000046  2000              MOVS     r0,#0                 ;1108
000048  4910              LDR      r1,|L13.140|
00004a  7508              STRB     r0,[r1,#0x14]         ;1108
00004c  6008              STR      r0,[r1,#0]            ;1109  ; SDIO_InitStructure
00004e  6048              STR      r0,[r1,#4]            ;1110  ; SDIO_InitStructure
000050  6088              STR      r0,[r1,#8]            ;1111  ; SDIO_InitStructure
000052  f44f6000          MOV      r0,#0x800             ;1112
000056  60c8              STR      r0,[r1,#0xc]          ;1112  ; SDIO_InitStructure
000058  2000              MOVS     r0,#0                 ;1113
00005a  6108              STR      r0,[r1,#0x10]         ;1113  ; SDIO_InitStructure
00005c  4608              MOV      r0,r1                 ;1114
00005e  f7fffffe          BL       SDIO_Init
000062  e00f              B        |L13.132|
                  |L13.100|
000064  2000              MOVS     r0,#0                 ;1119
000066  f7fffffe          BL       SDEnWideBus
00006a  4605              MOV      r5,r0                 ;1119
00006c  b955              CBNZ     r5,|L13.132|
00006e  2000              MOVS     r0,#0                 ;1124
000070  4906              LDR      r1,|L13.140|
000072  7508              STRB     r0,[r1,#0x14]         ;1124
000074  6008              STR      r0,[r1,#0]            ;1125  ; SDIO_InitStructure
000076  6048              STR      r0,[r1,#4]            ;1126  ; SDIO_InitStructure
000078  6088              STR      r0,[r1,#8]            ;1127  ; SDIO_InitStructure
00007a  60c8              STR      r0,[r1,#0xc]          ;1128  ; SDIO_InitStructure
00007c  6108              STR      r0,[r1,#0x10]         ;1129  ; SDIO_InitStructure
00007e  4608              MOV      r0,r1                 ;1130
000080  f7fffffe          BL       SDIO_Init
                  |L13.132|
000084  4628              MOV      r0,r5                 ;1135
000086  e7c4              B        |L13.18|
;;;1137   
                          ENDP

                  |L13.136|
                          DCD      CardType
                  |L13.140|
                          DCD      SDIO_InitStructure

                          AREA ||i.SD_Erase||, CODE, READONLY, ALIGN=2

                  SD_Erase PROC
;;;1758     */
;;;1759   SD_Error SD_Erase(uint32_t startaddr, uint32_t endaddr)
000000  e92d41fc          PUSH     {r2-r8,lr}
;;;1760   {
000004  4606              MOV      r6,r0
000006  460f              MOV      r7,r1
;;;1761     SD_Error errorstatus = SD_OK;
000008  2400              MOVS     r4,#0
;;;1762     uint32_t delay = 0;
00000a  2500              MOVS     r5,#0
;;;1763     __IO uint32_t maxdelay = 0;
00000c  2000              MOVS     r0,#0
00000e  9001              STR      r0,[sp,#4]
;;;1764     uint8_t cardstate = 0;
000010  9000              STR      r0,[sp,#0]
;;;1765   
;;;1766     /*!< Check if the card coomnd class supports erase command */
;;;1767     if (((CSD_Tab[1] >> 20) & SD_CCCC_ERASE) == 0)
000012  4846              LDR      r0,|L14.300|
000014  6840              LDR      r0,[r0,#4]  ; CSD_Tab
000016  2120              MOVS     r1,#0x20
000018  ea115f10          TST      r1,r0,LSR #20
00001c  d103              BNE      |L14.38|
;;;1768     {
;;;1769       errorstatus = SD_REQUEST_NOT_APPLICABLE;
00001e  2425              MOVS     r4,#0x25
;;;1770       return(errorstatus);
000020  4620              MOV      r0,r4
                  |L14.34|
;;;1771     }
;;;1772   
;;;1773     maxdelay = 120000 / ((SDIO->CLKCR & 0xFF) + 2);
;;;1774   
;;;1775     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
;;;1776     {
;;;1777       errorstatus = SD_LOCK_UNLOCK_FAILED;
;;;1778       return(errorstatus);
;;;1779     }
;;;1780   
;;;1781     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
;;;1782     {
;;;1783       startaddr /= 512;
;;;1784       endaddr /= 512;
;;;1785     }
;;;1786   
;;;1787     /*!< According to sd-card spec 1.0 ERASE_GROUP_START (CMD32) and erase_group_end(CMD33) */
;;;1788     if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) || (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) || (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;1789     {
;;;1790       /*!< Send CMD32 SD_ERASE_GRP_START with argument as addr  */
;;;1791       SDIO_CmdInitStructure.SDIO_Argument = startaddr;
;;;1792       SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_ERASE_GRP_START;
;;;1793       SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1794       SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1795       SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1796       SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1797   
;;;1798       errorstatus = CmdResp1Error(SD_CMD_SD_ERASE_GRP_START);
;;;1799       if (errorstatus != SD_OK)
;;;1800       {
;;;1801         return(errorstatus);
;;;1802       }
;;;1803   
;;;1804       /*!< Send CMD33 SD_ERASE_GRP_END with argument as addr  */
;;;1805       SDIO_CmdInitStructure.SDIO_Argument = endaddr;
;;;1806       SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_ERASE_GRP_END;
;;;1807       SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1808       SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1809       SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1810       SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1811   
;;;1812       errorstatus = CmdResp1Error(SD_CMD_SD_ERASE_GRP_END);
;;;1813       if (errorstatus != SD_OK)
;;;1814       {
;;;1815         return(errorstatus);
;;;1816       }
;;;1817     }
;;;1818   
;;;1819     /*!< Send CMD38 ERASE */
;;;1820     SDIO_CmdInitStructure.SDIO_Argument = 0;
;;;1821     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_ERASE;
;;;1822     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1823     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1824     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1825     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1826   
;;;1827     errorstatus = CmdResp1Error(SD_CMD_ERASE);
;;;1828   
;;;1829     if (errorstatus != SD_OK)
;;;1830     {
;;;1831       return(errorstatus);
;;;1832     }
;;;1833   
;;;1834     for (delay = 0; delay < maxdelay; delay++)
;;;1835     {}
;;;1836   
;;;1837     /*!< Wait till the card is in programming state */
;;;1838     errorstatus = IsCardProgramming(&cardstate);
;;;1839     delay = SD_DATATIMEOUT;
;;;1840     while ((delay > 0) && (errorstatus == SD_OK) && ((SD_CARD_PROGRAMMING == cardstate) || (SD_CARD_RECEIVING == cardstate)))
;;;1841     {
;;;1842       errorstatus = IsCardProgramming(&cardstate);
;;;1843       delay--;
;;;1844     }
;;;1845   
;;;1846     return(errorstatus);
;;;1847   }
000022  e8bd81fc          POP      {r2-r8,pc}
                  |L14.38|
000026  4842              LDR      r0,|L14.304|
000028  6800              LDR      r0,[r0,#0]            ;1773
00002a  b2c0              UXTB     r0,r0                 ;1773
00002c  1c80              ADDS     r0,r0,#2              ;1773
00002e  4941              LDR      r1,|L14.308|
000030  fbb1f0f0          UDIV     r0,r1,r0              ;1773
000034  9001              STR      r0,[sp,#4]            ;1773
000036  2000              MOVS     r0,#0                 ;1775
000038  f7fffffe          BL       SDIO_GetResponse
00003c  f0107f00          TST      r0,#0x2000000         ;1775
000040  d002              BEQ      |L14.72|
000042  240e              MOVS     r4,#0xe               ;1777
000044  4620              MOV      r0,r4                 ;1778
000046  e7ec              B        |L14.34|
                  |L14.72|
000048  483b              LDR      r0,|L14.312|
00004a  6800              LDR      r0,[r0,#0]            ;1781  ; CardType
00004c  2802              CMP      r0,#2                 ;1781
00004e  d101              BNE      |L14.84|
000050  0a76              LSRS     r6,r6,#9              ;1783
000052  0a7f              LSRS     r7,r7,#9              ;1784
                  |L14.84|
000054  4838              LDR      r0,|L14.312|
000056  6800              LDR      r0,[r0,#0]            ;1788  ; CardType
000058  b138              CBZ      r0,|L14.106|
00005a  4837              LDR      r0,|L14.312|
00005c  6800              LDR      r0,[r0,#0]            ;1788  ; CardType
00005e  2801              CMP      r0,#1                 ;1788
000060  d003              BEQ      |L14.106|
000062  4835              LDR      r0,|L14.312|
000064  6800              LDR      r0,[r0,#0]            ;1788  ; CardType
000066  2802              CMP      r0,#2                 ;1788
000068  d12b              BNE      |L14.194|
                  |L14.106|
00006a  4834              LDR      r0,|L14.316|
00006c  6006              STR      r6,[r0,#0]            ;1791  ; SDIO_CmdInitStructure
00006e  2020              MOVS     r0,#0x20              ;1792
000070  4932              LDR      r1,|L14.316|
000072  6048              STR      r0,[r1,#4]            ;1792  ; SDIO_CmdInitStructure
000074  2040              MOVS     r0,#0x40              ;1793
000076  6088              STR      r0,[r1,#8]            ;1793  ; SDIO_CmdInitStructure
000078  2000              MOVS     r0,#0                 ;1794
00007a  60c8              STR      r0,[r1,#0xc]          ;1794  ; SDIO_CmdInitStructure
00007c  f44f6080          MOV      r0,#0x400             ;1795
000080  6108              STR      r0,[r1,#0x10]         ;1795  ; SDIO_CmdInitStructure
000082  4608              MOV      r0,r1                 ;1796
000084  f7fffffe          BL       SDIO_SendCommand
000088  2020              MOVS     r0,#0x20              ;1798
00008a  f7fffffe          BL       CmdResp1Error
00008e  4604              MOV      r4,r0                 ;1798
000090  b10c              CBZ      r4,|L14.150|
000092  4620              MOV      r0,r4                 ;1801
000094  e7c5              B        |L14.34|
                  |L14.150|
000096  4829              LDR      r0,|L14.316|
000098  6007              STR      r7,[r0,#0]            ;1805  ; SDIO_CmdInitStructure
00009a  2021              MOVS     r0,#0x21              ;1806
00009c  4927              LDR      r1,|L14.316|
00009e  6048              STR      r0,[r1,#4]            ;1806  ; SDIO_CmdInitStructure
0000a0  2040              MOVS     r0,#0x40              ;1807
0000a2  6088              STR      r0,[r1,#8]            ;1807  ; SDIO_CmdInitStructure
0000a4  2000              MOVS     r0,#0                 ;1808
0000a6  60c8              STR      r0,[r1,#0xc]          ;1808  ; SDIO_CmdInitStructure
0000a8  f44f6080          MOV      r0,#0x400             ;1809
0000ac  6108              STR      r0,[r1,#0x10]         ;1809  ; SDIO_CmdInitStructure
0000ae  4608              MOV      r0,r1                 ;1810
0000b0  f7fffffe          BL       SDIO_SendCommand
0000b4  2021              MOVS     r0,#0x21              ;1812
0000b6  f7fffffe          BL       CmdResp1Error
0000ba  4604              MOV      r4,r0                 ;1812
0000bc  b10c              CBZ      r4,|L14.194|
0000be  4620              MOV      r0,r4                 ;1815
0000c0  e7af              B        |L14.34|
                  |L14.194|
0000c2  2000              MOVS     r0,#0                 ;1820
0000c4  491d              LDR      r1,|L14.316|
0000c6  6008              STR      r0,[r1,#0]            ;1820  ; SDIO_CmdInitStructure
0000c8  2026              MOVS     r0,#0x26              ;1821
0000ca  6048              STR      r0,[r1,#4]            ;1821  ; SDIO_CmdInitStructure
0000cc  2040              MOVS     r0,#0x40              ;1822
0000ce  6088              STR      r0,[r1,#8]            ;1822  ; SDIO_CmdInitStructure
0000d0  2000              MOVS     r0,#0                 ;1823
0000d2  60c8              STR      r0,[r1,#0xc]          ;1823  ; SDIO_CmdInitStructure
0000d4  f44f6080          MOV      r0,#0x400             ;1824
0000d8  6108              STR      r0,[r1,#0x10]         ;1824  ; SDIO_CmdInitStructure
0000da  4608              MOV      r0,r1                 ;1825
0000dc  f7fffffe          BL       SDIO_SendCommand
0000e0  2026              MOVS     r0,#0x26              ;1827
0000e2  f7fffffe          BL       CmdResp1Error
0000e6  4604              MOV      r4,r0                 ;1827
0000e8  b10c              CBZ      r4,|L14.238|
0000ea  4620              MOV      r0,r4                 ;1831
0000ec  e799              B        |L14.34|
                  |L14.238|
0000ee  2500              MOVS     r5,#0                 ;1834
0000f0  e000              B        |L14.244|
                  |L14.242|
0000f2  1c6d              ADDS     r5,r5,#1              ;1834
                  |L14.244|
0000f4  9801              LDR      r0,[sp,#4]            ;1834
0000f6  4285              CMP      r5,r0                 ;1834
0000f8  d3fb              BCC      |L14.242|
0000fa  4668              MOV      r0,sp                 ;1838
0000fc  f7fffffe          BL       IsCardProgramming
000100  4604              MOV      r4,r0                 ;1838
000102  f04f35ff          MOV      r5,#0xffffffff        ;1839
000106  e004              B        |L14.274|
                  |L14.264|
000108  4668              MOV      r0,sp                 ;1842
00010a  f7fffffe          BL       IsCardProgramming
00010e  4604              MOV      r4,r0                 ;1842
000110  1e6d              SUBS     r5,r5,#1              ;1843
                  |L14.274|
000112  b145              CBZ      r5,|L14.294|
000114  b93c              CBNZ     r4,|L14.294|
000116  f89d0000          LDRB     r0,[sp,#0]            ;1840
00011a  2807              CMP      r0,#7                 ;1840
00011c  d0f4              BEQ      |L14.264|
00011e  f89d0000          LDRB     r0,[sp,#0]            ;1840
000122  2806              CMP      r0,#6                 ;1840
000124  d0f0              BEQ      |L14.264|
                  |L14.294|
000126  4620              MOV      r0,r4                 ;1846
000128  e77b              B        |L14.34|
;;;1848   
                          ENDP

00012a  0000              DCW      0x0000
                  |L14.300|
                          DCD      CSD_Tab
                  |L14.304|
                          DCD      0x40012c04
                  |L14.308|
                          DCD      0x0001d4c0
                  |L14.312|
                          DCD      CardType
                  |L14.316|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_GetCardInfo||, CODE, READONLY, ALIGN=2

                  SD_GetCardInfo PROC
;;;786      */
;;;787    SD_Error SD_GetCardInfo(SD_CardInfo *cardinfo)
000000  b5f0              PUSH     {r4-r7,lr}
;;;788    {
000002  4601              MOV      r1,r0
;;;789      SD_Error errorstatus = SD_OK;
000004  2000              MOVS     r0,#0
;;;790      uint8_t tmp = 0;
000006  2200              MOVS     r2,#0
;;;791    
;;;792      cardinfo->CardType = (uint8_t)CardType;
000008  4bc6              LDR      r3,|L15.804|
00000a  781b              LDRB     r3,[r3,#0]  ; CardType
00000c  f8813056          STRB     r3,[r1,#0x56]
;;;793      cardinfo->RCA = (uint16_t)RCA;
000010  4bc5              LDR      r3,|L15.808|
000012  881b              LDRH     r3,[r3,#0]  ; RCA
000014  f8a13054          STRH     r3,[r1,#0x54]
;;;794    
;;;795      /*!< Byte 0 */
;;;796      tmp = (uint8_t)((CSD_Tab[0] & 0xFF000000) >> 24);
000018  4bc4              LDR      r3,|L15.812|
00001a  681b              LDR      r3,[r3,#0]  ; CSD_Tab
00001c  0e1a              LSRS     r2,r3,#24
;;;797      cardinfo->SD_csd.CSDStruct = (tmp & 0xC0) >> 6;
00001e  0993              LSRS     r3,r2,#6
000020  700b              STRB     r3,[r1,#0]
;;;798      cardinfo->SD_csd.SysSpecVersion = (tmp & 0x3C) >> 2;
000022  f3c20383          UBFX     r3,r2,#2,#4
000026  704b              STRB     r3,[r1,#1]
;;;799      cardinfo->SD_csd.Reserved1 = tmp & 0x03;
000028  f0020303          AND      r3,r2,#3
00002c  708b              STRB     r3,[r1,#2]
;;;800    
;;;801      /*!< Byte 1 */
;;;802      tmp = (uint8_t)((CSD_Tab[0] & 0x00FF0000) >> 16);
00002e  4bbf              LDR      r3,|L15.812|
000030  681b              LDR      r3,[r3,#0]  ; CSD_Tab
000032  f3c34207          UBFX     r2,r3,#16,#8
;;;803      cardinfo->SD_csd.TAAC = tmp;
000036  70ca              STRB     r2,[r1,#3]
;;;804    
;;;805      /*!< Byte 2 */
;;;806      tmp = (uint8_t)((CSD_Tab[0] & 0x0000FF00) >> 8);
000038  4bbc              LDR      r3,|L15.812|
00003a  881b              LDRH     r3,[r3,#0]  ; CSD_Tab
00003c  f3c32207          UBFX     r2,r3,#8,#8
;;;807      cardinfo->SD_csd.NSAC = tmp;
000040  710a              STRB     r2,[r1,#4]
;;;808    
;;;809      /*!< Byte 3 */
;;;810      tmp = (uint8_t)(CSD_Tab[0] & 0x000000FF);
000042  4bba              LDR      r3,|L15.812|
000044  781a              LDRB     r2,[r3,#0]  ; CSD_Tab
;;;811      cardinfo->SD_csd.MaxBusClkFrec = tmp;
000046  714a              STRB     r2,[r1,#5]
;;;812    
;;;813      /*!< Byte 4 */
;;;814      tmp = (uint8_t)((CSD_Tab[1] & 0xFF000000) >> 24);
000048  685b              LDR      r3,[r3,#4]  ; CSD_Tab
00004a  0e1a              LSRS     r2,r3,#24
;;;815      cardinfo->SD_csd.CardComdClasses = tmp << 4;
00004c  0113              LSLS     r3,r2,#4
00004e  80cb              STRH     r3,[r1,#6]
;;;816    
;;;817      /*!< Byte 5 */
;;;818      tmp = (uint8_t)((CSD_Tab[1] & 0x00FF0000) >> 16);
000050  4bb6              LDR      r3,|L15.812|
000052  685b              LDR      r3,[r3,#4]  ; CSD_Tab
000054  f3c34207          UBFX     r2,r3,#16,#8
;;;819      cardinfo->SD_csd.CardComdClasses |= (tmp & 0xF0) >> 4;
000058  88cb              LDRH     r3,[r1,#6]
00005a  ea431312          ORR      r3,r3,r2,LSR #4
00005e  80cb              STRH     r3,[r1,#6]
;;;820      cardinfo->SD_csd.RdBlockLen = tmp & 0x0F;
000060  f002030f          AND      r3,r2,#0xf
000064  720b              STRB     r3,[r1,#8]
;;;821    
;;;822      /*!< Byte 6 */
;;;823      tmp = (uint8_t)((CSD_Tab[1] & 0x0000FF00) >> 8);
000066  4bb1              LDR      r3,|L15.812|
000068  889b              LDRH     r3,[r3,#4]  ; CSD_Tab
00006a  f3c32207          UBFX     r2,r3,#8,#8
;;;824      cardinfo->SD_csd.PartBlockRead = (tmp & 0x80) >> 7;
00006e  09d3              LSRS     r3,r2,#7
000070  724b              STRB     r3,[r1,#9]
;;;825      cardinfo->SD_csd.WrBlockMisalign = (tmp & 0x40) >> 6;
000072  f3c21380          UBFX     r3,r2,#6,#1
000076  728b              STRB     r3,[r1,#0xa]
;;;826      cardinfo->SD_csd.RdBlockMisalign = (tmp & 0x20) >> 5;
000078  f3c21340          UBFX     r3,r2,#5,#1
00007c  72cb              STRB     r3,[r1,#0xb]
;;;827      cardinfo->SD_csd.DSRImpl = (tmp & 0x10) >> 4;
00007e  f3c21300          UBFX     r3,r2,#4,#1
000082  730b              STRB     r3,[r1,#0xc]
;;;828      cardinfo->SD_csd.Reserved2 = 0; /*!< Reserved */
000084  2300              MOVS     r3,#0
000086  734b              STRB     r3,[r1,#0xd]
;;;829    
;;;830      if ((CardType == SDIO_STD_CAPACITY_SD_CARD_V1_1) || (CardType == SDIO_STD_CAPACITY_SD_CARD_V2_0))
000088  4ba6              LDR      r3,|L15.804|
00008a  681b              LDR      r3,[r3,#0]  ; CardType
00008c  b11b              CBZ      r3,|L15.150|
00008e  4ba5              LDR      r3,|L15.804|
000090  681b              LDR      r3,[r3,#0]  ; CardType
000092  2b01              CMP      r3,#1
000094  d14f              BNE      |L15.310|
                  |L15.150|
;;;831      {
;;;832        cardinfo->SD_csd.DeviceSize = (tmp & 0x03) << 10;
000096  0793              LSLS     r3,r2,#30
000098  0d1b              LSRS     r3,r3,#20
00009a  610b              STR      r3,[r1,#0x10]
;;;833    
;;;834        /*!< Byte 7 */
;;;835        tmp = (uint8_t)(CSD_Tab[1] & 0x000000FF);
00009c  4ba3              LDR      r3,|L15.812|
00009e  791a              LDRB     r2,[r3,#4]  ; CSD_Tab
;;;836        cardinfo->SD_csd.DeviceSize |= (tmp) << 2;
0000a0  690b              LDR      r3,[r1,#0x10]
0000a2  ea430382          ORR      r3,r3,r2,LSL #2
0000a6  610b              STR      r3,[r1,#0x10]
;;;837    
;;;838        /*!< Byte 8 */
;;;839        tmp = (uint8_t)((CSD_Tab[2] & 0xFF000000) >> 24);
0000a8  4ba0              LDR      r3,|L15.812|
0000aa  689b              LDR      r3,[r3,#8]  ; CSD_Tab
0000ac  0e1a              LSRS     r2,r3,#24
;;;840        cardinfo->SD_csd.DeviceSize |= (tmp & 0xC0) >> 6;
0000ae  690b              LDR      r3,[r1,#0x10]
0000b0  ea431392          ORR      r3,r3,r2,LSR #6
0000b4  610b              STR      r3,[r1,#0x10]
;;;841    
;;;842        cardinfo->SD_csd.MaxRdCurrentVDDMin = (tmp & 0x38) >> 3;
0000b6  f3c203c2          UBFX     r3,r2,#3,#3
0000ba  750b              STRB     r3,[r1,#0x14]
;;;843        cardinfo->SD_csd.MaxRdCurrentVDDMax = (tmp & 0x07);
0000bc  f0020307          AND      r3,r2,#7
0000c0  754b              STRB     r3,[r1,#0x15]
;;;844    
;;;845        /*!< Byte 9 */
;;;846        tmp = (uint8_t)((CSD_Tab[2] & 0x00FF0000) >> 16);
0000c2  4b9a              LDR      r3,|L15.812|
0000c4  689b              LDR      r3,[r3,#8]  ; CSD_Tab
0000c6  f3c34207          UBFX     r2,r3,#16,#8
;;;847        cardinfo->SD_csd.MaxWrCurrentVDDMin = (tmp & 0xE0) >> 5;
0000ca  0953              LSRS     r3,r2,#5
0000cc  758b              STRB     r3,[r1,#0x16]
;;;848        cardinfo->SD_csd.MaxWrCurrentVDDMax = (tmp & 0x1C) >> 2;
0000ce  f3c20382          UBFX     r3,r2,#2,#3
0000d2  75cb              STRB     r3,[r1,#0x17]
;;;849        cardinfo->SD_csd.DeviceSizeMul = (tmp & 0x03) << 1;
0000d4  0793              LSLS     r3,r2,#30
0000d6  0f5b              LSRS     r3,r3,#29
0000d8  760b              STRB     r3,[r1,#0x18]
;;;850        /*!< Byte 10 */
;;;851        tmp = (uint8_t)((CSD_Tab[2] & 0x0000FF00) >> 8);
0000da  4b94              LDR      r3,|L15.812|
0000dc  891b              LDRH     r3,[r3,#8]  ; CSD_Tab
0000de  f3c32207          UBFX     r2,r3,#8,#8
;;;852        cardinfo->SD_csd.DeviceSizeMul |= (tmp & 0x80) >> 7;
0000e2  7e0b              LDRB     r3,[r1,#0x18]
0000e4  ea4313d2          ORR      r3,r3,r2,LSR #7
0000e8  760b              STRB     r3,[r1,#0x18]
;;;853    
;;;854        cardinfo->CardCapacity = (cardinfo->SD_csd.DeviceSize + 1) ;
0000ea  690b              LDR      r3,[r1,#0x10]
0000ec  1c5b              ADDS     r3,r3,#1
0000ee  2400              MOVS     r4,#0
0000f0  e9c13412          STRD     r3,r4,[r1,#0x48]
;;;855        cardinfo->CardCapacity *= (1 << (cardinfo->SD_csd.DeviceSizeMul + 2));
0000f4  7e0b              LDRB     r3,[r1,#0x18]
0000f6  e9d16412          LDRD     r6,r4,[r1,#0x48]
0000fa  1c9b              ADDS     r3,r3,#2
0000fc  2501              MOVS     r5,#1
0000fe  fa05f303          LSL      r3,r5,r3
000102  17df              ASRS     r7,r3,#31
000104  fba65c03          UMULL    r5,r12,r6,r3
000108  fb04c303          MLA      r3,r4,r3,r12
00010c  fb063307          MLA      r3,r6,r7,r3
000110  e9c15312          STRD     r5,r3,[r1,#0x48]
;;;856        cardinfo->CardBlockSize = 1 << (cardinfo->SD_csd.RdBlockLen);
000114  7a0c              LDRB     r4,[r1,#8]
000116  2301              MOVS     r3,#1
000118  40a3              LSLS     r3,r3,r4
00011a  650b              STR      r3,[r1,#0x50]
;;;857        cardinfo->CardCapacity *= cardinfo->CardBlockSize;
00011c  2700              MOVS     r7,#0
00011e  e9d15612          LDRD     r5,r6,[r1,#0x48]
000122  6d0b              LDR      r3,[r1,#0x50]
000124  fba54c03          UMULL    r4,r12,r5,r3
000128  fb06c303          MLA      r3,r6,r3,r12
00012c  fb053307          MLA      r3,r5,r7,r3
000130  e9c14312          STRD     r4,r3,[r1,#0x48]
000134  e02d              B        |L15.402|
                  |L15.310|
;;;858      }
;;;859      else if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000136  4b7b              LDR      r3,|L15.804|
000138  681b              LDR      r3,[r3,#0]  ; CardType
00013a  2b02              CMP      r3,#2
00013c  d129              BNE      |L15.402|
;;;860      {
;;;861        /*!< Byte 7 */
;;;862        tmp = (uint8_t)(CSD_Tab[1] & 0x000000FF);
00013e  4b7b              LDR      r3,|L15.812|
000140  791a              LDRB     r2,[r3,#4]  ; CSD_Tab
;;;863        cardinfo->SD_csd.DeviceSize = (tmp & 0x3F) << 16;
000142  0693              LSLS     r3,r2,#26
000144  0a9b              LSRS     r3,r3,#10
000146  610b              STR      r3,[r1,#0x10]
;;;864    
;;;865        /*!< Byte 8 */
;;;866        tmp = (uint8_t)((CSD_Tab[2] & 0xFF000000) >> 24);
000148  4b78              LDR      r3,|L15.812|
00014a  689b              LDR      r3,[r3,#8]  ; CSD_Tab
00014c  0e1a              LSRS     r2,r3,#24
;;;867    
;;;868        cardinfo->SD_csd.DeviceSize |= (tmp << 8);
00014e  690b              LDR      r3,[r1,#0x10]
000150  ea432302          ORR      r3,r3,r2,LSL #8
000154  610b              STR      r3,[r1,#0x10]
;;;869    
;;;870        /*!< Byte 9 */
;;;871        tmp = (uint8_t)((CSD_Tab[2] & 0x00FF0000) >> 16);
000156  4b75              LDR      r3,|L15.812|
000158  689b              LDR      r3,[r3,#8]  ; CSD_Tab
00015a  f3c34207          UBFX     r2,r3,#16,#8
;;;872    
;;;873        cardinfo->SD_csd.DeviceSize |= (tmp);
00015e  690b              LDR      r3,[r1,#0x10]
000160  4313              ORRS     r3,r3,r2
000162  610b              STR      r3,[r1,#0x10]
;;;874    
;;;875        /*!< Byte 10 */
;;;876        tmp = (uint8_t)((CSD_Tab[2] & 0x0000FF00) >> 8);
000164  4b71              LDR      r3,|L15.812|
000166  891b              LDRH     r3,[r3,#8]  ; CSD_Tab
000168  f3c32207          UBFX     r2,r3,#8,#8
;;;877    
;;;878        cardinfo->CardCapacity = (int64_t)(cardinfo->SD_csd.DeviceSize + 1) * 512 * 1024;
00016c  690b              LDR      r3,[r1,#0x10]
00016e  1c5b              ADDS     r3,r3,#1
000170  f44f7400          MOV      r4,#0x200
000174  fba33404          UMULL    r3,r4,r3,r4
000178  f44f6680          MOV      r6,#0x400
00017c  2500              MOVS     r5,#0
00017e  fba37c06          UMULL    r7,r12,r3,r6
000182  fb04c406          MLA      r4,r4,r6,r12
000186  fb034305          MLA      r3,r3,r5,r4
00018a  e9c17312          STRD     r7,r3,[r1,#0x48]
;;;879        cardinfo->CardBlockSize = 512;
00018e  1073              ASRS     r3,r6,#1
000190  650b              STR      r3,[r1,#0x50]
                  |L15.402|
;;;880      }
;;;881    
;;;882    
;;;883      cardinfo->SD_csd.EraseGrSize = (tmp & 0x40) >> 6;
000192  f3c21380          UBFX     r3,r2,#6,#1
000196  f8013f19          STRB     r3,[r1,#0x19]!
;;;884      cardinfo->SD_csd.EraseGrMul = (tmp & 0x3F) << 1;
00019a  0693              LSLS     r3,r2,#26
00019c  0e5b              LSRS     r3,r3,#25
00019e  704b              STRB     r3,[r1,#1]
;;;885    
;;;886      /*!< Byte 11 */
;;;887      tmp = (uint8_t)(CSD_Tab[2] & 0x000000FF);
0001a0  4b62              LDR      r3,|L15.812|
0001a2  7a1a              LDRB     r2,[r3,#8]  ; CSD_Tab
;;;888      cardinfo->SD_csd.EraseGrMul |= (tmp & 0x80) >> 7;
0001a4  784b              LDRB     r3,[r1,#1]
0001a6  ea4313d2          ORR      r3,r3,r2,LSR #7
0001aa  704b              STRB     r3,[r1,#1]
;;;889      cardinfo->SD_csd.WrProtectGrSize = (tmp & 0x7F);
0001ac  f002037f          AND      r3,r2,#0x7f
0001b0  708b              STRB     r3,[r1,#2]
;;;890    
;;;891      /*!< Byte 12 */
;;;892      tmp = (uint8_t)((CSD_Tab[3] & 0xFF000000) >> 24);
0001b2  4b5e              LDR      r3,|L15.812|
0001b4  68db              LDR      r3,[r3,#0xc]  ; CSD_Tab
0001b6  0e1a              LSRS     r2,r3,#24
;;;893      cardinfo->SD_csd.WrProtectGrEnable = (tmp & 0x80) >> 7;
0001b8  09d3              LSRS     r3,r2,#7
0001ba  70cb              STRB     r3,[r1,#3]
;;;894      cardinfo->SD_csd.ManDeflECC = (tmp & 0x60) >> 5;
0001bc  f3c21341          UBFX     r3,r2,#5,#2
0001c0  710b              STRB     r3,[r1,#4]
;;;895      cardinfo->SD_csd.WrSpeedFact = (tmp & 0x1C) >> 2;
0001c2  f3c20382          UBFX     r3,r2,#2,#3
0001c6  714b              STRB     r3,[r1,#5]
;;;896      cardinfo->SD_csd.MaxWrBlockLen = (tmp & 0x03) << 2;
0001c8  0793              LSLS     r3,r2,#30
0001ca  0f1b              LSRS     r3,r3,#28
0001cc  718b              STRB     r3,[r1,#6]
;;;897    
;;;898      /*!< Byte 13 */
;;;899      tmp = (uint8_t)((CSD_Tab[3] & 0x00FF0000) >> 16);
0001ce  4b57              LDR      r3,|L15.812|
0001d0  68db              LDR      r3,[r3,#0xc]  ; CSD_Tab
0001d2  f3c34207          UBFX     r2,r3,#16,#8
;;;900      cardinfo->SD_csd.MaxWrBlockLen |= (tmp & 0xC0) >> 6;
0001d6  798b              LDRB     r3,[r1,#6]
0001d8  ea431392          ORR      r3,r3,r2,LSR #6
0001dc  718b              STRB     r3,[r1,#6]
;;;901      cardinfo->SD_csd.WriteBlockPaPartial = (tmp & 0x20) >> 5;
0001de  f3c21340          UBFX     r3,r2,#5,#1
0001e2  71cb              STRB     r3,[r1,#7]
;;;902      cardinfo->SD_csd.Reserved3 = 0;
0001e4  2300              MOVS     r3,#0
0001e6  720b              STRB     r3,[r1,#8]
;;;903      cardinfo->SD_csd.ContentProtectAppli = (tmp & 0x01);
0001e8  f0020301          AND      r3,r2,#1
0001ec  724b              STRB     r3,[r1,#9]
;;;904    
;;;905      /*!< Byte 14 */
;;;906      tmp = (uint8_t)((CSD_Tab[3] & 0x0000FF00) >> 8);
0001ee  4b4f              LDR      r3,|L15.812|
0001f0  899b              LDRH     r3,[r3,#0xc]  ; CSD_Tab
0001f2  f3c32207          UBFX     r2,r3,#8,#8
;;;907      cardinfo->SD_csd.FileFormatGrouop = (tmp & 0x80) >> 7;
0001f6  09d3              LSRS     r3,r2,#7
0001f8  728b              STRB     r3,[r1,#0xa]
;;;908      cardinfo->SD_csd.CopyFlag = (tmp & 0x40) >> 6;
0001fa  f3c21380          UBFX     r3,r2,#6,#1
0001fe  72cb              STRB     r3,[r1,#0xb]
;;;909      cardinfo->SD_csd.PermWrProtect = (tmp & 0x20) >> 5;
000200  f3c21340          UBFX     r3,r2,#5,#1
000204  730b              STRB     r3,[r1,#0xc]
;;;910      cardinfo->SD_csd.TempWrProtect = (tmp & 0x10) >> 4;
000206  f3c21300          UBFX     r3,r2,#4,#1
00020a  734b              STRB     r3,[r1,#0xd]
;;;911      cardinfo->SD_csd.FileFormat = (tmp & 0x0C) >> 2;
00020c  f3c20381          UBFX     r3,r2,#2,#2
000210  738b              STRB     r3,[r1,#0xe]
;;;912      cardinfo->SD_csd.ECC = (tmp & 0x03);
000212  f0020303          AND      r3,r2,#3
000216  73cb              STRB     r3,[r1,#0xf]
;;;913    
;;;914      /*!< Byte 15 */
;;;915      tmp = (uint8_t)(CSD_Tab[3] & 0x000000FF);
000218  4b44              LDR      r3,|L15.812|
00021a  7b1a              LDRB     r2,[r3,#0xc]  ; CSD_Tab
;;;916      cardinfo->SD_csd.CSD_CRC = (tmp & 0xFE) >> 1;
00021c  0853              LSRS     r3,r2,#1
00021e  740b              STRB     r3,[r1,#0x10]
;;;917      cardinfo->SD_csd.Reserved4 = 1;
000220  2301              MOVS     r3,#1
000222  744b              STRB     r3,[r1,#0x11]
;;;918    
;;;919    
;;;920      /*!< Byte 0 */
;;;921      tmp = (uint8_t)((CID_Tab[0] & 0xFF000000) >> 24);
000224  4b42              LDR      r3,|L15.816|
000226  681b              LDR      r3,[r3,#0]  ; CID_Tab
000228  0e1a              LSRS     r2,r3,#24
;;;922      cardinfo->SD_cid.ManufacturerID = tmp;
00022a  74ca              STRB     r2,[r1,#0x13]
00022c  f1a10119          SUB      r1,r1,#0x19
;;;923    
;;;924      /*!< Byte 1 */
;;;925      tmp = (uint8_t)((CID_Tab[0] & 0x00FF0000) >> 16);
000230  4b3f              LDR      r3,|L15.816|
000232  681b              LDR      r3,[r3,#0]  ; CID_Tab
000234  f3c34207          UBFX     r2,r3,#16,#8
;;;926      cardinfo->SD_cid.OEM_AppliID = tmp << 8;
000238  ea4f2402          LSL      r4,r2,#8
00023c  85cc              STRH     r4,[r1,#0x2e]
;;;927    
;;;928      /*!< Byte 2 */
;;;929      tmp = (uint8_t)((CID_Tab[0] & 0x000000FF00) >> 8);
00023e  4b3c              LDR      r3,|L15.816|
000240  881b              LDRH     r3,[r3,#0]  ; CID_Tab
000242  f3c32207          UBFX     r2,r3,#8,#8
;;;930      cardinfo->SD_cid.OEM_AppliID |= tmp;
000246  8dcb              LDRH     r3,[r1,#0x2e]
000248  ea430302          ORR      r3,r3,r2
00024c  85cb              STRH     r3,[r1,#0x2e]
;;;931    
;;;932      /*!< Byte 3 */
;;;933      tmp = (uint8_t)(CID_Tab[0] & 0x000000FF);
00024e  4b38              LDR      r3,|L15.816|
000250  781a              LDRB     r2,[r3,#0]  ; CID_Tab
;;;934      cardinfo->SD_cid.ProdName1 = tmp << 24;
000252  ea4f6402          LSL      r4,r2,#24
000256  630c              STR      r4,[r1,#0x30]
;;;935    
;;;936      /*!< Byte 4 */
;;;937      tmp = (uint8_t)((CID_Tab[1] & 0xFF000000) >> 24);
000258  685b              LDR      r3,[r3,#4]  ; CID_Tab
00025a  ea4f6213          LSR      r2,r3,#24
;;;938      cardinfo->SD_cid.ProdName1 |= tmp << 16;
00025e  6b0b              LDR      r3,[r1,#0x30]
000260  ea434402          ORR      r4,r3,r2,LSL #16
000264  630c              STR      r4,[r1,#0x30]
;;;939    
;;;940      /*!< Byte 5 */
;;;941      tmp = (uint8_t)((CID_Tab[1] & 0x00FF0000) >> 16);
000266  4b32              LDR      r3,|L15.816|
000268  685b              LDR      r3,[r3,#4]  ; CID_Tab
00026a  f3c34207          UBFX     r2,r3,#16,#8
;;;942      cardinfo->SD_cid.ProdName1 |= tmp << 8;
00026e  6b0b              LDR      r3,[r1,#0x30]
000270  ea432402          ORR      r4,r3,r2,LSL #8
000274  630c              STR      r4,[r1,#0x30]
;;;943    
;;;944      /*!< Byte 6 */
;;;945      tmp = (uint8_t)((CID_Tab[1] & 0x0000FF00) >> 8);
000276  4b2e              LDR      r3,|L15.816|
000278  889b              LDRH     r3,[r3,#4]  ; CID_Tab
00027a  f3c32207          UBFX     r2,r3,#8,#8
;;;946      cardinfo->SD_cid.ProdName1 |= tmp;
00027e  6b0b              LDR      r3,[r1,#0x30]
000280  ea430302          ORR      r3,r3,r2
000284  630b              STR      r3,[r1,#0x30]
;;;947    
;;;948      /*!< Byte 7 */
;;;949      tmp = (uint8_t)(CID_Tab[1] & 0x000000FF);
000286  4b2a              LDR      r3,|L15.816|
000288  791a              LDRB     r2,[r3,#4]  ; CID_Tab
;;;950      cardinfo->SD_cid.ProdName2 = tmp;
00028a  f04f0334          MOV      r3,#0x34
00028e  545a              STRB     r2,[r3,r1]
;;;951    
;;;952      /*!< Byte 8 */
;;;953      tmp = (uint8_t)((CID_Tab[2] & 0xFF000000) >> 24);
000290  4b27              LDR      r3,|L15.816|
000292  689b              LDR      r3,[r3,#8]  ; CID_Tab
000294  ea4f6213          LSR      r2,r3,#24
;;;954      cardinfo->SD_cid.ProdRev = tmp;
000298  f04f0335          MOV      r3,#0x35
00029c  545a              STRB     r2,[r3,r1]
;;;955    
;;;956      /*!< Byte 9 */
;;;957      tmp = (uint8_t)((CID_Tab[2] & 0x00FF0000) >> 16);
00029e  4b24              LDR      r3,|L15.816|
0002a0  689b              LDR      r3,[r3,#8]  ; CID_Tab
0002a2  f3c34207          UBFX     r2,r3,#16,#8
;;;958      cardinfo->SD_cid.ProdSN = tmp << 24;
0002a6  ea4f6402          LSL      r4,r2,#24
0002aa  638c              STR      r4,[r1,#0x38]
;;;959    
;;;960      /*!< Byte 10 */
;;;961      tmp = (uint8_t)((CID_Tab[2] & 0x0000FF00) >> 8);
0002ac  4b20              LDR      r3,|L15.816|
0002ae  891b              LDRH     r3,[r3,#8]  ; CID_Tab
0002b0  f3c32207          UBFX     r2,r3,#8,#8
;;;962      cardinfo->SD_cid.ProdSN |= tmp << 16;
0002b4  6b8b              LDR      r3,[r1,#0x38]
0002b6  ea434402          ORR      r4,r3,r2,LSL #16
0002ba  638c              STR      r4,[r1,#0x38]
;;;963    
;;;964      /*!< Byte 11 */
;;;965      tmp = (uint8_t)(CID_Tab[2] & 0x000000FF);
0002bc  4b1c              LDR      r3,|L15.816|
0002be  7a1a              LDRB     r2,[r3,#8]  ; CID_Tab
;;;966      cardinfo->SD_cid.ProdSN |= tmp << 8;
0002c0  6b8b              LDR      r3,[r1,#0x38]
0002c2  ea432402          ORR      r4,r3,r2,LSL #8
0002c6  638c              STR      r4,[r1,#0x38]
;;;967    
;;;968      /*!< Byte 12 */
;;;969      tmp = (uint8_t)((CID_Tab[3] & 0xFF000000) >> 24);
0002c8  4b19              LDR      r3,|L15.816|
0002ca  68db              LDR      r3,[r3,#0xc]  ; CID_Tab
0002cc  ea4f6213          LSR      r2,r3,#24
;;;970      cardinfo->SD_cid.ProdSN |= tmp;
0002d0  6b8b              LDR      r3,[r1,#0x38]
0002d2  ea430302          ORR      r3,r3,r2
0002d6  638b              STR      r3,[r1,#0x38]
;;;971    
;;;972      /*!< Byte 13 */
;;;973      tmp = (uint8_t)((CID_Tab[3] & 0x00FF0000) >> 16);
0002d8  4b15              LDR      r3,|L15.816|
0002da  68db              LDR      r3,[r3,#0xc]  ; CID_Tab
0002dc  f3c34207          UBFX     r2,r3,#16,#8
;;;974      cardinfo->SD_cid.Reserved1 |= (tmp & 0xF0) >> 4;
0002e0  f04f033c          MOV      r3,#0x3c
0002e4  5c5b              LDRB     r3,[r3,r1]
0002e6  ea431412          ORR      r4,r3,r2,LSR #4
0002ea  f04f033c          MOV      r3,#0x3c
0002ee  545c              STRB     r4,[r3,r1]
;;;975      cardinfo->SD_cid.ManufactDate = (tmp & 0x0F) << 8;
0002f0  ea4f7302          LSL      r3,r2,#28
0002f4  ea4f5413          LSR      r4,r3,#20
0002f8  87cc              STRH     r4,[r1,#0x3e]
;;;976    
;;;977      /*!< Byte 14 */
;;;978      tmp = (uint8_t)((CID_Tab[3] & 0x0000FF00) >> 8);
0002fa  4b0d              LDR      r3,|L15.816|
0002fc  899b              LDRH     r3,[r3,#0xc]  ; CID_Tab
0002fe  f3c32207          UBFX     r2,r3,#8,#8
;;;979      cardinfo->SD_cid.ManufactDate |= tmp;
000302  8fcb              LDRH     r3,[r1,#0x3e]
000304  ea430302          ORR      r3,r3,r2
000308  87cb              STRH     r3,[r1,#0x3e]
;;;980    
;;;981      /*!< Byte 15 */
;;;982      tmp = (uint8_t)(CID_Tab[3] & 0x000000FF);
00030a  4b09              LDR      r3,|L15.816|
00030c  7b1a              LDRB     r2,[r3,#0xc]  ; CID_Tab
;;;983      cardinfo->SD_cid.CID_CRC = (tmp & 0xFE) >> 1;
00030e  ea4f0452          LSR      r4,r2,#1
000312  f04f0340          MOV      r3,#0x40
000316  545c              STRB     r4,[r3,r1]
;;;984      cardinfo->SD_cid.Reserved2 = 1;
000318  f04f0401          MOV      r4,#1
00031c  f04f0341          MOV      r3,#0x41
000320  545c              STRB     r4,[r3,r1]
;;;985    
;;;986      return(errorstatus);
;;;987    }
000322  bdf0              POP      {r4-r7,pc}
;;;988    
                          ENDP

                  |L15.804|
                          DCD      CardType
                  |L15.808|
                          DCD      ||RCA||
                  |L15.812|
                          DCD      CSD_Tab
                  |L15.816|
                          DCD      CID_Tab

                          AREA ||i.SD_GetCardStatus||, CODE, READONLY, ALIGN=2

                  SD_GetCardStatus PROC
;;;998      */
;;;999    SD_Error SD_GetCardStatus(SD_CardStatus *cardstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1000   {
000002  4604              MOV      r4,r0
;;;1001     SD_Error errorstatus = SD_OK;
000004  2600              MOVS     r6,#0
;;;1002     uint8_t tmp = 0;
000006  2500              MOVS     r5,#0
;;;1003   
;;;1004     errorstatus = SD_SendSDStatus((uint32_t *)SDSTATUS_Tab);
000008  4824              LDR      r0,|L16.156|
00000a  f7fffffe          BL       SD_SendSDStatus
00000e  4606              MOV      r6,r0
;;;1005   
;;;1006     if (errorstatus  != SD_OK)
000010  b10e              CBZ      r6,|L16.22|
;;;1007     {
;;;1008       return(errorstatus);
000012  4630              MOV      r0,r6
                  |L16.20|
;;;1009     }
;;;1010   
;;;1011     /*!< Byte 0 */
;;;1012     tmp = (uint8_t)((SDSTATUS_Tab[0] & 0xC0) >> 6);
;;;1013     cardstatus->DAT_BUS_WIDTH = tmp;
;;;1014   
;;;1015     /*!< Byte 0 */
;;;1016     tmp = (uint8_t)((SDSTATUS_Tab[0] & 0x20) >> 5);
;;;1017     cardstatus->SECURED_MODE = tmp;
;;;1018   
;;;1019     /*!< Byte 2 */
;;;1020     tmp = (uint8_t)((SDSTATUS_Tab[2] & 0xFF));
;;;1021     cardstatus->SD_CARD_TYPE = tmp << 8;
;;;1022   
;;;1023     /*!< Byte 3 */
;;;1024     tmp = (uint8_t)((SDSTATUS_Tab[3] & 0xFF));
;;;1025     cardstatus->SD_CARD_TYPE |= tmp;
;;;1026   
;;;1027     /*!< Byte 4 */
;;;1028     tmp = (uint8_t)(SDSTATUS_Tab[4] & 0xFF);
;;;1029     cardstatus->SIZE_OF_PROTECTED_AREA = tmp << 24;
;;;1030   
;;;1031     /*!< Byte 5 */
;;;1032     tmp = (uint8_t)(SDSTATUS_Tab[5] & 0xFF);
;;;1033     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp << 16;
;;;1034   
;;;1035     /*!< Byte 6 */
;;;1036     tmp = (uint8_t)(SDSTATUS_Tab[6] & 0xFF);
;;;1037     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp << 8;
;;;1038   
;;;1039     /*!< Byte 7 */
;;;1040     tmp = (uint8_t)(SDSTATUS_Tab[7] & 0xFF);
;;;1041     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp;
;;;1042   
;;;1043     /*!< Byte 8 */
;;;1044     tmp = (uint8_t)((SDSTATUS_Tab[8] & 0xFF));
;;;1045     cardstatus->SPEED_CLASS = tmp;
;;;1046   
;;;1047     /*!< Byte 9 */
;;;1048     tmp = (uint8_t)((SDSTATUS_Tab[9] & 0xFF));
;;;1049     cardstatus->PERFORMANCE_MOVE = tmp;
;;;1050   
;;;1051     /*!< Byte 10 */
;;;1052     tmp = (uint8_t)((SDSTATUS_Tab[10] & 0xF0) >> 4);
;;;1053     cardstatus->AU_SIZE = tmp;
;;;1054   
;;;1055     /*!< Byte 11 */
;;;1056     tmp = (uint8_t)(SDSTATUS_Tab[11] & 0xFF);
;;;1057     cardstatus->ERASE_SIZE = tmp << 8;
;;;1058   
;;;1059     /*!< Byte 12 */
;;;1060     tmp = (uint8_t)(SDSTATUS_Tab[12] & 0xFF);
;;;1061     cardstatus->ERASE_SIZE |= tmp;
;;;1062   
;;;1063     /*!< Byte 13 */
;;;1064     tmp = (uint8_t)((SDSTATUS_Tab[13] & 0xFC) >> 2);
;;;1065     cardstatus->ERASE_TIMEOUT = tmp;
;;;1066   
;;;1067     /*!< Byte 13 */
;;;1068     tmp = (uint8_t)((SDSTATUS_Tab[13] & 0x3));
;;;1069     cardstatus->ERASE_OFFSET = tmp;
;;;1070   
;;;1071     return(errorstatus);
;;;1072   }
000014  bd70              POP      {r4-r6,pc}
                  |L16.22|
000016  4821              LDR      r0,|L16.156|
000018  7800              LDRB     r0,[r0,#0]            ;1012  ; SDSTATUS_Tab
00001a  0985              LSRS     r5,r0,#6              ;1012
00001c  7025              STRB     r5,[r4,#0]            ;1013
00001e  481f              LDR      r0,|L16.156|
000020  7800              LDRB     r0,[r0,#0]            ;1016  ; SDSTATUS_Tab
000022  f3c01540          UBFX     r5,r0,#5,#1           ;1016
000026  7065              STRB     r5,[r4,#1]            ;1017
000028  481c              LDR      r0,|L16.156|
00002a  7885              LDRB     r5,[r0,#2]            ;1020  ; SDSTATUS_Tab
00002c  0228              LSLS     r0,r5,#8              ;1021
00002e  8060              STRH     r0,[r4,#2]            ;1021
000030  481a              LDR      r0,|L16.156|
000032  78c5              LDRB     r5,[r0,#3]            ;1024  ; SDSTATUS_Tab
000034  8860              LDRH     r0,[r4,#2]            ;1025
000036  4328              ORRS     r0,r0,r5              ;1025
000038  8060              STRH     r0,[r4,#2]            ;1025
00003a  4818              LDR      r0,|L16.156|
00003c  7905              LDRB     r5,[r0,#4]            ;1028  ; SDSTATUS_Tab
00003e  0628              LSLS     r0,r5,#24             ;1029
000040  6060              STR      r0,[r4,#4]            ;1029
000042  4816              LDR      r0,|L16.156|
000044  7945              LDRB     r5,[r0,#5]            ;1032  ; SDSTATUS_Tab
000046  6860              LDR      r0,[r4,#4]            ;1033
000048  ea404005          ORR      r0,r0,r5,LSL #16      ;1033
00004c  6060              STR      r0,[r4,#4]            ;1033
00004e  4813              LDR      r0,|L16.156|
000050  7985              LDRB     r5,[r0,#6]            ;1036  ; SDSTATUS_Tab
000052  6860              LDR      r0,[r4,#4]            ;1037
000054  ea402005          ORR      r0,r0,r5,LSL #8       ;1037
000058  6060              STR      r0,[r4,#4]            ;1037
00005a  4810              LDR      r0,|L16.156|
00005c  79c5              LDRB     r5,[r0,#7]            ;1040  ; SDSTATUS_Tab
00005e  6860              LDR      r0,[r4,#4]            ;1041
000060  4328              ORRS     r0,r0,r5              ;1041
000062  6060              STR      r0,[r4,#4]            ;1041
000064  480d              LDR      r0,|L16.156|
000066  7a05              LDRB     r5,[r0,#8]            ;1044  ; SDSTATUS_Tab
000068  7225              STRB     r5,[r4,#8]            ;1045
00006a  7a45              LDRB     r5,[r0,#9]            ;1048  ; SDSTATUS_Tab
00006c  7265              STRB     r5,[r4,#9]            ;1049
00006e  7a80              LDRB     r0,[r0,#0xa]          ;1052  ; SDSTATUS_Tab
000070  0905              LSRS     r5,r0,#4              ;1052
000072  72a5              STRB     r5,[r4,#0xa]          ;1053
000074  4809              LDR      r0,|L16.156|
000076  7ac5              LDRB     r5,[r0,#0xb]          ;1056  ; SDSTATUS_Tab
000078  0228              LSLS     r0,r5,#8              ;1057
00007a  81a0              STRH     r0,[r4,#0xc]          ;1057
00007c  4807              LDR      r0,|L16.156|
00007e  7b05              LDRB     r5,[r0,#0xc]          ;1060  ; SDSTATUS_Tab
000080  89a0              LDRH     r0,[r4,#0xc]          ;1061
000082  4328              ORRS     r0,r0,r5              ;1061
000084  81a0              STRH     r0,[r4,#0xc]          ;1061
000086  4805              LDR      r0,|L16.156|
000088  7b40              LDRB     r0,[r0,#0xd]          ;1064  ; SDSTATUS_Tab
00008a  0885              LSRS     r5,r0,#2              ;1064
00008c  73a5              STRB     r5,[r4,#0xe]          ;1065
00008e  4803              LDR      r0,|L16.156|
000090  7b40              LDRB     r0,[r0,#0xd]          ;1068  ; SDSTATUS_Tab
000092  f0000503          AND      r5,r0,#3              ;1068
000096  73e5              STRB     r5,[r4,#0xf]          ;1069
000098  4630              MOV      r0,r6                 ;1071
00009a  e7bb              B        |L16.20|
;;;1073   
                          ENDP

                  |L16.156|
                          DCD      SDSTATUS_Tab

                          AREA ||i.SD_GetState||, CODE, READONLY, ALIGN=1

                  SD_GetState PROC
;;;493      */
;;;494    SDCardState SD_GetState(void)
000000  b508              PUSH     {r3,lr}
;;;495    {
;;;496      uint32_t resp1 = 0;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;497    
;;;498      if(SD_Detect()== SD_PRESENT)
000006  f7fffffe          BL       SD_Detect
00000a  2801              CMP      r0,#1
00000c  d109              BNE      |L17.34|
;;;499      {
;;;500        if (SD_SendStatus(&resp1) != SD_OK)
00000e  4668              MOV      r0,sp
000010  f7fffffe          BL       SD_SendStatus
000014  b108              CBZ      r0,|L17.26|
;;;501        {
;;;502          return SD_CARD_ERROR;
000016  20ff              MOVS     r0,#0xff
                  |L17.24|
;;;503        }
;;;504        else
;;;505        {
;;;506          return (SDCardState)((resp1 >> 9) & 0x0F);
;;;507        }
;;;508      }
;;;509      else
;;;510      {
;;;511        return SD_CARD_ERROR;
;;;512      }
;;;513    }
000018  bd08              POP      {r3,pc}
                  |L17.26|
00001a  9800              LDR      r0,[sp,#0]            ;506
00001c  f3c02043          UBFX     r0,r0,#9,#4           ;506
000020  e7fa              B        |L17.24|
                  |L17.34|
000022  20ff              MOVS     r0,#0xff              ;511
000024  e7f8              B        |L17.24|
;;;514    
                          ENDP


                          AREA ||i.SD_GetStatus||, CODE, READONLY, ALIGN=1

                  SD_GetStatus PROC
;;;468      */
;;;469    SDTransferState SD_GetStatus(void)
000000  b510              PUSH     {r4,lr}
;;;470    {
;;;471      SDCardState cardstate =  SD_CARD_TRANSFER;
000002  2404              MOVS     r4,#4
;;;472    
;;;473      cardstate = SD_GetState();
000004  f7fffffe          BL       SD_GetState
000008  4604              MOV      r4,r0
;;;474    
;;;475      if (cardstate == SD_CARD_TRANSFER)
00000a  2c04              CMP      r4,#4
00000c  d101              BNE      |L18.18|
;;;476      {
;;;477        return(SD_TRANSFER_OK);
00000e  2000              MOVS     r0,#0
                  |L18.16|
;;;478      }
;;;479      else if(cardstate == SD_CARD_ERROR)
;;;480      {
;;;481        return (SD_TRANSFER_ERROR);
;;;482      }
;;;483      else
;;;484      {
;;;485        return(SD_TRANSFER_BUSY);
;;;486      }
;;;487    }
000010  bd10              POP      {r4,pc}
                  |L18.18|
000012  2cff              CMP      r4,#0xff              ;479
000014  d101              BNE      |L18.26|
000016  2002              MOVS     r0,#2                 ;481
000018  e7fa              B        |L18.16|
                  |L18.26|
00001a  2001              MOVS     r0,#1                 ;485
00001c  e7f8              B        |L18.16|
;;;488    
                          ENDP


                          AREA ||i.SD_GetTransferState||, CODE, READONLY, ALIGN=2

                  SD_GetTransferState PROC
;;;1718     */
;;;1719   SDTransferState SD_GetTransferState(void)
000000  4804              LDR      r0,|L19.20|
;;;1720   {
;;;1721     if (SDIO->STA & (SDIO_FLAG_TXACT | SDIO_FLAG_RXACT))
000002  6800              LDR      r0,[r0,#0]
000004  f4105f40          TST      r0,#0x3000
000008  d001              BEQ      |L19.14|
;;;1722     {
;;;1723       return(SD_TRANSFER_BUSY);
00000a  2001              MOVS     r0,#1
                  |L19.12|
;;;1724     }
;;;1725     else
;;;1726     {
;;;1727       return(SD_TRANSFER_OK);
;;;1728     }
;;;1729   }
00000c  4770              BX       lr
                  |L19.14|
00000e  2000              MOVS     r0,#0                 ;1727
000010  e7fc              B        |L19.12|
;;;1730   
                          ENDP

000012  0000              DCW      0x0000
                  |L19.20|
                          DCD      0x40012c34

                          AREA ||i.SD_Init||, CODE, READONLY, ALIGN=2

                  SD_Init PROC
;;;404      */
;;;405    SD_Error SD_Init(void)
000000  b508              PUSH     {r3,lr}
;;;406    {
;;;407      __IO SD_Error errorstatus = SD_OK;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;408    
;;;409      /* NVIC */
;;;410      SDIO_Interrupts_Config();
000006  f7fffffe          BL       SDIO_Interrupts_Config
;;;411    	
;;;412      /* SDIO Peripheral Low Level Init */
;;;413      SD_LowLevel_Init();
00000a  f7fffffe          BL       SD_LowLevel_Init
;;;414    
;;;415      SDIO_DeInit();
00000e  f7fffffe          BL       SDIO_DeInit
;;;416    
;;;417      errorstatus = SD_PowerON();
000012  f7fffffe          BL       SD_PowerON
000016  9000              STR      r0,[sp,#0]
;;;418    
;;;419      if (errorstatus != SD_OK)
000018  f89d0000          LDRB     r0,[sp,#0]
00001c  b110              CBZ      r0,|L20.36|
;;;420      {
;;;421        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;422        return(errorstatus);
00001e  f89d0000          LDRB     r0,[sp,#0]
                  |L20.34|
;;;423      }
;;;424    
;;;425      errorstatus = SD_InitializeCards();
;;;426    
;;;427      if (errorstatus != SD_OK)
;;;428      {
;;;429        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;430        return(errorstatus);
;;;431      }
;;;432    
;;;433      /*!< Configure the SDIO peripheral */
;;;434      /*!< SDIO_CK = SDIOCLK / (SDIO_TRANSFER_CLK_DIV + 2) */
;;;435      /*!< on STM32F4xx devices, SDIOCLK is fixed to 48MHz */
;;;436      SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV;
;;;437      SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;438      SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;439      SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;440      SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
;;;441      SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;442      SDIO_Init(&SDIO_InitStructure);
;;;443    
;;;444      /*----------------- Read CSD/CID MSD registers ------------------*/
;;;445      errorstatus = SD_GetCardInfo(&SDCardInfo);
;;;446    
;;;447      if (errorstatus == SD_OK)
;;;448      {
;;;449        /*----------------- Select Card --------------------------------*/
;;;450        errorstatus = SD_SelectDeselect((uint32_t) (SDCardInfo.RCA << 16));
;;;451      }
;;;452    
;;;453      if (errorstatus == SD_OK)
;;;454      {
;;;455        errorstatus = SD_EnableWideBusOperation(SDIO_BusWide_4b);
;;;456      }
;;;457    
;;;458      return(errorstatus);
;;;459    }
000022  bd08              POP      {r3,pc}
                  |L20.36|
000024  f7fffffe          BL       SD_InitializeCards
000028  9000              STR      r0,[sp,#0]            ;425
00002a  f89d0000          LDRB     r0,[sp,#0]            ;427
00002e  b110              CBZ      r0,|L20.54|
000030  f89d0000          LDRB     r0,[sp,#0]            ;430
000034  e7f5              B        |L20.34|
                  |L20.54|
000036  2000              MOVS     r0,#0                 ;436
000038  4911              LDR      r1,|L20.128|
00003a  7508              STRB     r0,[r1,#0x14]         ;436
00003c  6008              STR      r0,[r1,#0]            ;437  ; SDIO_InitStructure
00003e  6048              STR      r0,[r1,#4]            ;438  ; SDIO_InitStructure
000040  6088              STR      r0,[r1,#8]            ;439  ; SDIO_InitStructure
000042  60c8              STR      r0,[r1,#0xc]          ;440  ; SDIO_InitStructure
000044  6108              STR      r0,[r1,#0x10]         ;441  ; SDIO_InitStructure
000046  4608              MOV      r0,r1                 ;442
000048  f7fffffe          BL       SDIO_Init
00004c  480d              LDR      r0,|L20.132|
00004e  f7fffffe          BL       SD_GetCardInfo
000052  9000              STR      r0,[sp,#0]            ;445
000054  f89d0000          LDRB     r0,[sp,#0]            ;447
000058  b930              CBNZ     r0,|L20.104|
00005a  490a              LDR      r1,|L20.132|
00005c  f8b11054          LDRH     r1,[r1,#0x54]         ;450  ; SDCardInfo
000060  0408              LSLS     r0,r1,#16             ;450
000062  f7fffffe          BL       SD_SelectDeselect
000066  9000              STR      r0,[sp,#0]            ;450
                  |L20.104|
000068  f89d0000          LDRB     r0,[sp,#0]            ;453
00006c  b920              CBNZ     r0,|L20.120|
00006e  f44f6000          MOV      r0,#0x800             ;455
000072  f7fffffe          BL       SD_EnableWideBusOperation
000076  9000              STR      r0,[sp,#0]            ;455
                  |L20.120|
000078  f89d0000          LDRB     r0,[sp,#0]            ;458
00007c  e7d1              B        |L20.34|
;;;460    
                          ENDP

00007e  0000              DCW      0x0000
                  |L20.128|
                          DCD      SDIO_InitStructure
                  |L20.132|
                          DCD      SDCardInfo

                          AREA ||i.SD_InitializeCards||, CODE, READONLY, ALIGN=2

                  SD_InitializeCards PROC
;;;697      */
;;;698    SD_Error SD_InitializeCards(void)
000000  b538              PUSH     {r3-r5,lr}
;;;699    {
;;;700      SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;701      uint16_t rca = 0x01;
000004  2001              MOVS     r0,#1
000006  9000              STR      r0,[sp,#0]
;;;702    
;;;703      if (SDIO_GetPowerState() == SDIO_PowerState_OFF)
000008  f7fffffe          BL       SDIO_GetPowerState
00000c  b910              CBNZ     r0,|L21.20|
;;;704      {
;;;705        errorstatus = SD_REQUEST_NOT_APPLICABLE;
00000e  2425              MOVS     r4,#0x25
;;;706        return(errorstatus);
000010  4620              MOV      r0,r4
                  |L21.18|
;;;707      }
;;;708    
;;;709      if (SDIO_SECURE_DIGITAL_IO_CARD != CardType)
;;;710      {
;;;711        /*!< Send CMD2 ALL_SEND_CID */
;;;712        SDIO_CmdInitStructure.SDIO_Argument = 0x0;
;;;713        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_ALL_SEND_CID;
;;;714        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Long;
;;;715        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;716        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;717        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;718    
;;;719        errorstatus = CmdResp2Error();
;;;720    
;;;721        if (SD_OK != errorstatus)
;;;722        {
;;;723          return(errorstatus);
;;;724        }
;;;725    
;;;726        CID_Tab[0] = SDIO_GetResponse(SDIO_RESP1);
;;;727        CID_Tab[1] = SDIO_GetResponse(SDIO_RESP2);
;;;728        CID_Tab[2] = SDIO_GetResponse(SDIO_RESP3);
;;;729        CID_Tab[3] = SDIO_GetResponse(SDIO_RESP4);
;;;730      }
;;;731      if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) ||  (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) ||  (SDIO_SECURE_DIGITAL_IO_COMBO_CARD == CardType)
;;;732          ||  (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;733      {
;;;734        /*!< Send CMD3 SET_REL_ADDR with argument 0 */
;;;735        /*!< SD Card publishes its RCA. */
;;;736        SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;737        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_REL_ADDR;
;;;738        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;739        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;740        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;741        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;742    
;;;743        errorstatus = CmdResp6Error(SD_CMD_SET_REL_ADDR, &rca);
;;;744    
;;;745        if (SD_OK != errorstatus)
;;;746        {
;;;747          return(errorstatus);
;;;748        }
;;;749      }
;;;750    
;;;751      if (SDIO_SECURE_DIGITAL_IO_CARD != CardType)
;;;752      {
;;;753        RCA = rca;
;;;754    
;;;755        /*!< Send CMD9 SEND_CSD with argument as card's RCA */
;;;756        SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)(rca << 16);
;;;757        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_CSD;
;;;758        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Long;
;;;759        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;760        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;761        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;762    
;;;763        errorstatus = CmdResp2Error();
;;;764    
;;;765        if (SD_OK != errorstatus)
;;;766        {
;;;767          return(errorstatus);
;;;768        }
;;;769    
;;;770        CSD_Tab[0] = SDIO_GetResponse(SDIO_RESP1);
;;;771        CSD_Tab[1] = SDIO_GetResponse(SDIO_RESP2);
;;;772        CSD_Tab[2] = SDIO_GetResponse(SDIO_RESP3);
;;;773        CSD_Tab[3] = SDIO_GetResponse(SDIO_RESP4);
;;;774      }
;;;775    
;;;776      errorstatus = SD_OK; /*!< All cards get intialized */
;;;777    
;;;778      return(errorstatus);
;;;779    }
000012  bd38              POP      {r3-r5,pc}
                  |L21.20|
000014  4844              LDR      r0,|L21.296|
000016  6800              LDR      r0,[r0,#0]            ;709  ; CardType
000018  2804              CMP      r0,#4                 ;709
00001a  d028              BEQ      |L21.110|
00001c  2000              MOVS     r0,#0                 ;712
00001e  4943              LDR      r1,|L21.300|
000020  6008              STR      r0,[r1,#0]            ;712  ; SDIO_CmdInitStructure
000022  2002              MOVS     r0,#2                 ;713
000024  6048              STR      r0,[r1,#4]            ;713  ; SDIO_CmdInitStructure
000026  20c0              MOVS     r0,#0xc0              ;714
000028  6088              STR      r0,[r1,#8]            ;714  ; SDIO_CmdInitStructure
00002a  2000              MOVS     r0,#0                 ;715
00002c  60c8              STR      r0,[r1,#0xc]          ;715  ; SDIO_CmdInitStructure
00002e  f44f6080          MOV      r0,#0x400             ;716
000032  6108              STR      r0,[r1,#0x10]         ;716  ; SDIO_CmdInitStructure
000034  4608              MOV      r0,r1                 ;717
000036  f7fffffe          BL       SDIO_SendCommand
00003a  f7fffffe          BL       CmdResp2Error
00003e  4604              MOV      r4,r0                 ;719
000040  b10c              CBZ      r4,|L21.70|
000042  4620              MOV      r0,r4                 ;723
000044  e7e5              B        |L21.18|
                  |L21.70|
000046  2000              MOVS     r0,#0                 ;726
000048  f7fffffe          BL       SDIO_GetResponse
00004c  4938              LDR      r1,|L21.304|
00004e  6008              STR      r0,[r1,#0]            ;726  ; CID_Tab
000050  2004              MOVS     r0,#4                 ;727
000052  f7fffffe          BL       SDIO_GetResponse
000056  4936              LDR      r1,|L21.304|
000058  6048              STR      r0,[r1,#4]            ;727  ; CID_Tab
00005a  2008              MOVS     r0,#8                 ;728
00005c  f7fffffe          BL       SDIO_GetResponse
000060  4933              LDR      r1,|L21.304|
000062  6088              STR      r0,[r1,#8]            ;728  ; CID_Tab
000064  200c              MOVS     r0,#0xc               ;729
000066  f7fffffe          BL       SDIO_GetResponse
00006a  4931              LDR      r1,|L21.304|
00006c  60c8              STR      r0,[r1,#0xc]          ;729  ; CID_Tab
                  |L21.110|
00006e  482e              LDR      r0,|L21.296|
000070  6800              LDR      r0,[r0,#0]            ;731  ; CardType
000072  b158              CBZ      r0,|L21.140|
000074  482c              LDR      r0,|L21.296|
000076  6800              LDR      r0,[r0,#0]            ;731  ; CardType
000078  2801              CMP      r0,#1                 ;731
00007a  d007              BEQ      |L21.140|
00007c  482a              LDR      r0,|L21.296|
00007e  6800              LDR      r0,[r0,#0]            ;731  ; CardType
000080  2806              CMP      r0,#6                 ;731
000082  d003              BEQ      |L21.140|
000084  4828              LDR      r0,|L21.296|
000086  6800              LDR      r0,[r0,#0]            ;732  ; CardType
000088  2802              CMP      r0,#2                 ;732
00008a  d116              BNE      |L21.186|
                  |L21.140|
00008c  2000              MOVS     r0,#0                 ;736
00008e  4927              LDR      r1,|L21.300|
000090  6008              STR      r0,[r1,#0]            ;736  ; SDIO_CmdInitStructure
000092  2003              MOVS     r0,#3                 ;737
000094  6048              STR      r0,[r1,#4]            ;737  ; SDIO_CmdInitStructure
000096  2040              MOVS     r0,#0x40              ;738
000098  6088              STR      r0,[r1,#8]            ;738  ; SDIO_CmdInitStructure
00009a  2000              MOVS     r0,#0                 ;739
00009c  60c8              STR      r0,[r1,#0xc]          ;739  ; SDIO_CmdInitStructure
00009e  f44f6080          MOV      r0,#0x400             ;740
0000a2  6108              STR      r0,[r1,#0x10]         ;740  ; SDIO_CmdInitStructure
0000a4  4608              MOV      r0,r1                 ;741
0000a6  f7fffffe          BL       SDIO_SendCommand
0000aa  4669              MOV      r1,sp                 ;743
0000ac  2003              MOVS     r0,#3                 ;743
0000ae  f7fffffe          BL       CmdResp6Error
0000b2  4604              MOV      r4,r0                 ;743
0000b4  b10c              CBZ      r4,|L21.186|
0000b6  4620              MOV      r0,r4                 ;747
0000b8  e7ab              B        |L21.18|
                  |L21.186|
0000ba  481b              LDR      r0,|L21.296|
0000bc  6800              LDR      r0,[r0,#0]            ;751  ; CardType
0000be  2804              CMP      r0,#4                 ;751
0000c0  d02e              BEQ      |L21.288|
0000c2  f8bd0000          LDRH     r0,[sp,#0]            ;753
0000c6  491b              LDR      r1,|L21.308|
0000c8  6008              STR      r0,[r1,#0]            ;753  ; RCA
0000ca  f8bd0000          LDRH     r0,[sp,#0]            ;756
0000ce  0400              LSLS     r0,r0,#16             ;756
0000d0  4916              LDR      r1,|L21.300|
0000d2  6008              STR      r0,[r1,#0]            ;756  ; SDIO_CmdInitStructure
0000d4  2009              MOVS     r0,#9                 ;757
0000d6  6048              STR      r0,[r1,#4]            ;757  ; SDIO_CmdInitStructure
0000d8  20c0              MOVS     r0,#0xc0              ;758
0000da  6088              STR      r0,[r1,#8]            ;758  ; SDIO_CmdInitStructure
0000dc  2000              MOVS     r0,#0                 ;759
0000de  60c8              STR      r0,[r1,#0xc]          ;759  ; SDIO_CmdInitStructure
0000e0  f44f6080          MOV      r0,#0x400             ;760
0000e4  6108              STR      r0,[r1,#0x10]         ;760  ; SDIO_CmdInitStructure
0000e6  4608              MOV      r0,r1                 ;761
0000e8  f7fffffe          BL       SDIO_SendCommand
0000ec  f7fffffe          BL       CmdResp2Error
0000f0  4604              MOV      r4,r0                 ;763
0000f2  b10c              CBZ      r4,|L21.248|
0000f4  4620              MOV      r0,r4                 ;767
0000f6  e78c              B        |L21.18|
                  |L21.248|
0000f8  2000              MOVS     r0,#0                 ;770
0000fa  f7fffffe          BL       SDIO_GetResponse
0000fe  490e              LDR      r1,|L21.312|
000100  6008              STR      r0,[r1,#0]            ;770  ; CSD_Tab
000102  2004              MOVS     r0,#4                 ;771
000104  f7fffffe          BL       SDIO_GetResponse
000108  490b              LDR      r1,|L21.312|
00010a  6048              STR      r0,[r1,#4]            ;771  ; CSD_Tab
00010c  2008              MOVS     r0,#8                 ;772
00010e  f7fffffe          BL       SDIO_GetResponse
000112  4909              LDR      r1,|L21.312|
000114  6088              STR      r0,[r1,#8]            ;772  ; CSD_Tab
000116  200c              MOVS     r0,#0xc               ;773
000118  f7fffffe          BL       SDIO_GetResponse
00011c  4906              LDR      r1,|L21.312|
00011e  60c8              STR      r0,[r1,#0xc]          ;773  ; CSD_Tab
                  |L21.288|
000120  2400              MOVS     r4,#0                 ;776
000122  4620              MOV      r0,r4                 ;778
000124  e775              B        |L21.18|
;;;780    
                          ENDP

000126  0000              DCW      0x0000
                  |L21.296|
                          DCD      CardType
                  |L21.300|
                          DCD      SDIO_CmdInitStructure
                  |L21.304|
                          DCD      CID_Tab
                  |L21.308|
                          DCD      ||RCA||
                  |L21.312|
                          DCD      CSD_Tab

                          AREA ||i.SD_LowLevel_DMA_RxConfig||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DMA_RxConfig PROC
;;;2949     */
;;;2950   void SD_LowLevel_DMA_RxConfig(uint32_t *BufferDST, uint32_t BufferSize)
000000  b530              PUSH     {r4,r5,lr}
;;;2951   {
000002  b08f              SUB      sp,sp,#0x3c
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;2952     DMA_InitTypeDef SDDMA_InitStructure;
;;;2953   
;;;2954     DMA_ClearFlag(SD_SDIO_DMA_STREAM, SD_SDIO_DMA_FLAG_FEIF | SD_SDIO_DMA_FLAG_DMEIF | SD_SDIO_DMA_FLAG_TEIF | SD_SDIO_DMA_FLAG_HTIF | SD_SDIO_DMA_FLAG_TCIF);
000008  f04f51fa          MOV      r1,#0x1f400000
00000c  481d              LDR      r0,|L22.132|
00000e  f7fffffe          BL       DMA_ClearFlag
;;;2955   
;;;2956     /* DMA2 Stream3  or Stream6 disable */
;;;2957     DMA_Cmd(SD_SDIO_DMA_STREAM, DISABLE);
000012  2100              MOVS     r1,#0
000014  481b              LDR      r0,|L22.132|
000016  f7fffffe          BL       DMA_Cmd
;;;2958   
;;;2959     /* DMA2 Stream3 or Stream6 Config */
;;;2960     DMA_DeInit(SD_SDIO_DMA_STREAM);
00001a  481a              LDR      r0,|L22.132|
00001c  f7fffffe          BL       DMA_DeInit
;;;2961   
;;;2962     SDDMA_InitStructure.DMA_Channel = SD_SDIO_DMA_CHANNEL;
000020  f04f6000          MOV      r0,#0x8000000
000024  9000              STR      r0,[sp,#0]
;;;2963     SDDMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)SDIO_FIFO_ADDRESS;
000026  4818              LDR      r0,|L22.136|
000028  9001              STR      r0,[sp,#4]
;;;2964     SDDMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)BufferDST;
00002a  9402              STR      r4,[sp,#8]
;;;2965     SDDMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;
00002c  2000              MOVS     r0,#0
00002e  9003              STR      r0,[sp,#0xc]
;;;2966     SDDMA_InitStructure.DMA_BufferSize = 0;
000030  9004              STR      r0,[sp,#0x10]
;;;2967     SDDMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
000032  9005              STR      r0,[sp,#0x14]
;;;2968     SDDMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
000034  f44f6080          MOV      r0,#0x400
000038  9006              STR      r0,[sp,#0x18]
;;;2969     SDDMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;
00003a  0080              LSLS     r0,r0,#2
00003c  9007              STR      r0,[sp,#0x1c]
;;;2970     SDDMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;
00003e  0080              LSLS     r0,r0,#2
000040  9008              STR      r0,[sp,#0x20]
;;;2971     SDDMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
000042  2000              MOVS     r0,#0
000044  9009              STR      r0,[sp,#0x24]
;;;2972     SDDMA_InitStructure.DMA_Priority = DMA_Priority_VeryHigh;
000046  f44f3040          MOV      r0,#0x30000
00004a  900a              STR      r0,[sp,#0x28]
;;;2973     SDDMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Enable;
00004c  2004              MOVS     r0,#4
00004e  900b              STR      r0,[sp,#0x2c]
;;;2974     SDDMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_Full;
000050  2003              MOVS     r0,#3
000052  900c              STR      r0,[sp,#0x30]
;;;2975     SDDMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_INC4;
000054  f44f0000          MOV      r0,#0x800000
000058  900d              STR      r0,[sp,#0x34]
;;;2976     SDDMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_INC4;
00005a  1080              ASRS     r0,r0,#2
00005c  900e              STR      r0,[sp,#0x38]
;;;2977     DMA_Init(SD_SDIO_DMA_STREAM, &SDDMA_InitStructure);
00005e  4669              MOV      r1,sp
000060  4808              LDR      r0,|L22.132|
000062  f7fffffe          BL       DMA_Init
;;;2978     DMA_ITConfig(SD_SDIO_DMA_STREAM, DMA_IT_TC, ENABLE);
000066  2201              MOVS     r2,#1
000068  2110              MOVS     r1,#0x10
00006a  4806              LDR      r0,|L22.132|
00006c  f7fffffe          BL       DMA_ITConfig
;;;2979     DMA_FlowControllerConfig(SD_SDIO_DMA_STREAM, DMA_FlowCtrl_Peripheral);
000070  2120              MOVS     r1,#0x20
000072  4804              LDR      r0,|L22.132|
000074  f7fffffe          BL       DMA_FlowControllerConfig
;;;2980   
;;;2981     /* DMA2 Stream3 or Stream6 enable */
;;;2982     DMA_Cmd(SD_SDIO_DMA_STREAM, ENABLE);
000078  2101              MOVS     r1,#1
00007a  4802              LDR      r0,|L22.132|
00007c  f7fffffe          BL       DMA_Cmd
;;;2983   }
000080  b00f              ADD      sp,sp,#0x3c
000082  bd30              POP      {r4,r5,pc}
;;;2984   
                          ENDP

                  |L22.132|
                          DCD      0x40026458
                  |L22.136|
                          DCD      0x40012c80

                          AREA ||i.SD_LowLevel_DMA_TxConfig||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DMA_TxConfig PROC
;;;2907     */
;;;2908   void SD_LowLevel_DMA_TxConfig(uint32_t *BufferSRC, uint32_t BufferSize)
000000  b530              PUSH     {r4,r5,lr}
;;;2909   {
000002  b08f              SUB      sp,sp,#0x3c
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;2910     DMA_InitTypeDef SDDMA_InitStructure;
;;;2911   
;;;2912     DMA_ClearFlag(SD_SDIO_DMA_STREAM, SD_SDIO_DMA_FLAG_FEIF | SD_SDIO_DMA_FLAG_DMEIF | SD_SDIO_DMA_FLAG_TEIF | SD_SDIO_DMA_FLAG_HTIF | SD_SDIO_DMA_FLAG_TCIF);
000008  f04f51fa          MOV      r1,#0x1f400000
00000c  481e              LDR      r0,|L23.136|
00000e  f7fffffe          BL       DMA_ClearFlag
;;;2913   
;;;2914     /* DMA2 Stream3  or Stream6 disable */
;;;2915     DMA_Cmd(SD_SDIO_DMA_STREAM, DISABLE);
000012  2100              MOVS     r1,#0
000014  481c              LDR      r0,|L23.136|
000016  f7fffffe          BL       DMA_Cmd
;;;2916   
;;;2917     /* DMA2 Stream3  or Stream6 Config */
;;;2918     DMA_DeInit(SD_SDIO_DMA_STREAM);
00001a  481b              LDR      r0,|L23.136|
00001c  f7fffffe          BL       DMA_DeInit
;;;2919   
;;;2920     SDDMA_InitStructure.DMA_Channel = SD_SDIO_DMA_CHANNEL;
000020  f04f6000          MOV      r0,#0x8000000
000024  9000              STR      r0,[sp,#0]
;;;2921     SDDMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)SDIO_FIFO_ADDRESS;
000026  4819              LDR      r0,|L23.140|
000028  9001              STR      r0,[sp,#4]
;;;2922     SDDMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)BufferSRC;
00002a  9402              STR      r4,[sp,#8]
;;;2923     SDDMA_InitStructure.DMA_DIR = DMA_DIR_MemoryToPeripheral;
00002c  2040              MOVS     r0,#0x40
00002e  9003              STR      r0,[sp,#0xc]
;;;2924     SDDMA_InitStructure.DMA_BufferSize = 0;
000030  2000              MOVS     r0,#0
000032  9004              STR      r0,[sp,#0x10]
;;;2925     SDDMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
000034  9005              STR      r0,[sp,#0x14]
;;;2926     SDDMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
000036  f44f6080          MOV      r0,#0x400
00003a  9006              STR      r0,[sp,#0x18]
;;;2927     SDDMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;
00003c  0080              LSLS     r0,r0,#2
00003e  9007              STR      r0,[sp,#0x1c]
;;;2928     SDDMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;
000040  0080              LSLS     r0,r0,#2
000042  9008              STR      r0,[sp,#0x20]
;;;2929     SDDMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
000044  2000              MOVS     r0,#0
000046  9009              STR      r0,[sp,#0x24]
;;;2930     SDDMA_InitStructure.DMA_Priority = DMA_Priority_VeryHigh;
000048  f44f3040          MOV      r0,#0x30000
00004c  900a              STR      r0,[sp,#0x28]
;;;2931     SDDMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Enable;
00004e  2004              MOVS     r0,#4
000050  900b              STR      r0,[sp,#0x2c]
;;;2932     SDDMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_Full;
000052  2003              MOVS     r0,#3
000054  900c              STR      r0,[sp,#0x30]
;;;2933     SDDMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_INC4;
000056  f44f0000          MOV      r0,#0x800000
00005a  900d              STR      r0,[sp,#0x34]
;;;2934     SDDMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_INC4;
00005c  1080              ASRS     r0,r0,#2
00005e  900e              STR      r0,[sp,#0x38]
;;;2935     DMA_Init(SD_SDIO_DMA_STREAM, &SDDMA_InitStructure);
000060  4669              MOV      r1,sp
000062  4809              LDR      r0,|L23.136|
000064  f7fffffe          BL       DMA_Init
;;;2936     DMA_ITConfig(SD_SDIO_DMA_STREAM, DMA_IT_TC, ENABLE);
000068  2201              MOVS     r2,#1
00006a  2110              MOVS     r1,#0x10
00006c  4806              LDR      r0,|L23.136|
00006e  f7fffffe          BL       DMA_ITConfig
;;;2937     DMA_FlowControllerConfig(SD_SDIO_DMA_STREAM, DMA_FlowCtrl_Peripheral);
000072  2120              MOVS     r1,#0x20
000074  4804              LDR      r0,|L23.136|
000076  f7fffffe          BL       DMA_FlowControllerConfig
;;;2938   
;;;2939     /* DMA2 Stream3  or Stream6 enable */
;;;2940     DMA_Cmd(SD_SDIO_DMA_STREAM, ENABLE);
00007a  2101              MOVS     r1,#1
00007c  4802              LDR      r0,|L23.136|
00007e  f7fffffe          BL       DMA_Cmd
;;;2941   
;;;2942   }
000082  b00f              ADD      sp,sp,#0x3c
000084  bd30              POP      {r4,r5,pc}
;;;2943   
                          ENDP

000086  0000              DCW      0x0000
                  |L23.136|
                          DCD      0x40026458
                  |L23.140|
                          DCD      0x40012c80

                          AREA ||i.SD_LowLevel_DeInit||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DeInit PROC
;;;2813     */
;;;2814   void SD_LowLevel_DeInit(void)
000000  b51c              PUSH     {r2-r4,lr}
;;;2815   {
;;;2816     GPIO_InitTypeDef  GPIO_InitStructure;
;;;2817   
;;;2818     /*!< Disable SDIO Clock */
;;;2819     SDIO_ClockCmd(DISABLE);
000002  2000              MOVS     r0,#0
000004  f7fffffe          BL       SDIO_ClockCmd
;;;2820   
;;;2821     /*!< Set Power State to OFF */
;;;2822     SDIO_SetPowerState(SDIO_PowerState_OFF);
000008  2000              MOVS     r0,#0
00000a  f7fffffe          BL       SDIO_SetPowerState
;;;2823   
;;;2824     /*!< DeInitializes the SDIO peripheral */
;;;2825     SDIO_DeInit();
00000e  f7fffffe          BL       SDIO_DeInit
;;;2826   
;;;2827     /* Disable the SDIO APB2 Clock */
;;;2828     RCC_APB2PeriphClockCmd(RCC_APB2Periph_SDIO, DISABLE);
000012  2100              MOVS     r1,#0
000014  f44f6000          MOV      r0,#0x800
000018  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;2829   
;;;2830     GPIO_PinAFConfig(GPIOC, GPIO_PinSource8, GPIO_AF_MCO);
00001c  2200              MOVS     r2,#0
00001e  2108              MOVS     r1,#8
000020  481a              LDR      r0,|L24.140|
000022  f7fffffe          BL       GPIO_PinAFConfig
;;;2831     GPIO_PinAFConfig(GPIOC, GPIO_PinSource9, GPIO_AF_MCO);
000026  2200              MOVS     r2,#0
000028  2109              MOVS     r1,#9
00002a  4818              LDR      r0,|L24.140|
00002c  f7fffffe          BL       GPIO_PinAFConfig
;;;2832     GPIO_PinAFConfig(GPIOC, GPIO_PinSource10, GPIO_AF_MCO);
000030  2200              MOVS     r2,#0
000032  210a              MOVS     r1,#0xa
000034  4815              LDR      r0,|L24.140|
000036  f7fffffe          BL       GPIO_PinAFConfig
;;;2833     GPIO_PinAFConfig(GPIOC, GPIO_PinSource11, GPIO_AF_MCO);
00003a  2200              MOVS     r2,#0
00003c  210b              MOVS     r1,#0xb
00003e  4813              LDR      r0,|L24.140|
000040  f7fffffe          BL       GPIO_PinAFConfig
;;;2834     GPIO_PinAFConfig(GPIOC, GPIO_PinSource12, GPIO_AF_MCO);
000044  2200              MOVS     r2,#0
000046  210c              MOVS     r1,#0xc
000048  4810              LDR      r0,|L24.140|
00004a  f7fffffe          BL       GPIO_PinAFConfig
;;;2835     GPIO_PinAFConfig(GPIOD, GPIO_PinSource2, GPIO_AF_MCO);
00004e  2200              MOVS     r2,#0
000050  2102              MOVS     r1,#2
000052  480f              LDR      r0,|L24.144|
000054  f7fffffe          BL       GPIO_PinAFConfig
;;;2836   
;;;2837     /* Configure PC.08, PC.09, PC.10, PC.11 pins: D0, D1, D2, D3 pins */
;;;2838     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11;
000058  f44f6070          MOV      r0,#0xf00
00005c  9000              STR      r0,[sp,#0]
;;;2839     GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;
00005e  2000              MOVS     r0,#0
000060  f88d0004          STRB     r0,[sp,#4]
;;;2840     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
000064  f88d0007          STRB     r0,[sp,#7]
;;;2841     GPIO_Init(GPIOC, &GPIO_InitStructure);
000068  4669              MOV      r1,sp
00006a  4808              LDR      r0,|L24.140|
00006c  f7fffffe          BL       GPIO_Init
;;;2842   
;;;2843     /* Configure PD.02 CMD line */
;;;2844     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
000070  2004              MOVS     r0,#4
000072  9000              STR      r0,[sp,#0]
;;;2845     GPIO_Init(GPIOD, &GPIO_InitStructure);
000074  4669              MOV      r1,sp
000076  4806              LDR      r0,|L24.144|
000078  f7fffffe          BL       GPIO_Init
;;;2846   
;;;2847     /* Configure PC.12 pin: CLK pin */
;;;2848     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12;
00007c  f44f5080          MOV      r0,#0x1000
000080  9000              STR      r0,[sp,#0]
;;;2849     GPIO_Init(GPIOC, &GPIO_InitStructure);
000082  4669              MOV      r1,sp
000084  4801              LDR      r0,|L24.140|
000086  f7fffffe          BL       GPIO_Init
;;;2850   }
00008a  bd1c              POP      {r2-r4,pc}
;;;2851   
                          ENDP

                  |L24.140|
                          DCD      0x40020800
                  |L24.144|
                          DCD      0x40020c00

                          AREA ||i.SD_LowLevel_Init||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_Init PROC
;;;2857     */
;;;2858   void SD_LowLevel_Init(void)
000000  b51c              PUSH     {r2-r4,lr}
;;;2859   {
;;;2860     GPIO_InitTypeDef  GPIO_InitStructure;
;;;2861   
;;;2862     /* GPIOC and GPIOD Periph clock enable */
;;;2863     RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOC | RCC_AHB1Periph_GPIOD | SD_DETECT_GPIO_CLK, ENABLE);
000002  2101              MOVS     r1,#1
000004  208c              MOVS     r0,#0x8c
000006  f7fffffe          BL       RCC_AHB1PeriphClockCmd
;;;2864   
;;;2865     GPIO_PinAFConfig(GPIOC, GPIO_PinSource8, GPIO_AF_SDIO);
00000a  220c              MOVS     r2,#0xc
00000c  2108              MOVS     r1,#8
00000e  482a              LDR      r0,|L25.184|
000010  f7fffffe          BL       GPIO_PinAFConfig
;;;2866     GPIO_PinAFConfig(GPIOC, GPIO_PinSource9, GPIO_AF_SDIO);
000014  220c              MOVS     r2,#0xc
000016  2109              MOVS     r1,#9
000018  4827              LDR      r0,|L25.184|
00001a  f7fffffe          BL       GPIO_PinAFConfig
;;;2867     GPIO_PinAFConfig(GPIOC, GPIO_PinSource10, GPIO_AF_SDIO);
00001e  220c              MOVS     r2,#0xc
000020  210a              MOVS     r1,#0xa
000022  4825              LDR      r0,|L25.184|
000024  f7fffffe          BL       GPIO_PinAFConfig
;;;2868     GPIO_PinAFConfig(GPIOC, GPIO_PinSource11, GPIO_AF_SDIO);
000028  220c              MOVS     r2,#0xc
00002a  210b              MOVS     r1,#0xb
00002c  4822              LDR      r0,|L25.184|
00002e  f7fffffe          BL       GPIO_PinAFConfig
;;;2869     GPIO_PinAFConfig(GPIOC, GPIO_PinSource12, GPIO_AF_SDIO);
000032  220c              MOVS     r2,#0xc
000034  4611              MOV      r1,r2
000036  4820              LDR      r0,|L25.184|
000038  f7fffffe          BL       GPIO_PinAFConfig
;;;2870     GPIO_PinAFConfig(GPIOD, GPIO_PinSource2, GPIO_AF_SDIO);
00003c  220c              MOVS     r2,#0xc
00003e  2102              MOVS     r1,#2
000040  481e              LDR      r0,|L25.188|
000042  f7fffffe          BL       GPIO_PinAFConfig
;;;2871   
;;;2872     /* Configure PC.08, PC.09, PC.10, PC.11 pins: D0, D1, D2, D3 pins */
;;;2873     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11;
000046  f44f6070          MOV      r0,#0xf00
00004a  9000              STR      r0,[sp,#0]
;;;2874     GPIO_InitStructure.GPIO_Speed = GPIO_Speed_25MHz;
00004c  2001              MOVS     r0,#1
00004e  f88d0005          STRB     r0,[sp,#5]
;;;2875     GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
000052  2002              MOVS     r0,#2
000054  f88d0004          STRB     r0,[sp,#4]
;;;2876     GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
000058  2000              MOVS     r0,#0
00005a  f88d0006          STRB     r0,[sp,#6]
;;;2877     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
00005e  2001              MOVS     r0,#1
000060  f88d0007          STRB     r0,[sp,#7]
;;;2878     GPIO_Init(GPIOC, &GPIO_InitStructure);
000064  4669              MOV      r1,sp
000066  4814              LDR      r0,|L25.184|
000068  f7fffffe          BL       GPIO_Init
;;;2879   
;;;2880     /* Configure PD.02 CMD line */
;;;2881     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
00006c  2004              MOVS     r0,#4
00006e  9000              STR      r0,[sp,#0]
;;;2882     GPIO_Init(GPIOD, &GPIO_InitStructure);
000070  4669              MOV      r1,sp
000072  4812              LDR      r0,|L25.188|
000074  f7fffffe          BL       GPIO_Init
;;;2883   
;;;2884     /* Configure PC.12 pin: CLK pin */
;;;2885     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12;
000078  f44f5080          MOV      r0,#0x1000
00007c  9000              STR      r0,[sp,#0]
;;;2886     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
00007e  2000              MOVS     r0,#0
000080  f88d0007          STRB     r0,[sp,#7]
;;;2887     GPIO_Init(GPIOC, &GPIO_InitStructure);
000084  4669              MOV      r1,sp
000086  480c              LDR      r0,|L25.184|
000088  f7fffffe          BL       GPIO_Init
;;;2888   
;;;2889     /*!< Configure SD_SPI_DETECT_PIN pin: SD Card detect pin */
;;;2890     GPIO_InitStructure.GPIO_Pin = SD_DETECT_PIN;
00008c  f44f5000          MOV      r0,#0x2000
000090  9000              STR      r0,[sp,#0]
;;;2891     GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;
000092  2000              MOVS     r0,#0
000094  f88d0004          STRB     r0,[sp,#4]
;;;2892     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
000098  2001              MOVS     r0,#1
00009a  f88d0007          STRB     r0,[sp,#7]
;;;2893     GPIO_Init(SD_DETECT_GPIO_PORT, &GPIO_InitStructure);
00009e  4669              MOV      r1,sp
0000a0  4807              LDR      r0,|L25.192|
0000a2  f7fffffe          BL       GPIO_Init
;;;2894   
;;;2895     /* Enable the SDIO APB2 Clock */
;;;2896     RCC_APB2PeriphClockCmd(RCC_APB2Periph_SDIO, ENABLE);
0000a6  2101              MOVS     r1,#1
0000a8  02c8              LSLS     r0,r1,#11
0000aa  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;2897   
;;;2898     /* Enable the DMA2 Clock */
;;;2899     RCC_AHB1PeriphClockCmd(SD_SDIO_DMA_CLK, ENABLE);
0000ae  2101              MOVS     r1,#1
0000b0  0588              LSLS     r0,r1,#22
0000b2  f7fffffe          BL       RCC_AHB1PeriphClockCmd
;;;2900   }
0000b6  bd1c              POP      {r2-r4,pc}
;;;2901   
                          ENDP

                  |L25.184|
                          DCD      0x40020800
                  |L25.188|
                          DCD      0x40020c00
                  |L25.192|
                          DCD      0x40021c00

                          AREA ||i.SD_PowerOFF||, CODE, READONLY, ALIGN=1

                  SD_PowerOFF PROC
;;;681      */
;;;682    SD_Error SD_PowerOFF(void)
000000  b510              PUSH     {r4,lr}
;;;683    {
;;;684      SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;685    
;;;686      /*!< Set Power State to OFF */
;;;687      SDIO_SetPowerState(SDIO_PowerState_OFF);
000004  2000              MOVS     r0,#0
000006  f7fffffe          BL       SDIO_SetPowerState
;;;688    
;;;689      return(errorstatus);
00000a  4620              MOV      r0,r4
;;;690    }
00000c  bd10              POP      {r4,pc}
;;;691    
                          ENDP


                          AREA ||i.SD_PowerON||, CODE, READONLY, ALIGN=2

                  SD_PowerON PROC
;;;537      */
;;;538    SD_Error SD_PowerON(void)
000000  b5f8              PUSH     {r3-r7,lr}
;;;539    {
;;;540      __IO SD_Error errorstatus = SD_OK;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;541      uint32_t response = 0, count = 0, validvoltage = 0;
000006  2500              MOVS     r5,#0
000008  2400              MOVS     r4,#0
00000a  2600              MOVS     r6,#0
;;;542      uint32_t SDType = SD_STD_CAPACITY;
00000c  2700              MOVS     r7,#0
;;;543    
;;;544      /*!< Power ON Sequence -----------------------------------------------------*/
;;;545      /*!< Configure the SDIO peripheral */
;;;546      /*!< SDIO_CK = SDIOCLK / (SDIO_INIT_CLK_DIV + 2) */
;;;547      /*!< on STM32F4xx devices, SDIOCLK is fixed to 48MHz */
;;;548      /*!< SDIO_CK for initialization should not exceed 400 KHz */
;;;549      SDIO_InitStructure.SDIO_ClockDiv = SDIO_INIT_CLK_DIV;
00000e  2076              MOVS     r0,#0x76
000010  495f              LDR      r1,|L27.400|
000012  7508              STRB     r0,[r1,#0x14]
;;;550      SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
000014  2000              MOVS     r0,#0
000016  6008              STR      r0,[r1,#0]  ; SDIO_InitStructure
;;;551      SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
000018  6048              STR      r0,[r1,#4]  ; SDIO_InitStructure
;;;552      SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
00001a  6088              STR      r0,[r1,#8]  ; SDIO_InitStructure
;;;553      SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
00001c  60c8              STR      r0,[r1,#0xc]  ; SDIO_InitStructure
;;;554      SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
00001e  6108              STR      r0,[r1,#0x10]  ; SDIO_InitStructure
;;;555      SDIO_Init(&SDIO_InitStructure);
000020  4608              MOV      r0,r1
000022  f7fffffe          BL       SDIO_Init
;;;556    
;;;557      /*!< Set Power State to ON */
;;;558      SDIO_SetPowerState(SDIO_PowerState_ON);
000026  2003              MOVS     r0,#3
000028  f7fffffe          BL       SDIO_SetPowerState
;;;559    
;;;560      /*!< Enable SDIO Clock */
;;;561      SDIO_ClockCmd(ENABLE);
00002c  2001              MOVS     r0,#1
00002e  f7fffffe          BL       SDIO_ClockCmd
;;;562    
;;;563      /*!< CMD0: GO_IDLE_STATE ---------------------------------------------------*/
;;;564      /*!< No CMD response required */
;;;565      SDIO_CmdInitStructure.SDIO_Argument = 0x0;
000032  2000              MOVS     r0,#0
000034  4957              LDR      r1,|L27.404|
000036  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;566      SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_GO_IDLE_STATE;
000038  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;567      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_No;
00003a  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;568      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00003c  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;569      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00003e  f44f6080          MOV      r0,#0x400
000042  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;570      SDIO_SendCommand(&SDIO_CmdInitStructure);
000044  4608              MOV      r0,r1
000046  f7fffffe          BL       SDIO_SendCommand
;;;571    
;;;572      errorstatus = CmdError();
00004a  f7fffffe          BL       CmdError
00004e  9000              STR      r0,[sp,#0]
;;;573    
;;;574      if (errorstatus != SD_OK)
000050  f89d0000          LDRB     r0,[sp,#0]
000054  b110              CBZ      r0,|L27.92|
;;;575      {
;;;576        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;577        return(errorstatus);
000056  f89d0000          LDRB     r0,[sp,#0]
                  |L27.90|
;;;578      }
;;;579    
;;;580      /*!< CMD8: SEND_IF_COND ----------------------------------------------------*/
;;;581      /*!< Send CMD8 to verify SD card interface operating condition */
;;;582      /*!< Argument: - [31:12]: Reserved (shall be set to '0')
;;;583                   - [11:8]: Supply Voltage (VHS) 0x1 (Range: 2.7-3.6 V)
;;;584                   - [7:0]: Check Pattern (recommended 0xAA) */
;;;585      /*!< CMD Response: R7 */
;;;586      SDIO_CmdInitStructure.SDIO_Argument = SD_CHECK_PATTERN;
;;;587      SDIO_CmdInitStructure.SDIO_CmdIndex = SDIO_SEND_IF_COND;
;;;588      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;589      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;590      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;591      SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;592    
;;;593      errorstatus = CmdResp7Error();
;;;594    
;;;595      if (errorstatus == SD_OK)
;;;596      {
;;;597        CardType = SDIO_STD_CAPACITY_SD_CARD_V2_0; /*!< SD Card 2.0 */
;;;598        SDType = SD_HIGH_CAPACITY;
;;;599      }
;;;600      else
;;;601      {
;;;602        /*!< CMD55 */
;;;603        SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;604        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;605        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;606        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;607        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;608        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;609        errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;610      }
;;;611      /*!< CMD55 */
;;;612      SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;613      SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;614      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;615      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;616      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;617      SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;618      errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;619    
;;;620      /*!< If errorstatus is Command TimeOut, it is a MMC card */
;;;621      /*!< If errorstatus is SD_OK it is a SD card: SD card 2.0 (voltage range mismatch)
;;;622         or SD card 1.x */
;;;623      if (errorstatus == SD_OK)
;;;624      {
;;;625        /*!< SD CARD */
;;;626        /*!< Send ACMD41 SD_APP_OP_COND with Argument 0x80100000 */
;;;627        while ((!validvoltage) && (count < SD_MAX_VOLT_TRIAL))
;;;628        {
;;;629    
;;;630          /*!< SEND CMD55 APP_CMD with RCA as 0 */
;;;631          SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;632          SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;633          SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;634          SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;635          SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;636          SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;637    
;;;638          errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;639    
;;;640          if (errorstatus != SD_OK)
;;;641          {
;;;642            return(errorstatus);
;;;643          }
;;;644          SDIO_CmdInitStructure.SDIO_Argument = SD_VOLTAGE_WINDOW_SD | SDType;
;;;645          SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_OP_COND;
;;;646          SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;647          SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;648          SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;649          SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;650    
;;;651          errorstatus = CmdResp3Error();
;;;652          if (errorstatus != SD_OK)
;;;653          {
;;;654            return(errorstatus);
;;;655          }
;;;656    
;;;657          response = SDIO_GetResponse(SDIO_RESP1);
;;;658          validvoltage = (((response >> 31) == 1) ? 1 : 0);
;;;659          count++;
;;;660        }
;;;661        if (count >= SD_MAX_VOLT_TRIAL)
;;;662        {
;;;663          errorstatus = SD_INVALID_VOLTRANGE;
;;;664          return(errorstatus);
;;;665        }
;;;666    
;;;667        if (response &= SD_HIGH_CAPACITY)
;;;668        {
;;;669          CardType = SDIO_HIGH_CAPACITY_SD_CARD;
;;;670        }
;;;671    
;;;672      }/*!< else MMC Card */
;;;673    
;;;674      return(errorstatus);
;;;675    }
00005a  bdf8              POP      {r3-r7,pc}
                  |L27.92|
00005c  f44f70d5          MOV      r0,#0x1aa             ;586
000060  494c              LDR      r1,|L27.404|
000062  6008              STR      r0,[r1,#0]            ;586  ; SDIO_CmdInitStructure
000064  2008              MOVS     r0,#8                 ;587
000066  6048              STR      r0,[r1,#4]            ;587  ; SDIO_CmdInitStructure
000068  2040              MOVS     r0,#0x40              ;588
00006a  6088              STR      r0,[r1,#8]            ;588  ; SDIO_CmdInitStructure
00006c  2000              MOVS     r0,#0                 ;589
00006e  60c8              STR      r0,[r1,#0xc]          ;589  ; SDIO_CmdInitStructure
000070  f44f6080          MOV      r0,#0x400             ;590
000074  6108              STR      r0,[r1,#0x10]         ;590  ; SDIO_CmdInitStructure
000076  4608              MOV      r0,r1                 ;591
000078  f7fffffe          BL       SDIO_SendCommand
00007c  f7fffffe          BL       CmdResp7Error
000080  9000              STR      r0,[sp,#0]            ;593
000082  f89d0000          LDRB     r0,[sp,#0]            ;595
000086  b920              CBNZ     r0,|L27.146|
000088  2001              MOVS     r0,#1                 ;597
00008a  4943              LDR      r1,|L27.408|
00008c  6008              STR      r0,[r1,#0]            ;597  ; CardType
00008e  0787              LSLS     r7,r0,#30             ;598
000090  e012              B        |L27.184|
                  |L27.146|
000092  2000              MOVS     r0,#0                 ;603
000094  493f              LDR      r1,|L27.404|
000096  6008              STR      r0,[r1,#0]            ;603  ; SDIO_CmdInitStructure
000098  2037              MOVS     r0,#0x37              ;604
00009a  6048              STR      r0,[r1,#4]            ;604  ; SDIO_CmdInitStructure
00009c  2040              MOVS     r0,#0x40              ;605
00009e  6088              STR      r0,[r1,#8]            ;605  ; SDIO_CmdInitStructure
0000a0  2000              MOVS     r0,#0                 ;606
0000a2  60c8              STR      r0,[r1,#0xc]          ;606  ; SDIO_CmdInitStructure
0000a4  f44f6080          MOV      r0,#0x400             ;607
0000a8  6108              STR      r0,[r1,#0x10]         ;607  ; SDIO_CmdInitStructure
0000aa  4608              MOV      r0,r1                 ;608
0000ac  f7fffffe          BL       SDIO_SendCommand
0000b0  2037              MOVS     r0,#0x37              ;609
0000b2  f7fffffe          BL       CmdResp1Error
0000b6  9000              STR      r0,[sp,#0]            ;609
                  |L27.184|
0000b8  2000              MOVS     r0,#0                 ;612
0000ba  4936              LDR      r1,|L27.404|
0000bc  6008              STR      r0,[r1,#0]            ;612  ; SDIO_CmdInitStructure
0000be  2037              MOVS     r0,#0x37              ;613
0000c0  6048              STR      r0,[r1,#4]            ;613  ; SDIO_CmdInitStructure
0000c2  2040              MOVS     r0,#0x40              ;614
0000c4  6088              STR      r0,[r1,#8]            ;614  ; SDIO_CmdInitStructure
0000c6  2000              MOVS     r0,#0                 ;615
0000c8  60c8              STR      r0,[r1,#0xc]          ;615  ; SDIO_CmdInitStructure
0000ca  f44f6080          MOV      r0,#0x400             ;616
0000ce  6108              STR      r0,[r1,#0x10]         ;616  ; SDIO_CmdInitStructure
0000d0  4608              MOV      r0,r1                 ;617
0000d2  f7fffffe          BL       SDIO_SendCommand
0000d6  2037              MOVS     r0,#0x37              ;618
0000d8  f7fffffe          BL       CmdResp1Error
0000dc  9000              STR      r0,[sp,#0]            ;618
0000de  f89d0000          LDRB     r0,[sp,#0]            ;623
0000e2  2800              CMP      r0,#0                 ;623
0000e4  d151              BNE      |L27.394|
0000e6  e03b              B        |L27.352|
                  |L27.232|
0000e8  2000              MOVS     r0,#0                 ;631
0000ea  492a              LDR      r1,|L27.404|
0000ec  6008              STR      r0,[r1,#0]            ;631  ; SDIO_CmdInitStructure
0000ee  2037              MOVS     r0,#0x37              ;632
0000f0  6048              STR      r0,[r1,#4]            ;632  ; SDIO_CmdInitStructure
0000f2  2040              MOVS     r0,#0x40              ;633
0000f4  6088              STR      r0,[r1,#8]            ;633  ; SDIO_CmdInitStructure
0000f6  2000              MOVS     r0,#0                 ;634
0000f8  60c8              STR      r0,[r1,#0xc]          ;634  ; SDIO_CmdInitStructure
0000fa  f44f6080          MOV      r0,#0x400             ;635
0000fe  6108              STR      r0,[r1,#0x10]         ;635  ; SDIO_CmdInitStructure
000100  4608              MOV      r0,r1                 ;636
000102  f7fffffe          BL       SDIO_SendCommand
000106  2037              MOVS     r0,#0x37              ;638
000108  f7fffffe          BL       CmdResp1Error
00010c  9000              STR      r0,[sp,#0]            ;638
00010e  f89d0000          LDRB     r0,[sp,#0]            ;640
000112  b110              CBZ      r0,|L27.282|
000114  f89d0000          LDRB     r0,[sp,#0]            ;642
000118  e79f              B        |L27.90|
                  |L27.282|
00011a  4820              LDR      r0,|L27.412|
00011c  4338              ORRS     r0,r0,r7              ;644
00011e  491d              LDR      r1,|L27.404|
000120  6008              STR      r0,[r1,#0]            ;644  ; SDIO_CmdInitStructure
000122  2029              MOVS     r0,#0x29              ;645
000124  6048              STR      r0,[r1,#4]            ;645  ; SDIO_CmdInitStructure
000126  2040              MOVS     r0,#0x40              ;646
000128  6088              STR      r0,[r1,#8]            ;646  ; SDIO_CmdInitStructure
00012a  2000              MOVS     r0,#0                 ;647
00012c  60c8              STR      r0,[r1,#0xc]          ;647  ; SDIO_CmdInitStructure
00012e  f44f6080          MOV      r0,#0x400             ;648
000132  6108              STR      r0,[r1,#0x10]         ;648  ; SDIO_CmdInitStructure
000134  4608              MOV      r0,r1                 ;649
000136  f7fffffe          BL       SDIO_SendCommand
00013a  f7fffffe          BL       CmdResp3Error
00013e  9000              STR      r0,[sp,#0]            ;651
000140  f89d0000          LDRB     r0,[sp,#0]            ;652
000144  b110              CBZ      r0,|L27.332|
000146  f89d0000          LDRB     r0,[sp,#0]            ;654
00014a  e786              B        |L27.90|
                  |L27.332|
00014c  2000              MOVS     r0,#0                 ;657
00014e  f7fffffe          BL       SDIO_GetResponse
000152  4605              MOV      r5,r0                 ;657
000154  2001              MOVS     r0,#1                 ;658
000156  ea8070d5          EOR      r0,r0,r5,LSR #31      ;658
00015a  f0800601          EOR      r6,r0,#1              ;658
00015e  1c64              ADDS     r4,r4,#1              ;659
                  |L27.352|
000160  b91e              CBNZ     r6,|L27.362|
000162  f64f70ff          MOV      r0,#0xffff            ;627
000166  4284              CMP      r4,r0                 ;627
000168  d3be              BCC      |L27.232|
                  |L27.362|
00016a  f64f70ff          MOV      r0,#0xffff            ;661
00016e  4284              CMP      r4,r0                 ;661
000170  d304              BCC      |L27.380|
000172  201b              MOVS     r0,#0x1b              ;663
000174  9000              STR      r0,[sp,#0]            ;663
000176  f89d0000          LDRB     r0,[sp,#0]            ;664
00017a  e76e              B        |L27.90|
                  |L27.380|
00017c  f0054080          AND      r0,r5,#0x40000000     ;667
000180  0005              MOVS     r5,r0                 ;667
000182  d002              BEQ      |L27.394|
000184  2002              MOVS     r0,#2                 ;669
000186  4904              LDR      r1,|L27.408|
000188  6008              STR      r0,[r1,#0]            ;669  ; CardType
                  |L27.394|
00018a  f89d0000          LDRB     r0,[sp,#0]            ;674
00018e  e764              B        |L27.90|
;;;676    
                          ENDP

                  |L27.400|
                          DCD      SDIO_InitStructure
                  |L27.404|
                          DCD      SDIO_CmdInitStructure
                  |L27.408|
                          DCD      CardType
                  |L27.412|
                          DCD      0x80100000

                          AREA ||i.SD_ProcessDMAIRQ||, CODE, READONLY, ALIGN=2

                  SD_ProcessDMAIRQ PROC
;;;2051     */
;;;2052   void SD_ProcessDMAIRQ(void)
000000  b510              PUSH     {r4,lr}
;;;2053   {
;;;2054     if(DMA2->LISR & SD_SDIO_DMA_FLAG_TCIF)
000002  4807              LDR      r0,|L28.32|
000004  6800              LDR      r0,[r0,#0]
000006  f0105fc0          TST      r0,#0x18000000
00000a  d008              BEQ      |L28.30|
;;;2055     {
;;;2056       DMAEndOfTransfer = 0x01;
00000c  2001              MOVS     r0,#1
00000e  4905              LDR      r1,|L28.36|
000010  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;2057       DMA_ClearFlag(SD_SDIO_DMA_STREAM, SD_SDIO_DMA_FLAG_TCIF|SD_SDIO_DMA_FLAG_FEIF);
000012  f04f51c2          MOV      r1,#0x18400000
000016  4802              LDR      r0,|L28.32|
000018  3058              ADDS     r0,r0,#0x58
00001a  f7fffffe          BL       DMA_ClearFlag
                  |L28.30|
;;;2058     }
;;;2059   }
00001e  bd10              POP      {r4,pc}
;;;2060   
                          ENDP

                  |L28.32|
                          DCD      0x40026400
                  |L28.36|
                          DCD      DMAEndOfTransfer

                          AREA ||i.SD_ProcessIRQSrc||, CODE, READONLY, ALIGN=2

                  SD_ProcessIRQSrc PROC
;;;2006     */
;;;2007   SD_Error SD_ProcessIRQSrc(void)
000000  b510              PUSH     {r4,lr}
;;;2008   {
;;;2009     if (SDIO_GetITStatus(SDIO_IT_DATAEND) != RESET)
000002  f44f7080          MOV      r0,#0x100
000006  f7fffffe          BL       SDIO_GetITStatus
00000a  b150              CBZ      r0,|L29.34|
;;;2010     {
;;;2011       TransferError = SD_OK;
00000c  2000              MOVS     r0,#0
00000e  4925              LDR      r1,|L29.164|
000010  7008              STRB     r0,[r1,#0]
;;;2012       SDIO_ClearITPendingBit(SDIO_IT_DATAEND);
000012  f44f7080          MOV      r0,#0x100
000016  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2013       TransferEnd = 1;
00001a  2001              MOVS     r0,#1
00001c  4922              LDR      r1,|L29.168|
00001e  6008              STR      r0,[r1,#0]  ; TransferEnd
000020  e037              B        |L29.146|
                  |L29.34|
;;;2014     }
;;;2015     else if (SDIO_GetITStatus(SDIO_IT_DCRCFAIL) != RESET)
000022  2002              MOVS     r0,#2
000024  f7fffffe          BL       SDIO_GetITStatus
000028  b130              CBZ      r0,|L29.56|
;;;2016     {
;;;2017       SDIO_ClearITPendingBit(SDIO_IT_DCRCFAIL);
00002a  2002              MOVS     r0,#2
00002c  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2018       TransferError = SD_DATA_CRC_FAIL;
000030  2002              MOVS     r0,#2
000032  491c              LDR      r1,|L29.164|
000034  7008              STRB     r0,[r1,#0]
000036  e02c              B        |L29.146|
                  |L29.56|
;;;2019     }
;;;2020     else if (SDIO_GetITStatus(SDIO_IT_DTIMEOUT) != RESET)
000038  2008              MOVS     r0,#8
00003a  f7fffffe          BL       SDIO_GetITStatus
00003e  b130              CBZ      r0,|L29.78|
;;;2021     {
;;;2022       SDIO_ClearITPendingBit(SDIO_IT_DTIMEOUT);
000040  2008              MOVS     r0,#8
000042  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2023       TransferError = SD_DATA_TIMEOUT;
000046  2004              MOVS     r0,#4
000048  4916              LDR      r1,|L29.164|
00004a  7008              STRB     r0,[r1,#0]
00004c  e021              B        |L29.146|
                  |L29.78|
;;;2024     }
;;;2025     else if (SDIO_GetITStatus(SDIO_IT_RXOVERR) != RESET)
00004e  2020              MOVS     r0,#0x20
000050  f7fffffe          BL       SDIO_GetITStatus
000054  b130              CBZ      r0,|L29.100|
;;;2026     {
;;;2027       SDIO_ClearITPendingBit(SDIO_IT_RXOVERR);
000056  2020              MOVS     r0,#0x20
000058  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2028       TransferError = SD_RX_OVERRUN;
00005c  2006              MOVS     r0,#6
00005e  4911              LDR      r1,|L29.164|
000060  7008              STRB     r0,[r1,#0]
000062  e016              B        |L29.146|
                  |L29.100|
;;;2029     }
;;;2030     else if (SDIO_GetITStatus(SDIO_IT_TXUNDERR) != RESET)
000064  2010              MOVS     r0,#0x10
000066  f7fffffe          BL       SDIO_GetITStatus
00006a  b130              CBZ      r0,|L29.122|
;;;2031     {
;;;2032       SDIO_ClearITPendingBit(SDIO_IT_TXUNDERR);
00006c  2010              MOVS     r0,#0x10
00006e  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2033       TransferError = SD_TX_UNDERRUN;
000072  2005              MOVS     r0,#5
000074  490b              LDR      r1,|L29.164|
000076  7008              STRB     r0,[r1,#0]
000078  e00b              B        |L29.146|
                  |L29.122|
;;;2034     }
;;;2035     else if (SDIO_GetITStatus(SDIO_IT_STBITERR) != RESET)
00007a  f44f7000          MOV      r0,#0x200
00007e  f7fffffe          BL       SDIO_GetITStatus
000082  b130              CBZ      r0,|L29.146|
;;;2036     {
;;;2037       SDIO_ClearITPendingBit(SDIO_IT_STBITERR);
000084  f44f7000          MOV      r0,#0x200
000088  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2038       TransferError = SD_START_BIT_ERR;
00008c  2007              MOVS     r0,#7
00008e  4905              LDR      r1,|L29.164|
000090  7008              STRB     r0,[r1,#0]
                  |L29.146|
;;;2039     }
;;;2040   
;;;2041     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND |
000092  2100              MOVS     r1,#0
000094  f24c303a          MOV      r0,#0xc33a
000098  f7fffffe          BL       SDIO_ITConfig
;;;2042                   SDIO_IT_TXFIFOHE | SDIO_IT_RXFIFOHF | SDIO_IT_TXUNDERR |
;;;2043                   SDIO_IT_RXOVERR | SDIO_IT_STBITERR, DISABLE);
;;;2044     return(TransferError);
00009c  4801              LDR      r0,|L29.164|
00009e  7800              LDRB     r0,[r0,#0]  ; TransferError
;;;2045   }
0000a0  bd10              POP      {r4,pc}
;;;2046   
                          ENDP

0000a2  0000              DCW      0x0000
                  |L29.164|
                          DCD      TransferError
                  |L29.168|
                          DCD      TransferEnd

                          AREA ||i.SD_ReadBlock||, CODE, READONLY, ALIGN=2

                  SD_ReadBlock PROC
;;;1173     */
;;;1174   SD_Error SD_ReadBlock(uint8_t *readbuff, uint32_t ReadAddr, uint16_t BlockSize)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1175   {
000004  4607              MOV      r7,r0
000006  460d              MOV      r5,r1
000008  4614              MOV      r4,r2
;;;1176     SD_Error errorstatus = SD_OK;
00000a  2600              MOVS     r6,#0
;;;1177   #if defined (SD_POLLING_MODE)
;;;1178     uint32_t count = 0, *tempbuff = (uint32_t *)readbuff;
;;;1179   #endif
;;;1180   
;;;1181     TransferError = SD_OK;
00000c  2000              MOVS     r0,#0
00000e  492d              LDR      r1,|L30.196|
000010  7008              STRB     r0,[r1,#0]
;;;1182     TransferEnd = 0;
000012  492d              LDR      r1,|L30.200|
000014  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1183     StopCondition = 0;
000016  492d              LDR      r1,|L30.204|
000018  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1184   
;;;1185     SDIO->DCTRL = 0x0;
00001a  492d              LDR      r1,|L30.208|
00001c  6008              STR      r0,[r1,#0]
;;;1186   
;;;1187   
;;;1188     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
00001e  482d              LDR      r0,|L30.212|
000020  6800              LDR      r0,[r0,#0]  ; CardType
000022  2802              CMP      r0,#2
000024  d101              BNE      |L30.42|
;;;1189     {
;;;1190       BlockSize = 512;
000026  0204              LSLS     r4,r0,#8
;;;1191       ReadAddr /= 512;
000028  0a6d              LSRS     r5,r5,#9
                  |L30.42|
;;;1192     }
;;;1193   
;;;1194     /* Set Block Size for Card */
;;;1195     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
00002a  482b              LDR      r0,|L30.216|
00002c  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1196     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
00002e  2010              MOVS     r0,#0x10
000030  4929              LDR      r1,|L30.216|
000032  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1197     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000034  2040              MOVS     r0,#0x40
000036  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1198     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000038  2000              MOVS     r0,#0
00003a  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1199     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00003c  f44f6080          MOV      r0,#0x400
000040  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1200     SDIO_SendCommand(&SDIO_CmdInitStructure);
000042  4608              MOV      r0,r1
000044  f7fffffe          BL       SDIO_SendCommand
;;;1201   
;;;1202     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000048  2010              MOVS     r0,#0x10
00004a  f7fffffe          BL       CmdResp1Error
00004e  4606              MOV      r6,r0
;;;1203   
;;;1204     if (SD_OK != errorstatus)
000050  b116              CBZ      r6,|L30.88|
;;;1205     {
;;;1206       return(errorstatus);
000052  4630              MOV      r0,r6
                  |L30.84|
;;;1207     }
;;;1208   
;;;1209     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1210     SDIO_DataInitStructure.SDIO_DataLength = BlockSize;
;;;1211     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1212     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1213     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1214     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1215     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1216   
;;;1217     /*!< Send CMD17 READ_SINGLE_BLOCK */
;;;1218     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)ReadAddr;
;;;1219     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_READ_SINGLE_BLOCK;
;;;1220     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1221     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1222     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1223     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1224   
;;;1225     errorstatus = CmdResp1Error(SD_CMD_READ_SINGLE_BLOCK);
;;;1226   
;;;1227     if (errorstatus != SD_OK)
;;;1228     {
;;;1229       return(errorstatus);
;;;1230     }
;;;1231   
;;;1232   #if defined (SD_POLLING_MODE)
;;;1233     /*!< In case of single block transfer, no need of stop transfer at all.*/
;;;1234     /*!< Polling mode */
;;;1235     while (!(SDIO->STA &(SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;1236     {
;;;1237       if (SDIO_GetFlagStatus(SDIO_FLAG_RXFIFOHF) != RESET)
;;;1238       {
;;;1239         for (count = 0; count < 8; count++)
;;;1240         {
;;;1241           *(tempbuff + count) = SDIO_ReadData();
;;;1242         }
;;;1243         tempbuff += 8;
;;;1244       }
;;;1245     }
;;;1246   
;;;1247     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1248     {
;;;1249       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1250       errorstatus = SD_DATA_TIMEOUT;
;;;1251       return(errorstatus);
;;;1252     }
;;;1253     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1254     {
;;;1255       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1256       errorstatus = SD_DATA_CRC_FAIL;
;;;1257       return(errorstatus);
;;;1258     }
;;;1259     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;1260     {
;;;1261       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;1262       errorstatus = SD_RX_OVERRUN;
;;;1263       return(errorstatus);
;;;1264     }
;;;1265     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1266     {
;;;1267       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1268       errorstatus = SD_START_BIT_ERR;
;;;1269       return(errorstatus);
;;;1270     }
;;;1271     count = SD_DATATIMEOUT;
;;;1272     while ((SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET) && (count > 0))
;;;1273     {
;;;1274       *tempbuff = SDIO_ReadData();
;;;1275       tempbuff++;
;;;1276       count--;
;;;1277     }
;;;1278   
;;;1279     /*!< Clear all the static flags */
;;;1280     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;1281   
;;;1282   #elif defined (SD_DMA_MODE)
;;;1283       SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1284       SDIO_DMACmd(ENABLE);
;;;1285       SD_LowLevel_DMA_RxConfig((uint32_t *)readbuff, BlockSize);
;;;1286   #endif
;;;1287   
;;;1288     return(errorstatus);
;;;1289   }
000054  e8bd81f0          POP      {r4-r8,pc}
                  |L30.88|
000058  f04f30ff          MOV      r0,#0xffffffff        ;1209
00005c  491f              LDR      r1,|L30.220|
00005e  6008              STR      r0,[r1,#0]            ;1209  ; SDIO_DataInitStructure
000060  4608              MOV      r0,r1                 ;1210
000062  6044              STR      r4,[r0,#4]            ;1210  ; SDIO_DataInitStructure
000064  2090              MOVS     r0,#0x90              ;1211
000066  6088              STR      r0,[r1,#8]            ;1211  ; SDIO_DataInitStructure
000068  2002              MOVS     r0,#2                 ;1212
00006a  60c8              STR      r0,[r1,#0xc]          ;1212  ; SDIO_DataInitStructure
00006c  2000              MOVS     r0,#0                 ;1213
00006e  6108              STR      r0,[r1,#0x10]         ;1213  ; SDIO_DataInitStructure
000070  2001              MOVS     r0,#1                 ;1214
000072  6148              STR      r0,[r1,#0x14]         ;1214  ; SDIO_DataInitStructure
000074  4608              MOV      r0,r1                 ;1215
000076  f7fffffe          BL       SDIO_DataConfig
00007a  4817              LDR      r0,|L30.216|
00007c  6005              STR      r5,[r0,#0]            ;1218  ; SDIO_CmdInitStructure
00007e  2011              MOVS     r0,#0x11              ;1219
000080  4915              LDR      r1,|L30.216|
000082  6048              STR      r0,[r1,#4]            ;1219  ; SDIO_CmdInitStructure
000084  2040              MOVS     r0,#0x40              ;1220
000086  6088              STR      r0,[r1,#8]            ;1220  ; SDIO_CmdInitStructure
000088  2000              MOVS     r0,#0                 ;1221
00008a  60c8              STR      r0,[r1,#0xc]          ;1221  ; SDIO_CmdInitStructure
00008c  f44f6080          MOV      r0,#0x400             ;1222
000090  6108              STR      r0,[r1,#0x10]         ;1222  ; SDIO_CmdInitStructure
000092  4608              MOV      r0,r1                 ;1223
000094  f7fffffe          BL       SDIO_SendCommand
000098  2011              MOVS     r0,#0x11              ;1225
00009a  f7fffffe          BL       CmdResp1Error
00009e  4606              MOV      r6,r0                 ;1225
0000a0  b10e              CBZ      r6,|L30.166|
0000a2  4630              MOV      r0,r6                 ;1229
0000a4  e7d6              B        |L30.84|
                  |L30.166|
0000a6  2101              MOVS     r1,#1                 ;1283
0000a8  f240302a          MOV      r0,#0x32a             ;1283
0000ac  f7fffffe          BL       SDIO_ITConfig
0000b0  2001              MOVS     r0,#1                 ;1284
0000b2  f7fffffe          BL       SDIO_DMACmd
0000b6  4621              MOV      r1,r4                 ;1285
0000b8  4638              MOV      r0,r7                 ;1285
0000ba  f7fffffe          BL       SD_LowLevel_DMA_RxConfig
0000be  4630              MOV      r0,r6                 ;1288
0000c0  e7c8              B        |L30.84|
;;;1290   
                          ENDP

0000c2  0000              DCW      0x0000
                  |L30.196|
                          DCD      TransferError
                  |L30.200|
                          DCD      TransferEnd
                  |L30.204|
                          DCD      StopCondition
                  |L30.208|
                          DCD      0x40012c2c
                  |L30.212|
                          DCD      CardType
                  |L30.216|
                          DCD      SDIO_CmdInitStructure
                  |L30.220|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_ReadMultiBlocks||, CODE, READONLY, ALIGN=2

                  SD_ReadMultiBlocks PROC
;;;1305     */
;;;1306   SD_Error SD_ReadMultiBlocks(uint8_t *readbuff, uint32_t ReadAddr, uint16_t BlockSize, uint32_t NumberOfBlocks)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1307   {
000004  4680              MOV      r8,r0
000006  460d              MOV      r5,r1
000008  4614              MOV      r4,r2
00000a  461e              MOV      r6,r3
;;;1308     SD_Error errorstatus = SD_OK;
00000c  2700              MOVS     r7,#0
;;;1309     TransferError = SD_OK;
00000e  2000              MOVS     r0,#0
000010  492e              LDR      r1,|L31.204|
000012  7008              STRB     r0,[r1,#0]
;;;1310     TransferEnd = 0;
000014  492e              LDR      r1,|L31.208|
000016  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1311     StopCondition = 1;
000018  2001              MOVS     r0,#1
00001a  492e              LDR      r1,|L31.212|
00001c  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1312   
;;;1313     SDIO->DCTRL = 0x0;
00001e  2000              MOVS     r0,#0
000020  492d              LDR      r1,|L31.216|
000022  6008              STR      r0,[r1,#0]
;;;1314   
;;;1315     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000024  482d              LDR      r0,|L31.220|
000026  6800              LDR      r0,[r0,#0]  ; CardType
000028  2802              CMP      r0,#2
00002a  d101              BNE      |L31.48|
;;;1316     {
;;;1317       BlockSize = 512;
00002c  0204              LSLS     r4,r0,#8
;;;1318       ReadAddr /= 512;
00002e  0a6d              LSRS     r5,r5,#9
                  |L31.48|
;;;1319     }
;;;1320   
;;;1321     /*!< Set Block Size for Card */
;;;1322     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000030  482b              LDR      r0,|L31.224|
000032  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1323     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000034  2010              MOVS     r0,#0x10
000036  492a              LDR      r1,|L31.224|
000038  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1324     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00003a  2040              MOVS     r0,#0x40
00003c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1325     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00003e  2000              MOVS     r0,#0
000040  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1326     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000042  f44f6080          MOV      r0,#0x400
000046  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1327     SDIO_SendCommand(&SDIO_CmdInitStructure);
000048  4608              MOV      r0,r1
00004a  f7fffffe          BL       SDIO_SendCommand
;;;1328   
;;;1329     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
00004e  2010              MOVS     r0,#0x10
000050  f7fffffe          BL       CmdResp1Error
000054  4607              MOV      r7,r0
;;;1330   
;;;1331     if (SD_OK != errorstatus)
000056  b117              CBZ      r7,|L31.94|
;;;1332     {
;;;1333       return(errorstatus);
000058  4638              MOV      r0,r7
                  |L31.90|
;;;1334     }
;;;1335   
;;;1336     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1337     SDIO_DataInitStructure.SDIO_DataLength = NumberOfBlocks * BlockSize;
;;;1338     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1339     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1340     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1341     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1342     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1343   
;;;1344     /*!< Send CMD18 READ_MULT_BLOCK with argument data address */
;;;1345     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)ReadAddr;
;;;1346     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_READ_MULT_BLOCK;
;;;1347     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1348     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1349     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1350     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1351   
;;;1352     errorstatus = CmdResp1Error(SD_CMD_READ_MULT_BLOCK);
;;;1353   
;;;1354     if (errorstatus != SD_OK)
;;;1355     {
;;;1356       return(errorstatus);
;;;1357     }
;;;1358   
;;;1359     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1360     SDIO_DMACmd(ENABLE);
;;;1361     SD_LowLevel_DMA_RxConfig((uint32_t *)readbuff, (NumberOfBlocks * BlockSize));
;;;1362   
;;;1363     return(errorstatus);
;;;1364   }
00005a  e8bd81f0          POP      {r4-r8,pc}
                  |L31.94|
00005e  f04f30ff          MOV      r0,#0xffffffff        ;1336
000062  4920              LDR      r1,|L31.228|
000064  6008              STR      r0,[r1,#0]            ;1336  ; SDIO_DataInitStructure
000066  fb06f004          MUL      r0,r6,r4              ;1337
00006a  6048              STR      r0,[r1,#4]            ;1337  ; SDIO_DataInitStructure
00006c  2090              MOVS     r0,#0x90              ;1338
00006e  6088              STR      r0,[r1,#8]            ;1338  ; SDIO_DataInitStructure
000070  2002              MOVS     r0,#2                 ;1339
000072  60c8              STR      r0,[r1,#0xc]          ;1339  ; SDIO_DataInitStructure
000074  2000              MOVS     r0,#0                 ;1340
000076  6108              STR      r0,[r1,#0x10]         ;1340  ; SDIO_DataInitStructure
000078  2001              MOVS     r0,#1                 ;1341
00007a  6148              STR      r0,[r1,#0x14]         ;1341  ; SDIO_DataInitStructure
00007c  4608              MOV      r0,r1                 ;1342
00007e  f7fffffe          BL       SDIO_DataConfig
000082  4817              LDR      r0,|L31.224|
000084  6005              STR      r5,[r0,#0]            ;1345  ; SDIO_CmdInitStructure
000086  2012              MOVS     r0,#0x12              ;1346
000088  4915              LDR      r1,|L31.224|
00008a  6048              STR      r0,[r1,#4]            ;1346  ; SDIO_CmdInitStructure
00008c  2040              MOVS     r0,#0x40              ;1347
00008e  6088              STR      r0,[r1,#8]            ;1347  ; SDIO_CmdInitStructure
000090  2000              MOVS     r0,#0                 ;1348
000092  60c8              STR      r0,[r1,#0xc]          ;1348  ; SDIO_CmdInitStructure
000094  f44f6080          MOV      r0,#0x400             ;1349
000098  6108              STR      r0,[r1,#0x10]         ;1349  ; SDIO_CmdInitStructure
00009a  4608              MOV      r0,r1                 ;1350
00009c  f7fffffe          BL       SDIO_SendCommand
0000a0  2012              MOVS     r0,#0x12              ;1352
0000a2  f7fffffe          BL       CmdResp1Error
0000a6  4607              MOV      r7,r0                 ;1352
0000a8  b10f              CBZ      r7,|L31.174|
0000aa  4638              MOV      r0,r7                 ;1356
0000ac  e7d5              B        |L31.90|
                  |L31.174|
0000ae  2101              MOVS     r1,#1                 ;1359
0000b0  f240302a          MOV      r0,#0x32a             ;1359
0000b4  f7fffffe          BL       SDIO_ITConfig
0000b8  2001              MOVS     r0,#1                 ;1360
0000ba  f7fffffe          BL       SDIO_DMACmd
0000be  fb06f104          MUL      r1,r6,r4              ;1361
0000c2  4640              MOV      r0,r8                 ;1361
0000c4  f7fffffe          BL       SD_LowLevel_DMA_RxConfig
0000c8  4638              MOV      r0,r7                 ;1363
0000ca  e7c6              B        |L31.90|
;;;1365   
                          ENDP

                  |L31.204|
                          DCD      TransferError
                  |L31.208|
                          DCD      TransferEnd
                  |L31.212|
                          DCD      StopCondition
                  |L31.216|
                          DCD      0x40012c2c
                  |L31.220|
                          DCD      CardType
                  |L31.224|
                          DCD      SDIO_CmdInitStructure
                  |L31.228|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_SelectDeselect||, CODE, READONLY, ALIGN=2

                  SD_SelectDeselect PROC
;;;1142     */
;;;1143   SD_Error SD_SelectDeselect(uint32_t addr)
000000  b570              PUSH     {r4-r6,lr}
;;;1144   {
000002  4604              MOV      r4,r0
;;;1145     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;1146   
;;;1147     /*!< Send CMD7 SDIO_SEL_DESEL_CARD */
;;;1148     SDIO_CmdInitStructure.SDIO_Argument =  addr;
000006  480a              LDR      r0,|L32.48|
000008  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1149     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEL_DESEL_CARD;
00000a  2007              MOVS     r0,#7
00000c  4908              LDR      r1,|L32.48|
00000e  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1150     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000010  2040              MOVS     r0,#0x40
000012  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1151     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000014  2000              MOVS     r0,#0
000016  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1152     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000018  f44f6080          MOV      r0,#0x400
00001c  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1153     SDIO_SendCommand(&SDIO_CmdInitStructure);
00001e  4608              MOV      r0,r1
000020  f7fffffe          BL       SDIO_SendCommand
;;;1154   
;;;1155     errorstatus = CmdResp1Error(SD_CMD_SEL_DESEL_CARD);
000024  2007              MOVS     r0,#7
000026  f7fffffe          BL       CmdResp1Error
00002a  4605              MOV      r5,r0
;;;1156   
;;;1157     return(errorstatus);
00002c  4628              MOV      r0,r5
;;;1158   }
00002e  bd70              POP      {r4-r6,pc}
;;;1159   
                          ENDP

                  |L32.48|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_SendSDStatus||, CODE, READONLY, ALIGN=2

                  SD_SendSDStatus PROC
;;;1889     */
;;;1890   SD_Error SD_SendSDStatus(uint32_t *psdstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1891   {
000002  4604              MOV      r4,r0
;;;1892     SD_Error errorstatus = SD_OK;
000004  2600              MOVS     r6,#0
;;;1893     uint32_t count = 0;
000006  2500              MOVS     r5,#0
;;;1894   
;;;1895     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
000008  2000              MOVS     r0,#0
00000a  f7fffffe          BL       SDIO_GetResponse
00000e  f0107f00          TST      r0,#0x2000000
000012  d002              BEQ      |L33.26|
;;;1896     {
;;;1897       errorstatus = SD_LOCK_UNLOCK_FAILED;
000014  260e              MOVS     r6,#0xe
;;;1898       return(errorstatus);
000016  4630              MOV      r0,r6
                  |L33.24|
;;;1899     }
;;;1900   
;;;1901     /*!< Set block size for card if it is not equal to current block size for card. */
;;;1902     SDIO_CmdInitStructure.SDIO_Argument = 64;
;;;1903     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;1904     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1905     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1906     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1907     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1908   
;;;1909     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
;;;1910   
;;;1911     if (errorstatus != SD_OK)
;;;1912     {
;;;1913       return(errorstatus);
;;;1914     }
;;;1915   
;;;1916     /*!< CMD55 */
;;;1917     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;1918     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;1919     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1920     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1921     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1922     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1923     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;1924   
;;;1925     if (errorstatus != SD_OK)
;;;1926     {
;;;1927       return(errorstatus);
;;;1928     }
;;;1929   
;;;1930     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1931     SDIO_DataInitStructure.SDIO_DataLength = 64;
;;;1932     SDIO_DataInitStructure.SDIO_DataBlockSize = SDIO_DataBlockSize_64b;
;;;1933     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1934     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1935     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1936     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1937   
;;;1938     /*!< Send ACMD13 SD_APP_STAUS  with argument as card's RCA.*/
;;;1939     SDIO_CmdInitStructure.SDIO_Argument = 0;
;;;1940     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_STAUS;
;;;1941     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1942     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1943     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1944     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1945     errorstatus = CmdResp1Error(SD_CMD_SD_APP_STAUS);
;;;1946   
;;;1947     if (errorstatus != SD_OK)
;;;1948     {
;;;1949       return(errorstatus);
;;;1950     }
;;;1951   
;;;1952     while (!(SDIO->STA &(SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;1953     {
;;;1954       if (SDIO_GetFlagStatus(SDIO_FLAG_RXFIFOHF) != RESET)
;;;1955       {
;;;1956         for (count = 0; count < 8; count++)
;;;1957         {
;;;1958           *(psdstatus + count) = SDIO_ReadData();
;;;1959         }
;;;1960         psdstatus += 8;
;;;1961       }
;;;1962     }
;;;1963   
;;;1964     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1965     {
;;;1966       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1967       errorstatus = SD_DATA_TIMEOUT;
;;;1968       return(errorstatus);
;;;1969     }
;;;1970     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1971     {
;;;1972       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1973       errorstatus = SD_DATA_CRC_FAIL;
;;;1974       return(errorstatus);
;;;1975     }
;;;1976     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;1977     {
;;;1978       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;1979       errorstatus = SD_RX_OVERRUN;
;;;1980       return(errorstatus);
;;;1981     }
;;;1982     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1983     {
;;;1984       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1985       errorstatus = SD_START_BIT_ERR;
;;;1986       return(errorstatus);
;;;1987     }
;;;1988   
;;;1989     count = SD_DATATIMEOUT;
;;;1990     while ((SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET) && (count > 0))
;;;1991     {
;;;1992       *psdstatus = SDIO_ReadData();
;;;1993       psdstatus++;
;;;1994       count--;
;;;1995     }
;;;1996     /*!< Clear all the static status flags*/
;;;1997     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;1998   
;;;1999     return(errorstatus);
;;;2000   }
000018  bd70              POP      {r4-r6,pc}
                  |L33.26|
00001a  2040              MOVS     r0,#0x40              ;1902
00001c  4954              LDR      r1,|L33.368|
00001e  6008              STR      r0,[r1,#0]            ;1902  ; SDIO_CmdInitStructure
000020  2010              MOVS     r0,#0x10              ;1903
000022  6048              STR      r0,[r1,#4]            ;1903  ; SDIO_CmdInitStructure
000024  2040              MOVS     r0,#0x40              ;1904
000026  6088              STR      r0,[r1,#8]            ;1904  ; SDIO_CmdInitStructure
000028  2000              MOVS     r0,#0                 ;1905
00002a  60c8              STR      r0,[r1,#0xc]          ;1905  ; SDIO_CmdInitStructure
00002c  f44f6080          MOV      r0,#0x400             ;1906
000030  6108              STR      r0,[r1,#0x10]         ;1906  ; SDIO_CmdInitStructure
000032  4608              MOV      r0,r1                 ;1907
000034  f7fffffe          BL       SDIO_SendCommand
000038  2010              MOVS     r0,#0x10              ;1909
00003a  f7fffffe          BL       CmdResp1Error
00003e  4606              MOV      r6,r0                 ;1909
000040  b10e              CBZ      r6,|L33.70|
000042  4630              MOV      r0,r6                 ;1913
000044  e7e8              B        |L33.24|
                  |L33.70|
000046  484b              LDR      r0,|L33.372|
000048  8800              LDRH     r0,[r0,#0]            ;1917  ; RCA
00004a  0400              LSLS     r0,r0,#16             ;1917
00004c  4948              LDR      r1,|L33.368|
00004e  6008              STR      r0,[r1,#0]            ;1917  ; SDIO_CmdInitStructure
000050  2037              MOVS     r0,#0x37              ;1918
000052  6048              STR      r0,[r1,#4]            ;1918  ; SDIO_CmdInitStructure
000054  2040              MOVS     r0,#0x40              ;1919
000056  6088              STR      r0,[r1,#8]            ;1919  ; SDIO_CmdInitStructure
000058  2000              MOVS     r0,#0                 ;1920
00005a  60c8              STR      r0,[r1,#0xc]          ;1920  ; SDIO_CmdInitStructure
00005c  f44f6080          MOV      r0,#0x400             ;1921
000060  6108              STR      r0,[r1,#0x10]         ;1921  ; SDIO_CmdInitStructure
000062  4608              MOV      r0,r1                 ;1922
000064  f7fffffe          BL       SDIO_SendCommand
000068  2037              MOVS     r0,#0x37              ;1923
00006a  f7fffffe          BL       CmdResp1Error
00006e  4606              MOV      r6,r0                 ;1923
000070  b10e              CBZ      r6,|L33.118|
000072  4630              MOV      r0,r6                 ;1927
000074  e7d0              B        |L33.24|
                  |L33.118|
000076  f04f30ff          MOV      r0,#0xffffffff        ;1930
00007a  493f              LDR      r1,|L33.376|
00007c  6008              STR      r0,[r1,#0]            ;1930  ; SDIO_DataInitStructure
00007e  2040              MOVS     r0,#0x40              ;1931
000080  6048              STR      r0,[r1,#4]            ;1931  ; SDIO_DataInitStructure
000082  2060              MOVS     r0,#0x60              ;1932
000084  6088              STR      r0,[r1,#8]            ;1932  ; SDIO_DataInitStructure
000086  2002              MOVS     r0,#2                 ;1933
000088  60c8              STR      r0,[r1,#0xc]          ;1933  ; SDIO_DataInitStructure
00008a  2000              MOVS     r0,#0                 ;1934
00008c  6108              STR      r0,[r1,#0x10]         ;1934  ; SDIO_DataInitStructure
00008e  2001              MOVS     r0,#1                 ;1935
000090  6148              STR      r0,[r1,#0x14]         ;1935  ; SDIO_DataInitStructure
000092  4608              MOV      r0,r1                 ;1936
000094  f7fffffe          BL       SDIO_DataConfig
000098  2000              MOVS     r0,#0                 ;1939
00009a  4935              LDR      r1,|L33.368|
00009c  6008              STR      r0,[r1,#0]            ;1939  ; SDIO_CmdInitStructure
00009e  200d              MOVS     r0,#0xd               ;1940
0000a0  6048              STR      r0,[r1,#4]            ;1940  ; SDIO_CmdInitStructure
0000a2  2040              MOVS     r0,#0x40              ;1941
0000a4  6088              STR      r0,[r1,#8]            ;1941  ; SDIO_CmdInitStructure
0000a6  2000              MOVS     r0,#0                 ;1942
0000a8  60c8              STR      r0,[r1,#0xc]          ;1942  ; SDIO_CmdInitStructure
0000aa  f44f6080          MOV      r0,#0x400             ;1943
0000ae  6108              STR      r0,[r1,#0x10]         ;1943  ; SDIO_CmdInitStructure
0000b0  4608              MOV      r0,r1                 ;1944
0000b2  f7fffffe          BL       SDIO_SendCommand
0000b6  200d              MOVS     r0,#0xd               ;1945
0000b8  f7fffffe          BL       CmdResp1Error
0000bc  4606              MOV      r6,r0                 ;1945
0000be  b10e              CBZ      r6,|L33.196|
0000c0  4630              MOV      r0,r6                 ;1949
0000c2  e7a9              B        |L33.24|
                  |L33.196|
0000c4  e00e              B        |L33.228|
                  |L33.198|
0000c6  f44f4000          MOV      r0,#0x8000            ;1954
0000ca  f7fffffe          BL       SDIO_GetFlagStatus
0000ce  b148              CBZ      r0,|L33.228|
0000d0  2500              MOVS     r5,#0                 ;1956
0000d2  e004              B        |L33.222|
                  |L33.212|
0000d4  f7fffffe          BL       SDIO_ReadData
0000d8  f8440025          STR      r0,[r4,r5,LSL #2]     ;1958
0000dc  1c6d              ADDS     r5,r5,#1              ;1956
                  |L33.222|
0000de  2d08              CMP      r5,#8                 ;1956
0000e0  d3f8              BCC      |L33.212|
0000e2  3420              ADDS     r4,r4,#0x20           ;1960
                  |L33.228|
0000e4  4825              LDR      r0,|L33.380|
0000e6  6800              LDR      r0,[r0,#0]            ;1952
0000e8  f240612a          MOV      r1,#0x62a             ;1952
0000ec  4208              TST      r0,r1                 ;1952
0000ee  d0ea              BEQ      |L33.198|
0000f0  2008              MOVS     r0,#8                 ;1964
0000f2  f7fffffe          BL       SDIO_GetFlagStatus
0000f6  b128              CBZ      r0,|L33.260|
0000f8  2008              MOVS     r0,#8                 ;1966
0000fa  f7fffffe          BL       SDIO_ClearFlag
0000fe  2604              MOVS     r6,#4                 ;1967
000100  4630              MOV      r0,r6                 ;1968
000102  e789              B        |L33.24|
                  |L33.260|
000104  2002              MOVS     r0,#2                 ;1970
000106  f7fffffe          BL       SDIO_GetFlagStatus
00010a  b128              CBZ      r0,|L33.280|
00010c  2002              MOVS     r0,#2                 ;1972
00010e  f7fffffe          BL       SDIO_ClearFlag
000112  2602              MOVS     r6,#2                 ;1973
000114  4630              MOV      r0,r6                 ;1974
000116  e77f              B        |L33.24|
                  |L33.280|
000118  2020              MOVS     r0,#0x20              ;1976
00011a  f7fffffe          BL       SDIO_GetFlagStatus
00011e  b128              CBZ      r0,|L33.300|
000120  2020              MOVS     r0,#0x20              ;1978
000122  f7fffffe          BL       SDIO_ClearFlag
000126  2606              MOVS     r6,#6                 ;1979
000128  4630              MOV      r0,r6                 ;1980
00012a  e775              B        |L33.24|
                  |L33.300|
00012c  f44f7000          MOV      r0,#0x200             ;1982
000130  f7fffffe          BL       SDIO_GetFlagStatus
000134  b130              CBZ      r0,|L33.324|
000136  f44f7000          MOV      r0,#0x200             ;1984
00013a  f7fffffe          BL       SDIO_ClearFlag
00013e  2607              MOVS     r6,#7                 ;1985
000140  4630              MOV      r0,r6                 ;1986
000142  e769              B        |L33.24|
                  |L33.324|
000144  f04f35ff          MOV      r5,#0xffffffff        ;1989
000148  e004              B        |L33.340|
                  |L33.330|
00014a  f7fffffe          BL       SDIO_ReadData
00014e  6020              STR      r0,[r4,#0]            ;1992
000150  1d24              ADDS     r4,r4,#4              ;1993
000152  1e6d              SUBS     r5,r5,#1              ;1994
                  |L33.340|
000154  f44f1000          MOV      r0,#0x200000          ;1990
000158  f7fffffe          BL       SDIO_GetFlagStatus
00015c  b108              CBZ      r0,|L33.354|
00015e  2d00              CMP      r5,#0                 ;1990
000160  d1f3              BNE      |L33.330|
                  |L33.354|
000162  f24050ff          MOV      r0,#0x5ff             ;1997
000166  f7fffffe          BL       SDIO_ClearFlag
00016a  4630              MOV      r0,r6                 ;1999
00016c  e754              B        |L33.24|
;;;2001   
                          ENDP

00016e  0000              DCW      0x0000
                  |L33.368|
                          DCD      SDIO_CmdInitStructure
                  |L33.372|
                          DCD      ||RCA||
                  |L33.376|
                          DCD      SDIO_DataInitStructure
                  |L33.380|
                          DCD      0x40012c34

                          AREA ||i.SD_SendStatus||, CODE, READONLY, ALIGN=2

                  SD_SendStatus PROC
;;;1854     */
;;;1855   SD_Error SD_SendStatus(uint32_t *pcardstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1856   {
000002  4604              MOV      r4,r0
;;;1857     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;1858   
;;;1859     if (pcardstatus == NULL)
000006  b914              CBNZ     r4,|L34.14|
;;;1860     {
;;;1861       errorstatus = SD_INVALID_PARAMETER;
000008  2526              MOVS     r5,#0x26
;;;1862       return(errorstatus);
00000a  4628              MOV      r0,r5
                  |L34.12|
;;;1863     }
;;;1864   
;;;1865     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;1866     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_STATUS;
;;;1867     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1868     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1869     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1870     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1871   
;;;1872     errorstatus = CmdResp1Error(SD_CMD_SEND_STATUS);
;;;1873   
;;;1874     if (errorstatus != SD_OK)
;;;1875     {
;;;1876       return(errorstatus);
;;;1877     }
;;;1878   
;;;1879     *pcardstatus = SDIO_GetResponse(SDIO_RESP1);
;;;1880   
;;;1881     return(errorstatus);
;;;1882   }
00000c  bd70              POP      {r4-r6,pc}
                  |L34.14|
00000e  480f              LDR      r0,|L34.76|
000010  8800              LDRH     r0,[r0,#0]            ;1865  ; RCA
000012  0400              LSLS     r0,r0,#16             ;1865
000014  490e              LDR      r1,|L34.80|
000016  6008              STR      r0,[r1,#0]            ;1865  ; SDIO_CmdInitStructure
000018  200d              MOVS     r0,#0xd               ;1866
00001a  6048              STR      r0,[r1,#4]            ;1866  ; SDIO_CmdInitStructure
00001c  2040              MOVS     r0,#0x40              ;1867
00001e  6088              STR      r0,[r1,#8]            ;1867  ; SDIO_CmdInitStructure
000020  2000              MOVS     r0,#0                 ;1868
000022  60c8              STR      r0,[r1,#0xc]          ;1868  ; SDIO_CmdInitStructure
000024  f44f6080          MOV      r0,#0x400             ;1869
000028  6108              STR      r0,[r1,#0x10]         ;1869  ; SDIO_CmdInitStructure
00002a  4608              MOV      r0,r1                 ;1870
00002c  f7fffffe          BL       SDIO_SendCommand
000030  200d              MOVS     r0,#0xd               ;1872
000032  f7fffffe          BL       CmdResp1Error
000036  4605              MOV      r5,r0                 ;1872
000038  b10d              CBZ      r5,|L34.62|
00003a  4628              MOV      r0,r5                 ;1876
00003c  e7e6              B        |L34.12|
                  |L34.62|
00003e  2000              MOVS     r0,#0                 ;1879
000040  f7fffffe          BL       SDIO_GetResponse
000044  6020              STR      r0,[r4,#0]            ;1879
000046  4628              MOV      r0,r5                 ;1881
000048  e7e0              B        |L34.12|
;;;1883   
                          ENDP

00004a  0000              DCW      0x0000
                  |L34.76|
                          DCD      ||RCA||
                  |L34.80|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_StopTransfer||, CODE, READONLY, ALIGN=2

                  SD_StopTransfer PROC
;;;1735     */
;;;1736   SD_Error SD_StopTransfer(void)
000000  b510              PUSH     {r4,lr}
;;;1737   {
;;;1738     SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;1739   
;;;1740     /*!< Send CMD12 STOP_TRANSMISSION  */
;;;1741     SDIO_CmdInitStructure.SDIO_Argument = 0x0;
000004  2000              MOVS     r0,#0
000006  490a              LDR      r1,|L35.48|
000008  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;1742     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_STOP_TRANSMISSION;
00000a  200c              MOVS     r0,#0xc
00000c  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1743     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00000e  2040              MOVS     r0,#0x40
000010  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1744     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000012  2000              MOVS     r0,#0
000014  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1745     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000016  f44f6080          MOV      r0,#0x400
00001a  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1746     SDIO_SendCommand(&SDIO_CmdInitStructure);
00001c  4608              MOV      r0,r1
00001e  f7fffffe          BL       SDIO_SendCommand
;;;1747   
;;;1748     errorstatus = CmdResp1Error(SD_CMD_STOP_TRANSMISSION);
000022  200c              MOVS     r0,#0xc
000024  f7fffffe          BL       CmdResp1Error
000028  4604              MOV      r4,r0
;;;1749   
;;;1750     return(errorstatus);
00002a  4620              MOV      r0,r4
;;;1751   }
00002c  bd10              POP      {r4,pc}
;;;1752   
                          ENDP

00002e  0000              DCW      0x0000
                  |L35.48|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_WaitReadOperation||, CODE, READONLY, ALIGN=2

                  SD_WaitReadOperation PROC
;;;1373     */
;;;1374   SD_Error SD_WaitReadOperation(void)
000000  b570              PUSH     {r4-r6,lr}
;;;1375   {
;;;1376     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;1377     uint32_t timeout;
;;;1378   
;;;1379     timeout = SD_DATATIMEOUT;
000004  1e6c              SUBS     r4,r5,#1
;;;1380   
;;;1381     while ((DMAEndOfTransfer == 0x00) && (TransferEnd == 0) && (TransferError == SD_OK) && (timeout > 0))
000006  e000              B        |L36.10|
                  |L36.8|
;;;1382     {
;;;1383       timeout--;
000008  1e64              SUBS     r4,r4,#1
                  |L36.10|
00000a  4818              LDR      r0,|L36.108|
00000c  6800              LDR      r0,[r0,#0]            ;1381  ; DMAEndOfTransfer
00000e  b938              CBNZ     r0,|L36.32|
000010  4817              LDR      r0,|L36.112|
000012  6800              LDR      r0,[r0,#0]            ;1381  ; TransferEnd
000014  b920              CBNZ     r0,|L36.32|
000016  4817              LDR      r0,|L36.116|
000018  7800              LDRB     r0,[r0,#0]            ;1381  ; TransferError
00001a  b908              CBNZ     r0,|L36.32|
00001c  2c00              CMP      r4,#0                 ;1381
00001e  d1f3              BNE      |L36.8|
                  |L36.32|
;;;1384     }
;;;1385   
;;;1386     DMAEndOfTransfer = 0x00;
000020  2000              MOVS     r0,#0
000022  4912              LDR      r1,|L36.108|
000024  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;1387   
;;;1388     timeout = SD_DATATIMEOUT;
000026  1e44              SUBS     r4,r0,#1
;;;1389   
;;;1390     while(((SDIO->STA & SDIO_FLAG_RXACT)) && (timeout > 0))
000028  e000              B        |L36.44|
                  |L36.42|
;;;1391     {
;;;1392       timeout--;
00002a  1e64              SUBS     r4,r4,#1
                  |L36.44|
00002c  4812              LDR      r0,|L36.120|
00002e  6800              LDR      r0,[r0,#0]            ;1390
000030  f4105f00          TST      r0,#0x2000            ;1390
000034  d001              BEQ      |L36.58|
000036  2c00              CMP      r4,#0                 ;1390
000038  d1f7              BNE      |L36.42|
                  |L36.58|
;;;1393     }
;;;1394   
;;;1395     if (StopCondition == 1)
00003a  4810              LDR      r0,|L36.124|
00003c  6800              LDR      r0,[r0,#0]  ; StopCondition
00003e  2801              CMP      r0,#1
000040  d105              BNE      |L36.78|
;;;1396     {
;;;1397       errorstatus = SD_StopTransfer();
000042  f7fffffe          BL       SD_StopTransfer
000046  4605              MOV      r5,r0
;;;1398       StopCondition = 0;
000048  2000              MOVS     r0,#0
00004a  490c              LDR      r1,|L36.124|
00004c  6008              STR      r0,[r1,#0]  ; StopCondition
                  |L36.78|
;;;1399     }
;;;1400   
;;;1401     if ((timeout == 0) && (errorstatus == SD_OK))
00004e  b90c              CBNZ     r4,|L36.84|
000050  b905              CBNZ     r5,|L36.84|
;;;1402     {
;;;1403       errorstatus = SD_DATA_TIMEOUT;
000052  2504              MOVS     r5,#4
                  |L36.84|
;;;1404     }
;;;1405   
;;;1406     /*!< Clear all the static flags */
;;;1407     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000054  f24050ff          MOV      r0,#0x5ff
000058  f7fffffe          BL       SDIO_ClearFlag
;;;1408   
;;;1409     if (TransferError != SD_OK)
00005c  4805              LDR      r0,|L36.116|
00005e  7800              LDRB     r0,[r0,#0]  ; TransferError
000060  b110              CBZ      r0,|L36.104|
;;;1410     {
;;;1411       return(TransferError);
000062  4804              LDR      r0,|L36.116|
000064  7800              LDRB     r0,[r0,#0]  ; TransferError
                  |L36.102|
;;;1412     }
;;;1413     else
;;;1414     {
;;;1415       return(errorstatus);
;;;1416     }
;;;1417   }
000066  bd70              POP      {r4-r6,pc}
                  |L36.104|
000068  4628              MOV      r0,r5                 ;1415
00006a  e7fc              B        |L36.102|
;;;1418   
                          ENDP

                  |L36.108|
                          DCD      DMAEndOfTransfer
                  |L36.112|
                          DCD      TransferEnd
                  |L36.116|
                          DCD      TransferError
                  |L36.120|
                          DCD      0x40012c34
                  |L36.124|
                          DCD      StopCondition

                          AREA ||i.SD_WaitWriteOperation||, CODE, READONLY, ALIGN=2

                  SD_WaitWriteOperation PROC
;;;1665     */
;;;1666   SD_Error SD_WaitWriteOperation(void)
000000  b570              PUSH     {r4-r6,lr}
;;;1667   {
;;;1668     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;1669     uint32_t timeout;
;;;1670   
;;;1671     timeout = SD_DATATIMEOUT;
000004  1e6c              SUBS     r4,r5,#1
;;;1672   
;;;1673     while ((DMAEndOfTransfer == 0x00) && (TransferEnd == 0) && (TransferError == SD_OK) && (timeout > 0))
000006  e000              B        |L37.10|
                  |L37.8|
;;;1674     {
;;;1675       timeout--;
000008  1e64              SUBS     r4,r4,#1
                  |L37.10|
00000a  4818              LDR      r0,|L37.108|
00000c  6800              LDR      r0,[r0,#0]            ;1673  ; DMAEndOfTransfer
00000e  b938              CBNZ     r0,|L37.32|
000010  4817              LDR      r0,|L37.112|
000012  6800              LDR      r0,[r0,#0]            ;1673  ; TransferEnd
000014  b920              CBNZ     r0,|L37.32|
000016  4817              LDR      r0,|L37.116|
000018  7800              LDRB     r0,[r0,#0]            ;1673  ; TransferError
00001a  b908              CBNZ     r0,|L37.32|
00001c  2c00              CMP      r4,#0                 ;1673
00001e  d1f3              BNE      |L37.8|
                  |L37.32|
;;;1676     }
;;;1677   
;;;1678     DMAEndOfTransfer = 0x00;
000020  2000              MOVS     r0,#0
000022  4912              LDR      r1,|L37.108|
000024  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;1679   
;;;1680     timeout = SD_DATATIMEOUT;
000026  1e44              SUBS     r4,r0,#1
;;;1681   
;;;1682     while(((SDIO->STA & SDIO_FLAG_TXACT)) && (timeout > 0))
000028  e000              B        |L37.44|
                  |L37.42|
;;;1683     {
;;;1684       timeout--;
00002a  1e64              SUBS     r4,r4,#1
                  |L37.44|
00002c  4812              LDR      r0,|L37.120|
00002e  6800              LDR      r0,[r0,#0]            ;1682
000030  f4105f80          TST      r0,#0x1000            ;1682
000034  d001              BEQ      |L37.58|
000036  2c00              CMP      r4,#0                 ;1682
000038  d1f7              BNE      |L37.42|
                  |L37.58|
;;;1685     }
;;;1686   
;;;1687     if (StopCondition == 1)
00003a  4810              LDR      r0,|L37.124|
00003c  6800              LDR      r0,[r0,#0]  ; StopCondition
00003e  2801              CMP      r0,#1
000040  d105              BNE      |L37.78|
;;;1688     {
;;;1689       errorstatus = SD_StopTransfer();
000042  f7fffffe          BL       SD_StopTransfer
000046  4605              MOV      r5,r0
;;;1690       StopCondition = 0;
000048  2000              MOVS     r0,#0
00004a  490c              LDR      r1,|L37.124|
00004c  6008              STR      r0,[r1,#0]  ; StopCondition
                  |L37.78|
;;;1691     }
;;;1692   
;;;1693     if ((timeout == 0) && (errorstatus == SD_OK))
00004e  b90c              CBNZ     r4,|L37.84|
000050  b905              CBNZ     r5,|L37.84|
;;;1694     {
;;;1695       errorstatus = SD_DATA_TIMEOUT;
000052  2504              MOVS     r5,#4
                  |L37.84|
;;;1696     }
;;;1697   
;;;1698     /*!< Clear all the static flags */
;;;1699     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000054  f24050ff          MOV      r0,#0x5ff
000058  f7fffffe          BL       SDIO_ClearFlag
;;;1700   
;;;1701     if (TransferError != SD_OK)
00005c  4805              LDR      r0,|L37.116|
00005e  7800              LDRB     r0,[r0,#0]  ; TransferError
000060  b110              CBZ      r0,|L37.104|
;;;1702     {
;;;1703       return(TransferError);
000062  4804              LDR      r0,|L37.116|
000064  7800              LDRB     r0,[r0,#0]  ; TransferError
                  |L37.102|
;;;1704     }
;;;1705     else
;;;1706     {
;;;1707       return(errorstatus);
;;;1708     }
;;;1709   }
000066  bd70              POP      {r4-r6,pc}
                  |L37.104|
000068  4628              MOV      r0,r5                 ;1707
00006a  e7fc              B        |L37.102|
;;;1710   
                          ENDP

                  |L37.108|
                          DCD      DMAEndOfTransfer
                  |L37.112|
                          DCD      TransferEnd
                  |L37.116|
                          DCD      TransferError
                  |L37.120|
                          DCD      0x40012c34
                  |L37.124|
                          DCD      StopCondition

                          AREA ||i.SD_WriteBlock||, CODE, READONLY, ALIGN=2

                  SD_WriteBlock PROC
;;;1432     */
;;;1433   SD_Error SD_WriteBlock(uint8_t *writebuff, uint32_t WriteAddr, uint16_t BlockSize)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1434   {
000004  4607              MOV      r7,r0
000006  460d              MOV      r5,r1
000008  4614              MOV      r4,r2
;;;1435     SD_Error errorstatus = SD_OK;
00000a  2600              MOVS     r6,#0
;;;1436   
;;;1437   #if defined (SD_POLLING_MODE)
;;;1438     uint32_t bytestransferred = 0, count = 0, restwords = 0;
;;;1439     uint32_t *tempbuff = (uint32_t *)writebuff;
;;;1440   #endif
;;;1441   
;;;1442     TransferError = SD_OK;
00000c  2000              MOVS     r0,#0
00000e  492c              LDR      r1,|L38.192|
000010  7008              STRB     r0,[r1,#0]
;;;1443     TransferEnd = 0;
000012  492c              LDR      r1,|L38.196|
000014  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1444     StopCondition = 0;
000016  492c              LDR      r1,|L38.200|
000018  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1445   
;;;1446     SDIO->DCTRL = 0x0;
00001a  492c              LDR      r1,|L38.204|
00001c  6008              STR      r0,[r1,#0]
;;;1447   
;;;1448   
;;;1449     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
00001e  482c              LDR      r0,|L38.208|
000020  6800              LDR      r0,[r0,#0]  ; CardType
000022  2802              CMP      r0,#2
000024  d101              BNE      |L38.42|
;;;1450     {
;;;1451       BlockSize = 512;
000026  0204              LSLS     r4,r0,#8
;;;1452       WriteAddr /= 512;
000028  0a6d              LSRS     r5,r5,#9
                  |L38.42|
;;;1453     }
;;;1454   
;;;1455     /* Set Block Size for Card */
;;;1456     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
00002a  482a              LDR      r0,|L38.212|
00002c  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1457     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
00002e  2010              MOVS     r0,#0x10
000030  4928              LDR      r1,|L38.212|
000032  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1458     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000034  2040              MOVS     r0,#0x40
000036  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1459     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000038  2000              MOVS     r0,#0
00003a  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1460     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00003c  f44f6080          MOV      r0,#0x400
000040  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1461     SDIO_SendCommand(&SDIO_CmdInitStructure);
000042  4608              MOV      r0,r1
000044  f7fffffe          BL       SDIO_SendCommand
;;;1462   
;;;1463     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000048  2010              MOVS     r0,#0x10
00004a  f7fffffe          BL       CmdResp1Error
00004e  4606              MOV      r6,r0
;;;1464   
;;;1465     if (SD_OK != errorstatus)
000050  b116              CBZ      r6,|L38.88|
;;;1466     {
;;;1467       return(errorstatus);
000052  4630              MOV      r0,r6
                  |L38.84|
;;;1468     }
;;;1469   
;;;1470     /*!< Send CMD24 WRITE_SINGLE_BLOCK */
;;;1471     SDIO_CmdInitStructure.SDIO_Argument = WriteAddr;
;;;1472     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_WRITE_SINGLE_BLOCK;
;;;1473     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1474     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1475     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1476     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1477   
;;;1478     errorstatus = CmdResp1Error(SD_CMD_WRITE_SINGLE_BLOCK);
;;;1479   
;;;1480     if (errorstatus != SD_OK)
;;;1481     {
;;;1482       return(errorstatus);
;;;1483     }
;;;1484   
;;;1485     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1486     SDIO_DataInitStructure.SDIO_DataLength = BlockSize;
;;;1487     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1488     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToCard;
;;;1489     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1490     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1491     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1492   
;;;1493     /*!< In case of single data block transfer no need of stop command at all */
;;;1494   #if defined (SD_POLLING_MODE)
;;;1495     while (!(SDIO->STA & (SDIO_FLAG_DBCKEND | SDIO_FLAG_TXUNDERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_STBITERR)))
;;;1496     {
;;;1497       if (SDIO_GetFlagStatus(SDIO_FLAG_TXFIFOHE) != RESET)
;;;1498       {
;;;1499         if ((512 - bytestransferred) < 32)
;;;1500         {
;;;1501           restwords = ((512 - bytestransferred) % 4 == 0) ? ((512 - bytestransferred) / 4) : (( 512 -  bytestransferred) / 4 + 1);
;;;1502           for (count = 0; count < restwords; count++, tempbuff++, bytestransferred += 4)
;;;1503           {
;;;1504             SDIO_WriteData(*tempbuff);
;;;1505           }
;;;1506         }
;;;1507         else
;;;1508         {
;;;1509           for (count = 0; count < 8; count++)
;;;1510           {
;;;1511             SDIO_WriteData(*(tempbuff + count));
;;;1512           }
;;;1513           tempbuff += 8;
;;;1514           bytestransferred += 32;
;;;1515         }
;;;1516       }
;;;1517     }
;;;1518     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1519     {
;;;1520       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1521       errorstatus = SD_DATA_TIMEOUT;
;;;1522       return(errorstatus);
;;;1523     }
;;;1524     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1525     {
;;;1526       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1527       errorstatus = SD_DATA_CRC_FAIL;
;;;1528       return(errorstatus);
;;;1529     }
;;;1530     else if (SDIO_GetFlagStatus(SDIO_FLAG_TXUNDERR) != RESET)
;;;1531     {
;;;1532       SDIO_ClearFlag(SDIO_FLAG_TXUNDERR);
;;;1533       errorstatus = SD_TX_UNDERRUN;
;;;1534       return(errorstatus);
;;;1535     }
;;;1536     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1537     {
;;;1538       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1539       errorstatus = SD_START_BIT_ERR;
;;;1540       return(errorstatus);
;;;1541     }
;;;1542   #elif defined (SD_DMA_MODE)
;;;1543     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1544     SD_LowLevel_DMA_TxConfig((uint32_t *)writebuff, BlockSize);
;;;1545     SDIO_DMACmd(ENABLE);
;;;1546   #endif
;;;1547   
;;;1548     return(errorstatus);
;;;1549   }
000054  e8bd81f0          POP      {r4-r8,pc}
                  |L38.88|
000058  481e              LDR      r0,|L38.212|
00005a  6005              STR      r5,[r0,#0]            ;1471  ; SDIO_CmdInitStructure
00005c  2018              MOVS     r0,#0x18              ;1472
00005e  491d              LDR      r1,|L38.212|
000060  6048              STR      r0,[r1,#4]            ;1472  ; SDIO_CmdInitStructure
000062  2040              MOVS     r0,#0x40              ;1473
000064  6088              STR      r0,[r1,#8]            ;1473  ; SDIO_CmdInitStructure
000066  2000              MOVS     r0,#0                 ;1474
000068  60c8              STR      r0,[r1,#0xc]          ;1474  ; SDIO_CmdInitStructure
00006a  f44f6080          MOV      r0,#0x400             ;1475
00006e  6108              STR      r0,[r1,#0x10]         ;1475  ; SDIO_CmdInitStructure
000070  4608              MOV      r0,r1                 ;1476
000072  f7fffffe          BL       SDIO_SendCommand
000076  2018              MOVS     r0,#0x18              ;1478
000078  f7fffffe          BL       CmdResp1Error
00007c  4606              MOV      r6,r0                 ;1478
00007e  b10e              CBZ      r6,|L38.132|
000080  4630              MOV      r0,r6                 ;1482
000082  e7e7              B        |L38.84|
                  |L38.132|
000084  f04f30ff          MOV      r0,#0xffffffff        ;1485
000088  4913              LDR      r1,|L38.216|
00008a  6008              STR      r0,[r1,#0]            ;1485  ; SDIO_DataInitStructure
00008c  4608              MOV      r0,r1                 ;1486
00008e  6044              STR      r4,[r0,#4]            ;1486  ; SDIO_DataInitStructure
000090  2090              MOVS     r0,#0x90              ;1487
000092  6088              STR      r0,[r1,#8]            ;1487  ; SDIO_DataInitStructure
000094  2000              MOVS     r0,#0                 ;1488
000096  60c8              STR      r0,[r1,#0xc]          ;1488  ; SDIO_DataInitStructure
000098  6108              STR      r0,[r1,#0x10]         ;1489  ; SDIO_DataInitStructure
00009a  2001              MOVS     r0,#1                 ;1490
00009c  6148              STR      r0,[r1,#0x14]         ;1490  ; SDIO_DataInitStructure
00009e  4608              MOV      r0,r1                 ;1491
0000a0  f7fffffe          BL       SDIO_DataConfig
0000a4  2101              MOVS     r1,#1                 ;1543
0000a6  f240302a          MOV      r0,#0x32a             ;1543
0000aa  f7fffffe          BL       SDIO_ITConfig
0000ae  4621              MOV      r1,r4                 ;1544
0000b0  4638              MOV      r0,r7                 ;1544
0000b2  f7fffffe          BL       SD_LowLevel_DMA_TxConfig
0000b6  2001              MOVS     r0,#1                 ;1545
0000b8  f7fffffe          BL       SDIO_DMACmd
0000bc  4630              MOV      r0,r6                 ;1548
0000be  e7c9              B        |L38.84|
;;;1550   
                          ENDP

                  |L38.192|
                          DCD      TransferError
                  |L38.196|
                          DCD      TransferEnd
                  |L38.200|
                          DCD      StopCondition
                  |L38.204|
                          DCD      0x40012c2c
                  |L38.208|
                          DCD      CardType
                  |L38.212|
                          DCD      SDIO_CmdInitStructure
                  |L38.216|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_WriteMultiBlocks||, CODE, READONLY, ALIGN=2

                  SD_WriteMultiBlocks PROC
;;;1565     */
;;;1566   SD_Error SD_WriteMultiBlocks(uint8_t *writebuff, uint32_t WriteAddr, uint16_t BlockSize, uint32_t NumberOfBlocks)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1567   {
000004  4680              MOV      r8,r0
000006  460f              MOV      r7,r1
000008  4615              MOV      r5,r2
00000a  461e              MOV      r6,r3
;;;1568     SD_Error errorstatus = SD_OK;
00000c  2400              MOVS     r4,#0
;;;1569   
;;;1570     TransferError = SD_OK;
00000e  2000              MOVS     r0,#0
000010  4945              LDR      r1,|L39.296|
000012  7008              STRB     r0,[r1,#0]
;;;1571     TransferEnd = 0;
000014  4945              LDR      r1,|L39.300|
000016  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1572     StopCondition = 1;
000018  2001              MOVS     r0,#1
00001a  4945              LDR      r1,|L39.304|
00001c  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1573   
;;;1574     SDIO->DCTRL = 0x0;
00001e  2000              MOVS     r0,#0
000020  4944              LDR      r1,|L39.308|
000022  6008              STR      r0,[r1,#0]
;;;1575   
;;;1576     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000024  4844              LDR      r0,|L39.312|
000026  6800              LDR      r0,[r0,#0]  ; CardType
000028  2802              CMP      r0,#2
00002a  d101              BNE      |L39.48|
;;;1577     {
;;;1578       BlockSize = 512;
00002c  0205              LSLS     r5,r0,#8
;;;1579       WriteAddr /= 512;
00002e  0a7f              LSRS     r7,r7,#9
                  |L39.48|
;;;1580     }
;;;1581   
;;;1582     /* Set Block Size for Card */
;;;1583     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000030  4842              LDR      r0,|L39.316|
000032  6005              STR      r5,[r0,#0]  ; SDIO_CmdInitStructure
;;;1584     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000034  2010              MOVS     r0,#0x10
000036  4941              LDR      r1,|L39.316|
000038  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1585     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00003a  2040              MOVS     r0,#0x40
00003c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1586     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00003e  2000              MOVS     r0,#0
000040  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1587     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000042  f44f6080          MOV      r0,#0x400
000046  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1588     SDIO_SendCommand(&SDIO_CmdInitStructure);
000048  4608              MOV      r0,r1
00004a  f7fffffe          BL       SDIO_SendCommand
;;;1589   
;;;1590     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
00004e  2010              MOVS     r0,#0x10
000050  f7fffffe          BL       CmdResp1Error
000054  4604              MOV      r4,r0
;;;1591   
;;;1592     if (SD_OK != errorstatus)
000056  b114              CBZ      r4,|L39.94|
;;;1593     {
;;;1594       return(errorstatus);
000058  4620              MOV      r0,r4
                  |L39.90|
;;;1595     }
;;;1596   
;;;1597     /*!< To improve performance */
;;;1598     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) (RCA << 16);
;;;1599     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;1600     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1601     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1602     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1603     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1604   
;;;1605   
;;;1606     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;1607   
;;;1608     if (errorstatus != SD_OK)
;;;1609     {
;;;1610       return(errorstatus);
;;;1611     }
;;;1612     /*!< To improve performance */
;;;1613     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)NumberOfBlocks;
;;;1614     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCK_COUNT;
;;;1615     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1616     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1617     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1618     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1619   
;;;1620     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCK_COUNT);
;;;1621   
;;;1622     if (errorstatus != SD_OK)
;;;1623     {
;;;1624       return(errorstatus);
;;;1625     }
;;;1626   
;;;1627   
;;;1628     /*!< Send CMD25 WRITE_MULT_BLOCK with argument data address */
;;;1629     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)WriteAddr;
;;;1630     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_WRITE_MULT_BLOCK;
;;;1631     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1632     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1633     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1634     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1635   
;;;1636     errorstatus = CmdResp1Error(SD_CMD_WRITE_MULT_BLOCK);
;;;1637   
;;;1638     if (SD_OK != errorstatus)
;;;1639     {
;;;1640       return(errorstatus);
;;;1641     }
;;;1642   
;;;1643     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1644     SDIO_DataInitStructure.SDIO_DataLength = NumberOfBlocks * BlockSize;
;;;1645     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1646     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToCard;
;;;1647     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1648     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1649     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1650   
;;;1651     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1652     SDIO_DMACmd(ENABLE);
;;;1653     SD_LowLevel_DMA_TxConfig((uint32_t *)writebuff, (NumberOfBlocks * BlockSize));
;;;1654   
;;;1655     return(errorstatus);
;;;1656   }
00005a  e8bd81f0          POP      {r4-r8,pc}
                  |L39.94|
00005e  4838              LDR      r0,|L39.320|
000060  8800              LDRH     r0,[r0,#0]            ;1598  ; RCA
000062  0400              LSLS     r0,r0,#16             ;1598
000064  4935              LDR      r1,|L39.316|
000066  6008              STR      r0,[r1,#0]            ;1598  ; SDIO_CmdInitStructure
000068  2037              MOVS     r0,#0x37              ;1599
00006a  6048              STR      r0,[r1,#4]            ;1599  ; SDIO_CmdInitStructure
00006c  2040              MOVS     r0,#0x40              ;1600
00006e  6088              STR      r0,[r1,#8]            ;1600  ; SDIO_CmdInitStructure
000070  2000              MOVS     r0,#0                 ;1601
000072  60c8              STR      r0,[r1,#0xc]          ;1601  ; SDIO_CmdInitStructure
000074  f44f6080          MOV      r0,#0x400             ;1602
000078  6108              STR      r0,[r1,#0x10]         ;1602  ; SDIO_CmdInitStructure
00007a  4608              MOV      r0,r1                 ;1603
00007c  f7fffffe          BL       SDIO_SendCommand
000080  2037              MOVS     r0,#0x37              ;1606
000082  f7fffffe          BL       CmdResp1Error
000086  4604              MOV      r4,r0                 ;1606
000088  b10c              CBZ      r4,|L39.142|
00008a  4620              MOV      r0,r4                 ;1610
00008c  e7e5              B        |L39.90|
                  |L39.142|
00008e  482b              LDR      r0,|L39.316|
000090  6006              STR      r6,[r0,#0]            ;1613  ; SDIO_CmdInitStructure
000092  2017              MOVS     r0,#0x17              ;1614
000094  4929              LDR      r1,|L39.316|
000096  6048              STR      r0,[r1,#4]            ;1614  ; SDIO_CmdInitStructure
000098  2040              MOVS     r0,#0x40              ;1615
00009a  6088              STR      r0,[r1,#8]            ;1615  ; SDIO_CmdInitStructure
00009c  2000              MOVS     r0,#0                 ;1616
00009e  60c8              STR      r0,[r1,#0xc]          ;1616  ; SDIO_CmdInitStructure
0000a0  f44f6080          MOV      r0,#0x400             ;1617
0000a4  6108              STR      r0,[r1,#0x10]         ;1617  ; SDIO_CmdInitStructure
0000a6  4608              MOV      r0,r1                 ;1618
0000a8  f7fffffe          BL       SDIO_SendCommand
0000ac  2017              MOVS     r0,#0x17              ;1620
0000ae  f7fffffe          BL       CmdResp1Error
0000b2  4604              MOV      r4,r0                 ;1620
0000b4  b10c              CBZ      r4,|L39.186|
0000b6  4620              MOV      r0,r4                 ;1624
0000b8  e7cf              B        |L39.90|
                  |L39.186|
0000ba  4820              LDR      r0,|L39.316|
0000bc  6007              STR      r7,[r0,#0]            ;1629  ; SDIO_CmdInitStructure
0000be  2019              MOVS     r0,#0x19              ;1630
0000c0  491e              LDR      r1,|L39.316|
0000c2  6048              STR      r0,[r1,#4]            ;1630  ; SDIO_CmdInitStructure
0000c4  2040              MOVS     r0,#0x40              ;1631
0000c6  6088              STR      r0,[r1,#8]            ;1631  ; SDIO_CmdInitStructure
0000c8  2000              MOVS     r0,#0                 ;1632
0000ca  60c8              STR      r0,[r1,#0xc]          ;1632  ; SDIO_CmdInitStructure
0000cc  f44f6080          MOV      r0,#0x400             ;1633
0000d0  6108              STR      r0,[r1,#0x10]         ;1633  ; SDIO_CmdInitStructure
0000d2  4608              MOV      r0,r1                 ;1634
0000d4  f7fffffe          BL       SDIO_SendCommand
0000d8  2019              MOVS     r0,#0x19              ;1636
0000da  f7fffffe          BL       CmdResp1Error
0000de  4604              MOV      r4,r0                 ;1636
0000e0  b10c              CBZ      r4,|L39.230|
0000e2  4620              MOV      r0,r4                 ;1640
0000e4  e7b9              B        |L39.90|
                  |L39.230|
0000e6  f04f30ff          MOV      r0,#0xffffffff        ;1643
0000ea  4916              LDR      r1,|L39.324|
0000ec  6008              STR      r0,[r1,#0]            ;1643  ; SDIO_DataInitStructure
0000ee  fb06f005          MUL      r0,r6,r5              ;1644
0000f2  6048              STR      r0,[r1,#4]            ;1644  ; SDIO_DataInitStructure
0000f4  2090              MOVS     r0,#0x90              ;1645
0000f6  6088              STR      r0,[r1,#8]            ;1645  ; SDIO_DataInitStructure
0000f8  2000              MOVS     r0,#0                 ;1646
0000fa  60c8              STR      r0,[r1,#0xc]          ;1646  ; SDIO_DataInitStructure
0000fc  6108              STR      r0,[r1,#0x10]         ;1647  ; SDIO_DataInitStructure
0000fe  2001              MOVS     r0,#1                 ;1648
000100  6148              STR      r0,[r1,#0x14]         ;1648  ; SDIO_DataInitStructure
000102  4608              MOV      r0,r1                 ;1649
000104  f7fffffe          BL       SDIO_DataConfig
000108  2101              MOVS     r1,#1                 ;1651
00010a  f240302a          MOV      r0,#0x32a             ;1651
00010e  f7fffffe          BL       SDIO_ITConfig
000112  2001              MOVS     r0,#1                 ;1652
000114  f7fffffe          BL       SDIO_DMACmd
000118  fb06f105          MUL      r1,r6,r5              ;1653
00011c  4640              MOV      r0,r8                 ;1653
00011e  f7fffffe          BL       SD_LowLevel_DMA_TxConfig
000122  4620              MOV      r0,r4                 ;1655
000124  e799              B        |L39.90|
;;;1657   
                          ENDP

000126  0000              DCW      0x0000
                  |L39.296|
                          DCD      TransferError
                  |L39.300|
                          DCD      TransferEnd
                  |L39.304|
                          DCD      StopCondition
                  |L39.308|
                          DCD      0x40012c2c
                  |L39.312|
                          DCD      CardType
                  |L39.316|
                          DCD      SDIO_CmdInitStructure
                  |L39.320|
                          DCD      ||RCA||
                  |L39.324|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.convert_from_bytes_to_power_of_two||, CODE, READONLY, ALIGN=1

                  convert_from_bytes_to_power_of_two PROC
;;;2794     */
;;;2795   uint8_t convert_from_bytes_to_power_of_two(uint16_t NumberOfBytes)
000000  4601              MOV      r1,r0
;;;2796   {
;;;2797     uint8_t count = 0;
000002  2000              MOVS     r0,#0
;;;2798   
;;;2799     while (NumberOfBytes != 1)
000004  e002              B        |L40.12|
                  |L40.6|
;;;2800     {
;;;2801       NumberOfBytes >>= 1;
000006  1049              ASRS     r1,r1,#1
;;;2802       count++;
000008  1c42              ADDS     r2,r0,#1
00000a  b2d0              UXTB     r0,r2
                  |L40.12|
00000c  2901              CMP      r1,#1                 ;2799
00000e  d1fa              BNE      |L40.6|
;;;2803     }
;;;2804     return(count);
;;;2805   }
000010  4770              BX       lr
;;;2806   
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=3

                  CSD_Tab
                          %        16
                  CID_Tab
                          %        16
                  SDSTATUS_Tab
                          %        16
                  SDCardInfo
                          %        88
                  SDIO_InitStructure
                          %        24
                  SDIO_CmdInitStructure
                          %        20
                  SDIO_DataInitStructure
                          %        24

                          AREA ||.data||, DATA, ALIGN=2

                  CardType
                          DCD      0x00000000
                  ||RCA||
                          DCD      0x00000000
                  StopCondition
                          DCD      0x00000000
                  TransferError
00000c  00000000          DCB      0x00,0x00,0x00,0x00
                  TransferEnd
                          DCD      0x00000000
                  DMAEndOfTransfer
                          DCD      0x00000000

;*** Start embedded assembler ***

#line 1 "..\\..\\User\\bsp_stm32f4xx\\src\\bsp_sdio_sd.c"
	AREA ||.rev16_text||, CODE, READONLY
	THUMB
	EXPORT |__asm___13_bsp_sdio_sd_c_70335e9e____REV16|
#line 129 "D:\\Keil_v4\\ARM\\CMSIS\\Include\\core_cmInstr.h"
|__asm___13_bsp_sdio_sd_c_70335e9e____REV16| PROC
#line 130

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE, READONLY
	THUMB
	EXPORT |__asm___13_bsp_sdio_sd_c_70335e9e____REVSH|
#line 144
|__asm___13_bsp_sdio_sd_c_70335e9e____REVSH| PROC
#line 145

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
